(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{199:function(e,t,n){e.exports=n(327)},321:function(e,t,n){},327:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"NodeModel",function(){return ft}),n.d(a,"NodeFactory",function(){return on}),n.d(a,"PortModel",function(){return ht});var i={};n.r(i),n.d(i,"NodeModel",function(){return sn}),n.d(i,"NodeFactory",function(){return gn}),n.d(i,"PortModel",function(){return ln});var r={};n.r(r),n.d(r,"NodeModel",function(){return fn}),n.d(r,"NodeFactory",function(){return xn}),n.d(r,"PortModel",function(){return hn});var o={};n.r(o),n.d(o,"NodeModel",function(){return Un}),n.d(o,"NodeFactory",function(){return Ln}),n.d(o,"PortModel",function(){return Dn});var l={};n.r(l),n.d(l,"NodeModel",function(){return An}),n.d(l,"NodeFactory",function(){return Gn}),n.d(l,"PortModel",function(){return zn});var s={};n.r(s),n.d(s,"NodeModel",function(){return Hn}),n.d(s,"NodeFactory",function(){return Yn}),n.d(s,"PortModel",function(){return Vn});var c={};n.r(c),n.d(c,"NodeModel",function(){return Xn}),n.d(c,"NodeFactory",function(){return ta}),n.d(c,"PortModel",function(){return Jn});var d={};n.r(d),n.d(d,"NodeModel",function(){return aa}),n.d(d,"NodeFactory",function(){return Ua}),n.d(d,"PortModel",function(){return na});var m=n(0),u=n.n(m),p=n(17),g=n(20),h=n(46),f=n(155),v=n(22),b=n.n(v),E=n(13),y="segments_changed",O="criteria_changed",N="triggers_changed",j="before_triggers_changed",S="mails_changed",k="goals_changed",w="banners_changed",T="canvas_zoomable",C="canvas_pannable",P="canvas_zoomable_pannable",M="canvas_notification",_="set_scenario_id",F="set_scenario_name",x="set_scenario_payload",D="set_scenario_loading",U={avalaibleSegments:[]},I={criteria:[]},B={avalaibleTriggers:[]},L={availableBeforeTriggers:[]},z={pannable:!0,zoomable:!0,notification:{open:!1,variant:"success",text:""}},A={id:null,name:"",loading:0,payload:null},W={availableMails:[]},R={availableGoals:[]},G={availableBanners:[]},V=Object(h.c)({segments:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y:return Object(E.a)({},e,{avalaibleSegments:t.payload});default:return e}},triggers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case N:return Object(E.a)({},e,{avalaibleTriggers:t.payload});default:return e}},beforeTriggers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case j:return Object(E.a)({},e,{availableBeforeTriggers:t.payload});default:return e}},canvas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case C:return Object(E.a)({},e,{pannable:t.payload});case T:return Object(E.a)({},e,{zoomable:t.payload});case P:return Object(E.a)({},e,{zoomable:t.payload,pannable:t.payload});case M:return Object(E.a)({},e,{notification:Object(E.a)({},e.notification,t.payload)});default:return e}},criteria:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return Object(E.a)({},e,{criteria:t.payload});default:return e}},scenario:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case _:return Object(E.a)({},e,{id:t.payload});case F:return Object(E.a)({},e,{name:t.payload});case D:var n=e.loading;return t.payload?++n:--n,Object(E.a)({},e,{loading:n});case x:return Object(E.a)({},e,{payload:t.payload});default:return e}},mails:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case S:return Object(E.a)({},e,{availableMails:t.payload});default:return e}},goals:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case k:return Object(E.a)({},e,{availableGoals:t.payload});default:return e}},banners:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case w:return Object(E.a)({},e,{availableBanners:t.payload});default:return e}}}),H=n(6),K=n(10),q=n(8),Y=n(5),J=n(9),X=function(){function e(){Object(H.a)(this,e)}return Object(K.a)(e,null,[{key:"load",value:function(){var e=document.createElement("script");e.type="text/javascript",e.src="/segmenter/vue.min.js";var t=document.createElement("script");t.type="text/javascript",t.src="/segmenter/RempSegmenter.umd.min.js";var n=document.createElement("link");n.rel="stylesheet",n.href="/segmenter/RempSegmenter.css",document.head.appendChild(e),document.head.appendChild(t),document.head.appendChild(n)}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#segmenter";new window.Vue({render:function(e){return e(window.RempSegmenter)}}).$mount(e)}}]),e}(),Z=n(156),$=n.n(Z),Q=n(12),ee=n(382),te=n(399),ne=n(392),ae=n(391),ie=n(393),re=n(373),oe=n(383),le=n(363),se=n(380),ce=n(4),de=n(369),me=n(90),ue=n.n(me),pe=n(91),ge=n.n(pe),he=n(94),fe=n.n(he),ve=n(96),be=n.n(ve),Ee=n(92),ye=n.n(Ee),Oe=n(98),Ne=n.n(Oe),je=n(97),Se=n.n(je),ke=n(95),we=n.n(ke),Te=window.Scenario.config,Ce=Te.AUTH_TOKEN,Pe=Te.API_HOST,Me=Te.SCENARIO_ID,_e=Te.BANNER_ENABLED,Fe="".concat(Pe,"/scenarios/info?id="),xe="".concat(Pe,"/scenarios/create"),De="".concat(Pe,"/scenarios/criteria"),Ue="".concat(Pe,"/segments/list"),Ie="".concat(Pe,"/events/list"),Be="".concat(Pe,"/event-generators/list"),Le="".concat(Pe,"/mail-template/list"),ze="".concat(Pe,"/onboarding-goals/list"),Ae="".concat(Pe,"/remp/list-banners"),We="".concat(Pe,"/scenarios/element"),Re="".concat(Pe,"/scenarios/trigger"),Ge=n(358),Ve=n(361),He=n(362),Ke=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,e))).state={},n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"render",value:function(){var e=this;return m.createElement(Ge.a,{key:this.props.name,draggable:!0,onDragStart:function(t){t.dataTransfer.setData("storm-diagram-node",JSON.stringify(e.props.model))},className:"tray-item"},m.createElement(Ve.a,null,this.props.icon),m.createElement(He.a,{primary:this.props.name}))}}]),t}(m.Component),qe=n(44);function Ye(e,t){switch(t){case"minutes":return parseInt(e);case"hours":return 60*e;case"days":return 60*e*24;default:return parseInt(e)}}var Je=function(){function e(t){Object(H.a)(this,e),this.formatDescendant=function(e,t){var n={uuid:e.id};return"segment"===t.type?n.direction="right"===e.portName?"positive":"negative":"goal"===t.type?n.direction="right"===e.portName?"positive":"negative":"condition"===t.type&&(n.direction="right"===e.portName?"positive":"negative"),n},this.model=t}return Object(K.a)(e,[{key:"exportPayload",value:function(){var e=this,t={},n=this.model.serializeDiagram(),a=["trigger","before_trigger"];return t.triggers={},t.elements={},t.visual={},n.nodes.filter(function(e){return a.includes(e.type)}).map(function(n){return t.triggers[n.id]=e.formatNode(n)}),Object.entries(this.model.getNodes()).forEach(function(e){t.visual[e[0]]={x:e[1].x,y:e[1].y}}),Object.entries(this.model.getNodes()).forEach(function(n){a.includes(n[1].type)||(t.elements[n[0]]=e.formatNode(n[1].serialize()))}),t}},{key:"getAllChildrenNodes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right";return e.ports.find(function(e){return e.name===n}).links.map(function(a){var i=null;return i=t.model.links[a].targetPort.parent.id!==e.id?t.model.links[a].targetPort.parent:t.model.links[a].sourcePort.parent,Object(E.a)({},i.serialize(),{portName:n})})}},{key:"getPositiveAndNegativeDescendants",value:function(e){var t=this,n=this.getAllChildrenNodes(e,"right").map(function(n){return t.formatDescendant(n,e)}),a=this.getAllChildrenNodes(e,"bottom").map(function(n){return t.formatDescendant(n,e)});return[].concat(Object(qe.a)(n),Object(qe.a)(a))}},{key:"formatNode",value:function(e){var t=this;if("email"===e.type)return{id:e.id,name:e.name?e.name:"",type:"email",email:{code:e.selectedMail,descendants:this.getAllChildrenNodes(e).map(function(n){return t.formatDescendant(n,e)})}};if("banner"===e.type)return{id:e.id,name:e.name?e.name:"",type:"banner",banner:{id:e.selectedBanner,expiresInMinutes:Ye(e.expiresInTime,e.expiresInUnit),descendants:this.getAllChildrenNodes(e).map(function(n){return t.formatDescendant(n,e)})}};if("condition"===e.type)return{id:e.id,name:e.name?e.name:"",type:"condition",condition:{conditions:e.conditions,descendants:this.getPositiveAndNegativeDescendants(e)}};if("segment"===e.type)return{id:e.id,name:e.name?e.name:"",type:"segment",segment:{code:e.selectedSegment?e.selectedSegment:"all_users",descendants:this.getPositiveAndNegativeDescendants(e)}};if("trigger"===e.type)return{id:e.id,name:e.name?e.name:"",type:"event",event:{code:e.selectedTrigger?e.selectedTrigger:"user_created"},elements:this.getAllChildrenNodes(e).map(function(e){return e.id})};if("before_trigger"===e.type)return{id:e.id,name:e.name?e.name:"",type:"before_event",event:{code:e.selectedTrigger?e.selectedTrigger:"subscription_ends"},elements:this.getAllChildrenNodes(e).map(function(e){return e.id}),options:{minutes:Ye(e.time,e.timeUnit)}};if("wait"===e.type)return{id:e.id,name:e.name?e.name:"",type:"wait",wait:{minutes:Ye(e.waitingTime,e.waitingUnit),descendants:this.getAllChildrenNodes(e).map(function(n){return t.formatDescendant(n,e)})}};if("goal"===e.type){var n={codes:e.selectedGoals?e.selectedGoals:[],descendants:this.getPositiveAndNegativeDescendants(e),recheckPeriodMinutes:Ye(e.recheckPeriodTime,e.recheckPeriodUnit)};return e.timeoutTime&&e.timeoutUnit&&(n.timeoutMinutes=Ye(e.timeoutTime,e.timeoutUnit)),{id:e.id,name:e.name?e.name:"",type:"goal",goal:n}}}}]),e}(),Xe=n(402),Ze=n(365),$e=n(160),Qe=n.n($e),et=n(162),tt=n.n(et),nt=n(163),at=n.n(nt),it=n(161),rt=n.n(it),ot={success:Qe.a,warning:rt.a,error:tt.a,info:at.a},lt=function(e){function t(){return Object(H.a)(this,t),Object(q.a)(this,Object(Y.a)(t).apply(this,arguments))}return Object(J.a)(t,e),Object(K.a)(t,[{key:"render",value:function(){var e=ot[this.props.variant];return u.a.createElement(Xe.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:this.props.open,autoHideDuration:3e3,onClose:this.props.handleClose},u.a.createElement(Ze.a,{className:"toast-"+this.props.variant,message:u.a.createElement("span",{id:"client-snackbar",className:"toast__message"},u.a.createElement(e,{className:"toast__icon toast__icon-variant"}),this.props.text)}))}}]),t}(u.a.Component),st=function(e){function t(e,n){var a;return Object(H.a)(this,t),(a=Object(q.a)(this,Object(Y.a)(t).call(this,e))).cb=n,a}return Object(J.a)(t,e),Object(K.a)(t,[{key:"getNewInstance",value:function(e){return this.cb(e)}}]),t}(Q.AbstractPortFactory),ct=n(19),dt=n(23),mt=function(e){function t(){var e;return Object(H.a)(this,t),(e=Object(q.a)(this,Object(Y.a)(t).call(this,"custom"))).width=3,e.curvyness=50,e.color="rgba(0,0,0,0.3)",e}return Object(J.a)(t,e),t}(Q.DefaultLinkModel),ut=function(e){function t(){var e;return Object(H.a)(this,t),(e=Object(q.a)(this,Object(Y.a)(t).call(this))).type="custom",e}return Object(J.a)(t,e),Object(K.a)(t,[{key:"getNewInstance",value:function(e){return new mt}},{key:"generateLinkSegment",value:function(e,t,n,a){return m.createElement("path",{className:n?t.bem("--path-selected"):"",strokeWidth:e.width,stroke:e.color,d:a})}}]),t}(Q.DefaultLinkFactory),pt=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left",a=arguments.length>1?arguments[1]:void 0;return Object(H.a)(this,t),(e=Object(q.a)(this,Object(Y.a)(t).call(this,n,a))).position=n,e.in="left"===e.position,e}return Object(J.a)(t,e),Object(K.a)(t,[{key:"link",value:function(e){var t=this.createLinkModel();return t.setSourcePort(this),t.setTargetPort(e),t}},{key:"canLinkToPort",value:function(e){return this.in!==e.in}},{key:"serialize",value:function(){return dt.merge(Object(ct.a)(Object(Y.a)(t.prototype),"serialize",this).call(this),{position:this.position})}},{key:"deSerialize",value:function(e,n){Object(ct.a)(Object(Y.a)(t.prototype),"deSerialize",this).call(this,e,n),this.position=e.position}},{key:"createLinkModel",value:function(){return new mt}}]),t}(Q.PortModel),gt=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left",a=arguments.length>1?arguments[1]:void 0;return Object(H.a)(this,t),(e=Object(q.a)(this,Object(Y.a)(t).call(this,n,a))).position=n,e.in="left"===e.position,e}return Object(J.a)(t,e),Object(K.a)(t,[{key:"link",value:function(e){var t=this.createLinkModel();return t.setSourcePort(this),t.setTargetPort(e),t}},{key:"serialize",value:function(){return dt.merge(Object(ct.a)(Object(Y.a)(t.prototype),"serialize",this).call(this),{position:this.position})}},{key:"canLinkToPort",value:function(e){return this.in!==e.in}},{key:"deSerialize",value:function(e,n){Object(ct.a)(Object(Y.a)(t.prototype),"deSerialize",this).call(this,e,n),this.position=e.position}},{key:"createLinkModel",value:function(){return new mt}}]),t}(Q.PortModel),ht=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(H.a)(this,t),Object(q.a)(this,Object(Y.a)(t).call(this,e,"email"))}return Object(J.a)(t,e),t}(pt),ft=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,"email",e.id))).name=e.name,n.selectedMail=e.selectedMail,n.addPort(new ht("left")),n.addPort(new ht("right")),n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"deSerialize",value:function(e,n){Object(ct.a)(Object(Y.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedMail=e.selectedMail}},{key:"serialize",value:function(){return dt.merge(Object(ct.a)(Object(Y.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedMail:this.selectedMail})}}]),t}(Q.NodeModel),vt=n(400),bt=n(375),Et=n(381),yt=n(378),Ot=n(379),Nt=n(377),jt=n(164),St=n.n(jt),kt=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,e))).state={selected:!1},n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"getClassName",value:function(){return"port "+Object(ct.a)(Object(Y.a)(t.prototype),"getClassName",this).call(this)+(this.state.selected?this.bem("--selected"):"")}},{key:"render",value:function(){var e=this;return m.createElement("div",Object.assign({},this.getProps(),{onMouseEnter:function(){e.setState({selected:!0})},onMouseLeave:function(){e.setState({selected:!1})},"data-name":this.props.name,"data-nodeid":this.props.node.getID()}),this.props.children)}}]),t}(Q.PortWidget),wt=n(367);function Tt(e){return{type:P,payload:e}}function Ct(e){return{type:M,payload:e}}function Pt(e){return{type:_,payload:e}}function Mt(e){return{type:F,payload:e}}function _t(e){return{type:D,payload:e}}function Ft(e){return function(t){return t(_t(!0)),b.a.get(Fe+e).then(function(e){var n;t((n=e.data,{type:x,payload:n})),t(Mt(e.data.name)),t(Pt(e.data.id)),t(_t(!1))}).catch(function(e){t(_t(!1)),t(Ct({open:!0,variant:"error",text:"Scenario fetching failed."})),console.log(e)})}}function xt(){return function(e){return e(_t(!0)),b.a.get("".concat(Ue)).then(function(t){var n;e((n=t.data.result,{type:y,payload:n})),e(_t(!1))}).catch(function(t){console.log(t),e(_t(!1)),e(Ct({open:!0,variant:"error",text:"Segments fetching failed."}))})}}function Dt(){return function(e){return e(_t(!0)),b.a.get("".concat(Ie)).then(function(t){var n;e((n=t.data.events,{type:N,payload:n})),e(_t(!1))}).catch(function(t){e(_t(!1)),console.log(t),e(Ct({open:!0,variant:"error",text:"Triggers fetching failed."}))})}}function Ut(){return function(e){return e(_t(!0)),b.a.get("".concat(Le)).then(function(t){var n;e((n=t.data.mail_templates,{type:S,payload:n})),e(_t(!1))}).catch(function(t){e(_t(!1)),console.log(t),e(Ct({open:!0,variant:"error",text:"Mails fetching failed."}))})}}function It(){return function(e){return e(_t(!0)),b.a.get(ze).then(function(t){var n;e((n=t.data.goals,{type:k,payload:n})),e(_t(!1))}).catch(function(t){e(_t(!1)),console.log(t),e(Ct({open:!0,variant:"error",text:"Goals fetching failed."}))})}}function Bt(){return function(e){return e(_t(!0)),b.a.get(Ae).then(function(t){var n;e((n=t.data.banners,{type:w,payload:n})),e(_t(!1))}).catch(function(t){e(_t(!1)),console.log(t),e(Ct({open:!0,variant:"error",text:"Banners fetching failed."}))})}}function Lt(){return function(e){return e(_t(!0)),b.a.get(De).then(function(t){var n;e((n=t.data.blueprint,{type:O,payload:n})),e(_t(!1))}).catch(function(t){console.log(t),e(_t(!1)),e(Ct({open:!0,variant:"error",text:"Criteria fetching failed."}))})}}function zt(){return function(e){return e(_t(!0)),b.a.get("".concat(Be)).then(function(t){var n;e((n=t.data.events,{type:j,payload:n})),e(_t(!1))}).catch(function(t){e(_t(!1)),console.log(t),e(Ct({open:!0,variant:"error",text:"Triggers fetching failed."}))})}}var At=function(e){function t(){var e,n;Object(H.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(q.a)(this,(e=Object(Y.a)(t)).call.apply(e,[this].concat(i)))).state={html:null,loading:!0},n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.scenarioID&&this.props.scenarioID!==e.scenarioID&&this.fetchStatistics()}},{key:"fetchStatistics",value:function(){var e=this,t=this.props,n=t.dispatch,a=t.id,i=t.scenarioID,r=t.isTrigger;if(i){var o=r?"".concat(Re,"?trigger_uuid=").concat(a):"".concat(We,"?element_uuid=").concat(a);this.setState({loading:!0}),b.a.get(o).then(function(t){var n=t.data;e.setState({html:n.html})}).catch(function(e){console.log(e),n(Ct({open:!0,variant:"error",text:"Tooltip fetching failed."}))}).then(function(){e.setState({loading:!1})})}}},{key:"render",value:function(){var e=this.props.anchorElement;return this.state.html?u.a.createElement(wt.a,{open:Boolean(e),anchorEl:e,style:{pointerEvents:"none"},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},this.state.loading&&u.a.createElement("div",{className:"node-tooltip-loader"},u.a.createElement(de.a,{size:30})),u.a.createElement("div",{className:"node-tooltip-wrapper",dangerouslySetInnerHTML:{__html:this.state.html}})):null}}]),t}(u.a.Component);var Wt=Object(g.b)(function(e){return{scenarioID:e.scenario.id}})(At),Rt=n(74),Gt=n(179),Vt=n(165),Ht=n.n(Vt),Kt=n(178),qt=n(366),Yt=n(405),Jt=n(374),Xt=n(167),Zt=n.n(Xt),$t=n(166);function Qt(e){var t=e.inputRef,n=Object(Gt.a)(e,["inputRef"]);return u.a.createElement("div",Object.assign({ref:t},n))}var en={Control:function(e){return u.a.createElement(vt.a,Object.assign({fullWidth:!0,multiline:!0,InputProps:{inputComponent:Qt,inputProps:Object(E.a)({className:e.selectProps.classes.input,inputRef:e.innerRef,children:e.children},e.innerProps)}},e.selectProps.textFieldProps))},Menu:function(e){return u.a.createElement(qt.a,Object.assign({square:!0,className:e.selectProps.classes.paper},e.innerProps),e.children)},MultiValue:function(e){return u.a.createElement(Yt.a,{tabIndex:-1,label:e.children,className:Ht()(e.selectProps.classes.chip,Object(Rt.a)({},e.selectProps.classes.chipFocused,e.isFocused)),onDelete:e.removeProps.onClick,deleteIcon:u.a.createElement(Zt.a,e.removeProps)})},NoOptionsMessage:function(e){return u.a.createElement(le.a,Object.assign({color:"textSecondary",className:e.selectProps.classes.noOptionsMessage},e.innerProps),e.children)},Option:function(e){return u.a.createElement(Jt.a,Object.assign({buttonRef:e.innerRef,selected:e.isFocused,component:"div",style:{fontWeight:e.isSelected?500:400}},e.innerProps),e.children)},Placeholder:function(e){return u.a.createElement(le.a,Object.assign({color:"textSecondary",className:e.selectProps.classes.placeholder},e.innerProps),e.children)},SingleValue:function(e){return u.a.createElement(le.a,Object.assign({className:e.selectProps.classes.singleValue},e.innerProps),e.children)},ValueContainer:function(e){return u.a.createElement("div",{className:e.selectProps.classes.valueContainer},e.children)}},tn=function(e){function t(){var e,n;Object(H.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(q.a)(this,(e=Object(Y.a)(t)).call.apply(e,[this].concat(i)))).state={single:null,multi:null},n.handleChange=function(e){return function(t){n.setState(Object(Rt.a)({},e,t))}},n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,n=e.theme,a={input:function(e){return Object(E.a)({},e,{color:n.palette.text.primary,"& input":{font:"inherit"}})}};return u.a.createElement("div",{className:t.root},u.a.createElement(Kt.a,{classes:t,styles:a,components:en,menuPosition:"fixed",textFieldProps:{label:this.props.label,InputLabelProps:{shrink:!0}},isMulti:this.props.isMulti,options:this.props.options,value:this.props.value,onChange:this.props.onChange,placeholder:this.props.placeholder}))}}]),t}(u.a.Component);tn.defaultProp={isMulti:!1};var nn=Object(ce.a)(function(e){return{root:{flexGrow:1,marginTop:"10px",marginBottom:"10px",fontFamily:"Roboto, Helvetica, Arial, sans-serif"},input:{display:"flex",padding:0},valueContainer:{display:"flex",flexWrap:"wrap",flex:1,alignItems:"center",overflow:"hidden"},chip:{margin:"".concat(e.spacing.unit/2,"px ").concat(e.spacing.unit/4,"px")},chipFocused:{backgroundColor:Object($t.emphasize)("light"===e.palette.type?e.palette.grey[300]:e.palette.grey[700],.08)},noOptionsMessage:{padding:"".concat(e.spacing.unit,"px ").concat(2*e.spacing.unit,"px")},singleValue:{fontSize:14},placeholder:{position:"absolute",left:2,fontSize:14},paper:{position:"absolute",zIndex:1,marginTop:e.spacing.unit,left:0,right:0},divider:{height:2*e.spacing.unit}}},{withTheme:!0})(tn),an=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,anchorElementForTooltip:null}),n.props.dispatch(Tt(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Tt(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.getFormatedValue=function(){var e=n.props.mails.find(function(e){return e.code===n.state.selectedMail});return e?{value:e.code,label:e.name}:{}},n.transformOptionsForSelect=function(){var e=St()(n.props.mails,function(e){return e.mail_type.code}),t=[];return Object.keys(e).forEach(function(n){t.push({label:e[n][0].mail_type.name,sorting:e[n][0].mail_type.sorting,options:e[n].map(function(e){return{value:e.code,label:e.name}})})}),t.sort(function(e,t){return e.sorting-t.sorting})},n.getSelectedMailValue=function(){var e=n.props.mails.find(function(e){return e.code===n.props.node.selectedMail});return e?" - ".concat(e.name):""},n.state={nodeFormName:n.props.node.name,selectedMail:n.props.node.selectedMail,dialogOpened:!1,anchorElementForTooltip:null},n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return m.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},m.createElement("div",{className:"node-container"},m.createElement("div",{className:this.bem("__icon")},m.createElement(ue.a,null)),m.createElement("div",{className:this.bem("__ports")},m.createElement("div",{className:this.bem("__left")},m.createElement(kt,{name:"left",node:this.props.node})),m.createElement("div",{className:this.bem("__right")},m.createElement(kt,{name:"right",node:this.props.node})))),m.createElement("div",{className:this.bem("__title")},m.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Mail ".concat(this.getSelectedMailValue()))),m.createElement(Wt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),m.createElement(bt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},m.createElement(Nt.a,{id:"form-dialog-title"},"Email node"),m.createElement(yt.a,null,m.createElement(Ot.a,null,"Sends an email to user."),m.createElement(se.a,{container:!0,spacing:32},m.createElement(se.a,{item:!0,xs:6},m.createElement(vt.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),m.createElement(se.a,{container:!0,spacing:32},m.createElement(se.a,{item:!0,xs:12},m.createElement(nn,{options:this.transformOptionsForSelect(),value:this.getFormatedValue(),onChange:function(t){e.setState({selectedMail:t.value})},placeholder:"Pick one",label:"Selected Mail"})))),m.createElement(Et.a,null,m.createElement(ee.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),m.createElement(ee.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedMail=e.state.selectedMail,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(m.Component);var rn=Object(g.b)(function(e){return{mails:e.mails.availableMails}})(an),on=function(e){function t(){return Object(H.a)(this,t),Object(q.a)(this,Object(Y.a)(t).call(this,"email"))}return Object(J.a)(t,e),Object(K.a)(t,[{key:"generateReactWidget",value:function(e,t){return m.createElement(rn,{diagramEngine:e,node:t,classBaseName:"square-node",className:"email-node"})}},{key:"getNewInstance",value:function(){return new ft}}]),t}(Q.AbstractNodeFactory),ln=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(H.a)(this,t),Object(q.a)(this,Object(Y.a)(t).call(this,e,"banner"))}return Object(J.a)(t,e),t}(pt),sn=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,"banner",e.id))).name=e.name,n.selectedBanner=e.selectedBanner,n.expiresInTime=e.expiresInTime,n.expiresInUnit=e.expiresInUnit,n.addPort(new ln("left")),n.addPort(new ln("right")),n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"deSerialize",value:function(e,n){Object(ct.a)(Object(Y.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedBanner=e.selectedBanner,this.expiresInTime=e.expiresInTime||"1",this.expiresInUnit=e.expiresInUnit||"days"}},{key:"serialize",value:function(){return dt.merge(Object(ct.a)(Object(Y.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedBanner:this.selectedBanner,expiresInTime:this.expiresInTime,expiresInUnit:this.expiresInUnit})}}]),t}(Q.NodeModel),cn=n(372),dn=n(401),mn=n(395),un=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,anchorElementForTooltip:null}),n.props.dispatch(Tt(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Tt(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.getFormatedValue=function(){var e=n.props.banners.find(function(e){return e.id===n.state.selectedBanner});return e?{value:e.id,label:e.name}:{}},n.transformOptionsForSelect=function(){return n.props.banners.map(function(e){return{value:e.id,label:e.name}})},n.getSelectedMailValue=function(){var e=n.props.banners.find(function(e){return e.id===n.props.node.selectedBanner});return e?" - ".concat(e.name):""},n.state={nodeFormName:n.props.node.name,selectedBanner:n.props.node.selectedBanner,dialogOpened:!1,anchorElementForTooltip:null,expiresInTime:n.props.node.expiresInTime,expiresInUnit:n.props.node.expiresInUnit},n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return m.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},m.createElement("div",{className:"node-container"},m.createElement("div",{className:this.bem("__icon")},m.createElement(ge.a,null)),m.createElement("div",{className:this.bem("__ports")},m.createElement("div",{className:this.bem("__left")},m.createElement(kt,{name:"left",node:this.props.node})),m.createElement("div",{className:this.bem("__right")},m.createElement(kt,{name:"right",node:this.props.node})))),m.createElement("div",{className:this.bem("__title")},m.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Banner ".concat(this.getSelectedMailValue()))),m.createElement(Wt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),m.createElement(bt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},m.createElement(Nt.a,{id:"form-dialog-title"},"Banner node"),m.createElement(yt.a,null,m.createElement(Ot.a,null,"Shows a one-time banner to user."),m.createElement(se.a,{container:!0,spacing:32},m.createElement(se.a,{item:!0,xs:6},m.createElement(vt.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),m.createElement(se.a,{container:!0,spacing:32},m.createElement(se.a,{item:!0,xs:12},m.createElement(nn,{options:this.transformOptionsForSelect(),value:this.getFormatedValue(),onChange:function(t){e.setState({selectedBanner:t.value})},placeholder:"Pick one",label:"Selected Banner"}))),m.createElement(se.a,{container:!0,spacing:32},m.createElement(se.a,{item:!0,xs:6},m.createElement(vt.a,{id:"expires-in-time",label:"Expires in",type:"number",helperText:"Banner is not shown after given period",fullWidth:!0,value:this.state.expiresInTime,onChange:function(t){e.setState({expiresInTime:t.target.value})}})),m.createElement(se.a,{item:!0,xs:6},m.createElement(cn.a,{fullWidth:!0},m.createElement(dn.a,{htmlFor:"time-unit"},"Time unit"),m.createElement(mn.a,{value:this.state.expiresInUnit,onChange:function(t){e.setState({expiresInUnit:t.target.value})},inputProps:{name:"expires-in-unit",id:"expires-in-unit"}},m.createElement(Jt.a,{value:"minutes"},"Minutes"),m.createElement(Jt.a,{value:"hours"},"Hours"),m.createElement(Jt.a,{value:"days"},"Days")))))),m.createElement(Et.a,null,m.createElement(ee.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),m.createElement(ee.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedBanner=e.state.selectedBanner,e.props.node.expiresInTime=e.state.expiresInTime,e.props.node.expiresInUnit=e.state.expiresInUnit,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(m.Component);var pn=Object(g.b)(function(e){return{banners:e.banners.availableBanners}})(un),gn=function(e){function t(){return Object(H.a)(this,t),Object(q.a)(this,Object(Y.a)(t).call(this,"banner"))}return Object(J.a)(t,e),Object(K.a)(t,[{key:"generateReactWidget",value:function(e,t){return m.createElement(pn,{diagramEngine:e,node:t,classBaseName:"square-node",className:"banner-node"})}},{key:"getNewInstance",value:function(){return new sn}}]),t}(Q.AbstractNodeFactory),hn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top";return Object(H.a)(this,t),Object(q.a)(this,Object(Y.a)(t).call(this,e,"segment"))}return Object(J.a)(t,e),t}(gt),fn=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,"segment",e.id))).name=e.name,n.selectedSegment=e.selectedSegment,n.addPort(new hn("left")),n.addPort(new hn("bottom")),n.addPort(new hn("right")),n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"deSerialize",value:function(e,n){Object(ct.a)(Object(Y.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedSegment=e.selectedSegment}},{key:"serialize",value:function(){return dt.merge(Object(ct.a)(Object(Y.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedSegment:this.selectedSegment})}}]),t}(Q.NodeModel),vn=n(61),bn=n.n(vn),En=n(93),yn=n.n(En),On=n(387),Nn=n(386),jn=n(385),Sn=n(396);function kn(e){return"string"===typeof e?e:e.name}function wn(e,t){return!(!t||!t.hasOwnProperty("code"))&&e.code===t.code}function Tn(e,t){var n=t.filter(function(t){return t.code===e})[0];return n||null}function Cn(e){var t=Object(g.c)(function(t){return t.segments.avalaibleSegments.filter(function(t){return t.table===e.selectedSegmentSourceTable})})[0].segments.sort(function(e,t){return e.group.sorting-t.group.sorting===0?e.group.id-t.group.id:e.group.sorting-t.group.sorting});return u.a.createElement(Sn.a,{value:Tn(e.selectedSegment,t),options:t,getOptionSelected:wn,getOptionLabel:kn,groupBy:function(e){return e.group.name},style:{width:700,marginLeft:10,marginBottom:5},onChange:function(t,n){e.onSegmentSelectedChange(n)},renderInput:function(e){return u.a.createElement(vt.a,Object.assign({},e,{variant:"standard",label:"Segment",fullWidth:!0}))}})}var Pn=Object(jn.a)({selectedButton:{backgroundColor:"#E4E4E4"},deselectedButton:{color:"#A6A6A6"}});function Mn(e){var t=Pn(),n=Object(g.c)(function(e){return e.segments.avalaibleSegments}),a=function(e,t,n){if(e)return e;if(t){var a=n.filter(function(e){return e.segments.filter(function(e){return e.code===t}).length>0});return a[0]&&a[0].hasOwnProperty("table")?a[0].table:"users"}return"users"}(e.selectedSegmentSourceTable,e.selectedSegment,n);return u.a.createElement(se.a,{container:!0,item:!0,xs:12,spacing:3},u.a.createElement(se.a,{item:!0,xs:12},u.a.createElement(Nn.a,{"aria-label":"outlined button group"},n.map(function(n){return u.a.createElement(ee.a,{onClick:function(){return e.onSegmentTypeButtonClick(n.table)},className:a===n.table?t.selectedButton:t.deselectedButton,key:n.table},n.table)}))),u.a.createElement(Cn,{selectedSegment:e.selectedSegment,selectedSegmentSourceTable:a,onSegmentSelectedChange:e.onSegmentSelectedChange}))}var _n=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,selectedSegment:n.props.node.selectedSegment,anchorElementForTooltip:null}),n.props.dispatch(Tt(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Tt(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.actionSetTable=function(e){n.state.selectedSegmentSourceTable!==e&&(n.setState({selectedSegment:null}),n.setState({selectedSegmentSourceTable:e}))},n.segmentSelectedChange=function(e){var t=null;e&&e.hasOwnProperty("code")&&(t=e.code),n.setState({selectedSegment:t})},n.getSelectedSegmentValue=function(){var e=n.props.segments.flatMap(function(e){return e.segments}).find(function(e){return e.code===n.props.node.selectedSegment});return e?" - ".concat(e.name):""},n.handleNewSegmentClick=function(){window.addEventListener("savedSegment",n.handleSavedNewSegment),window.addEventListener("canceledNewSegment",n.handleCancelNewSegment),n.setState({creatingNewSegment:!0}),setTimeout(function(){X.init()})},n.handleSavedNewSegment=function(e){n.props.dispatch(xt()),n.setState({selectedSegment:e.detail.code,creatingNewSegment:!1}),n.props.node.name=n.state.nodeFormName,n.props.node.selectedSegment=n.state.selectedSegment,n.props.diagramEngine.repaintCanvas(),n.closeDialog(),window.removeEventListener("savedSegment",n.handleSavedNewSegment)},n.handleCancelNewSegment=function(e){n.setState({creatingNewSegment:!1}),window.removeEventListener("canceledNewSegment",n.handleSavedNewSegment)},n.state={nodeFormName:n.props.node.name,selectedSegment:n.props.node.selectedSegment,dialogOpened:!1,anchorElementForTooltip:null,creatingNewSegment:!1,selectedSegmentSourceTable:null},n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return m.createElement("div",{className:this.getClassName(),onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},m.createElement("div",{className:this.bem("__title")},m.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Segment ".concat(this.getSelectedSegmentValue()))),m.createElement("div",{className:"node-container"},m.createElement("div",{className:this.bem("__icon")},m.createElement(ye.a,null)),m.createElement("div",{className:this.bem("__ports")},m.createElement("div",{className:this.bem("__left")},m.createElement(kt,{name:"left",node:this.props.node})),m.createElement("div",{className:this.bem("__right")},m.createElement(kt,{name:"right",node:this.props.node},m.createElement(bn.a,{style:{position:"absolute",top:"-20px",right:"-20px",color:"#2ECC40"}}))),m.createElement("div",{className:this.bem("__bottom")},m.createElement(kt,{name:"bottom",node:this.props.node},m.createElement(yn.a,{style:{position:"absolute",top:"8px",right:"-22px",color:"#FF695E"}}))))),m.createElement(Wt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),m.createElement(bt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullScreen:this.state.creatingNewSegment,disableEscapeKeyDown:this.state.creatingNewSegment},!this.state.creatingNewSegment&&m.createElement(m.Fragment,null,m.createElement(Nt.a,{id:"form-dialog-title"},"Segment node"),m.createElement(yt.a,null,m.createElement(Ot.a,null,"Segments evaluate user's presence in a group of users defined by system-provided conditions. Execution flow can be directed based on presence/absence of user within the selected segment. You can either pick one of the existing segments or create a new one."),m.createElement(se.a,{container:!0,spacing:3},m.createElement(se.a,{item:!0,xs:6},m.createElement(vt.a,{margin:"normal",id:"segment-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),m.createElement(se.a,{container:!0,spacing:3,alignItems:"flex-end"},m.createElement(se.a,{item:!0,xs:8},m.createElement(Mn,{selectedSegment:this.state.selectedSegment,selectedSegmentSourceTable:this.state.selectedSegmentSourceTable,onSegmentTypeButtonClick:this.actionSetTable,onSegmentSelectedChange:this.segmentSelectedChange})),window.RempSegmenter&&m.createElement(se.a,{item:!0,xs:4,style:{textAlign:"right",paddingBottom:"4px"}},m.createElement(ee.a,{variant:"contained",color:"primary",size:"small",style:{position:"relative",bottom:"10px"},onClick:this.handleNewSegmentClick},m.createElement(On.a,{style:{marginRight:"5px"}},"add_circle"),"New segment"))))),this.state.creatingNewSegment&&m.createElement(yt.a,null,m.createElement("div",{id:"segmenter",style:{position:"fixed",zIndex:"99999999"}})),!this.state.creatingNewSegment&&m.createElement(Et.a,null,m.createElement(ee.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),m.createElement(ee.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedSegment=e.state.selectedSegment,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(m.Component);var Fn=Object(g.b)(function(e){var t=e.segments,n=e.dispatch;return{segments:t.avalaibleSegments,dispatch:n}})(_n),xn=function(e){function t(){return Object(H.a)(this,t),Object(q.a)(this,Object(Y.a)(t).call(this,"segment"))}return Object(J.a)(t,e),Object(K.a)(t,[{key:"generateReactWidget",value:function(e,t){return m.createElement(Fn,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"segment-node"})}},{key:"getNewInstance",value:function(){return new fn}}]),t}(Q.AbstractNodeFactory),Dn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(H.a)(this,t),Object(q.a)(this,Object(Y.a)(t).call(this,e,"trigger"))}return Object(J.a)(t,e),t}(pt),Un=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,"trigger",e.id))).name=e.name,n.selectedTrigger=e.selectedTrigger,n.addPort(new Dn("right")),n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"deSerialize",value:function(e,n){Object(ct.a)(Object(Y.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedTrigger=e.selectedTrigger}},{key:"serialize",value:function(){return dt.merge(Object(ct.a)(Object(Y.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedTrigger:this.selectedTrigger})}}]),t}(Q.NodeModel),In=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,anchorElementForTooltip:null}),n.props.dispatch(Tt(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Tt(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.getTriggersInSelectableFormat=function(){return n.props.triggers.map(function(e){return{value:e.code,label:e.name}})},n.getSelectedTriggerValue=function(){var e=n.getTriggersInSelectableFormat().find(function(e){return e.value===n.props.node.selectedTrigger});return e?" - ".concat(e.label):""},n.state={nodeFormName:n.props.node.name,selectedTrigger:n.props.node.selectedTrigger,dialogOpened:!1,anchorElementForTooltip:null},n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return m.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},m.createElement("div",{className:"node-container"},m.createElement("div",{className:this.bem("__icon")},m.createElement(fe.a,null)),m.createElement("div",{className:this.bem("__ports")},m.createElement("div",{className:this.bem("__right")},m.createElement(kt,{name:"right",node:this.props.node})))),m.createElement("div",{className:this.bem("__title")},m.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Event ".concat(this.getSelectedTriggerValue()))),m.createElement(Wt,{id:this.props.node.id,isTrigger:!0,anchorElement:this.state.anchorElementForTooltip}),m.createElement(bt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},m.createElement(Nt.a,{id:"form-dialog-title"},"Trigger node"),m.createElement(yt.a,null,m.createElement(Ot.a,null,'Events are emitted on any change related to user. We recommend to combine "before" events with "Wait" operations to achieve execution at any desired time.'),m.createElement(se.a,{container:!0,spacing:32},m.createElement(se.a,{item:!0,xs:6},m.createElement(vt.a,{margin:"normal",id:"trigger-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),m.createElement(se.a,{container:!0,spacing:32},m.createElement(se.a,{item:!0,xs:12},m.createElement(nn,{options:this.getTriggersInSelectableFormat(),value:this.getTriggersInSelectableFormat().find(function(t){return t.value===e.state.selectedTrigger}),onChange:function(t){e.setState({selectedTrigger:t.value})},placeholder:"Pick one",label:"Selected Trigger"})))),m.createElement(Et.a,null,m.createElement(ee.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),m.createElement(ee.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedTrigger=e.state.selectedTrigger,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(m.Component);var Bn=Object(g.b)(function(e){return{triggers:e.triggers.avalaibleTriggers}})(In),Ln=function(e){function t(){return Object(H.a)(this,t),Object(q.a)(this,Object(Y.a)(t).call(this,"trigger"))}return Object(J.a)(t,e),Object(K.a)(t,[{key:"generateReactWidget",value:function(e,t){return m.createElement(Bn,{diagramEngine:e,node:t,classBaseName:"square-node",className:"trigger-node"})}},{key:"getNewInstance",value:function(){return new Un}}]),t}(Q.AbstractNodeFactory),zn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(H.a)(this,t),Object(q.a)(this,Object(Y.a)(t).call(this,e,"trigger_before"))}return Object(J.a)(t,e),t}(pt),An=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,"before_trigger",e.id))).name=e.name,n.selectedTrigger=e.selectedTrigger,n.time=e.time||10,n.timeUnit=e.timeUnit||"hours",n.addPort(new zn("right")),n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"deSerialize",value:function(e,n){Object(ct.a)(Object(Y.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedTrigger=e.selectedTrigger,this.time=e.time,this.timeUnit=e.timeUnit}},{key:"serialize",value:function(){return dt.merge(Object(ct.a)(Object(Y.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedTrigger:this.selectedTrigger,time:this.time,timeUnit:this.timeUnit})}}]),t}(Q.NodeModel),Wn=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,nodeFormBeforeTime:n.props.node.time,timeUnit:n.props.node.timeUnit,anchorElementForTooltip:null}),n.props.dispatch(Tt(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Tt(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.getTriggersInSelectableFormat=function(){return n.props.beforeTriggers.map(function(e){return{value:e.code,label:e.name}})},n.getSelectedTriggerValue=function(){var e=n.getTriggersInSelectableFormat().find(function(e){return e.value===n.props.node.selectedTrigger});return e?"".concat(n.props.node.time," ").concat(n.props.node.timeUnit," before - ").concat(e.label," event"):"Before Event"},n.state={nodeFormName:n.props.node.name,selectedTrigger:n.props.node.selectedTrigger,nodeFormBeforeTime:n.props.node.time,timeUnit:n.props.node.timeUnit,dialogOpened:!1,anchorElementForTooltip:null},n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return m.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},m.createElement("div",{className:"node-container"},m.createElement("div",{className:this.bem("__icon")},m.createElement(we.a,null)),m.createElement("div",{className:this.bem("__ports")},m.createElement("div",{className:this.bem("__right")},m.createElement(kt,{name:"right",node:this.props.node})))),m.createElement("div",{className:this.bem("__title")},m.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:this.getSelectedTriggerValue())),m.createElement(Wt,{id:this.props.node.id,isTrigger:!0,anchorElement:this.state.anchorElementForTooltip}),m.createElement(bt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},m.createElement(Nt.a,{id:"form-dialog-title"},"Before trigger node"),m.createElement(yt.a,null,m.createElement(Ot.a,null,"Events are emitted in advanced according to the selected time period."),m.createElement(se.a,{container:!0},m.createElement(se.a,{item:!0,xs:6},m.createElement(vt.a,{margin:"normal",id:"trigger-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),m.createElement(se.a,{container:!0},m.createElement(se.a,{item:!0,xs:12},m.createElement(Sn.a,{value:this.getTriggersInSelectableFormat().find(function(t){return t.value===e.state.selectedTrigger}),options:this.getTriggersInSelectableFormat(),getOptionLabel:function(e){return e.label},style:{marginBottom:16},onChange:function(t,n){null!==n&&e.setState({selectedTrigger:n.value})},renderInput:function(e){return m.createElement(vt.a,Object.assign({},e,{variant:"standard",label:"Trigger",fullWidth:!0}))}}))),m.createElement(se.a,{container:!0},m.createElement(se.a,{item:!0,xs:6},m.createElement(vt.a,{id:"waiting-time",label:"Before time",type:"number",fullWidth:!0,value:this.state.nodeFormBeforeTime,onChange:function(t){e.setState({nodeFormBeforeTime:t.target.value})}})),m.createElement(se.a,{item:!0,xs:6},m.createElement(cn.a,{fullWidth:!0},m.createElement(dn.a,{htmlFor:"time-unit"},"Time unit"),m.createElement(mn.a,{value:this.state.timeUnit,onChange:function(t){e.setState({timeUnit:t.target.value})},inputProps:{name:"time-unit",id:"time-unit"}},m.createElement(Jt.a,{value:"minutes"},"Minutes"),m.createElement(Jt.a,{value:"hours"},"Hours"),m.createElement(Jt.a,{value:"days"},"Days")))))),m.createElement(Et.a,null,m.createElement(ee.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),m.createElement(ee.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedTrigger=e.state.selectedTrigger,e.props.node.time=e.state.nodeFormBeforeTime,e.props.node.timeUnit=e.state.timeUnit,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(m.Component);var Rn=Object(g.b)(function(e){return{beforeTriggers:e.beforeTriggers.availableBeforeTriggers}})(Wn),Gn=function(e){function t(){return Object(H.a)(this,t),Object(q.a)(this,Object(Y.a)(t).call(this,"before_trigger"))}return Object(J.a)(t,e),Object(K.a)(t,[{key:"generateReactWidget",value:function(e,t){return m.createElement(Rn,{diagramEngine:e,node:t,classBaseName:"square-node",className:"before-trigger-node"})}},{key:"getNewInstance",value:function(){return new An}}]),t}(Q.AbstractNodeFactory),Vn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(H.a)(this,t),Object(q.a)(this,Object(Y.a)(t).call(this,e,"wait"))}return Object(J.a)(t,e),t}(pt),Hn=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,"wait",e.id))).name=e.name,n.waitingTime=e.waitingTime||10,n.waitingUnit=e.waitingUnit||"minutes",n.addPort(new Vn("left")),n.addPort(new Vn("right")),n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"deSerialize",value:function(e,n){Object(ct.a)(Object(Y.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.waitingTime=e.waitingTime,this.waitingUnit=e.waitingUnit}},{key:"serialize",value:function(){return dt.merge(Object(ct.a)(Object(Y.a)(t.prototype),"serialize",this).call(this),{name:this.name,waitingTime:this.waitingTime,waitingUnit:this.waitingUnit})}}]),t}(Q.NodeModel),Kn=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormWaitingTime:n.props.node.waitingTime,nodeFormName:n.props.node.name,timeUnit:n.props.node.waitingUnit,anchorElementForTooltip:null}),n.props.dispatch(Tt(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Tt(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.state={nodeFormWaitingTime:n.props.node.waitingTime,nodeFormName:n.props.node.name,timeUnit:n.props.node.waitingUnit,dialogOpened:!1,anchorElementForTooltip:null},n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return m.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},m.createElement("div",{className:"node-container"},m.createElement("div",{className:this.bem("__icon")},m.createElement(be.a,null)),m.createElement("div",{className:this.bem("__ports")},m.createElement("div",{className:this.bem("__left")},m.createElement(kt,{name:"left",node:this.props.node})),m.createElement("div",{className:this.bem("__right")},m.createElement(kt,{name:"right",node:this.props.node})))),m.createElement("div",{className:this.bem("__title")},m.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Wait - ".concat(this.props.node.waitingTime," ").concat(this.props.node.waitingUnit))),m.createElement(Wt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),m.createElement(bt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},m.createElement(Nt.a,{id:"form-dialog-title"},"Wait node"),m.createElement(yt.a,null,m.createElement(Ot.a,null,"Postpones the execution of next node in flow by selected amount of time."),m.createElement(se.a,{container:!0,spacing:32},m.createElement(se.a,{item:!0,xs:6},m.createElement(vt.a,{margin:"normal",id:"waiting-time",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),m.createElement(se.a,{container:!0,spacing:32},m.createElement(se.a,{item:!0,xs:6},m.createElement(vt.a,{id:"waiting-time",label:"Waiting time",type:"number",fullWidth:!0,value:this.state.nodeFormWaitingTime,onChange:function(t){e.setState({nodeFormWaitingTime:t.target.value})}})),m.createElement(se.a,{item:!0,xs:6},m.createElement(cn.a,{fullWidth:!0},m.createElement(dn.a,{htmlFor:"time-unit"},"Time unit"),m.createElement(mn.a,{value:this.state.timeUnit,onChange:function(t){e.setState({timeUnit:t.target.value})},inputProps:{name:"time-unit",id:"time-unit"}},m.createElement(Jt.a,{value:"minutes"},"Minutes"),m.createElement(Jt.a,{value:"hours"},"Hours"),m.createElement(Jt.a,{value:"days"},"Days")))))),m.createElement(Et.a,null,m.createElement(ee.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),m.createElement(ee.a,{color:"primary",onClick:function(){e.props.node.waitingTime=e.state.nodeFormWaitingTime,e.props.node.name=e.state.nodeFormName,e.props.node.waitingUnit=e.state.timeUnit,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(m.Component);var qn=Object(g.b)(function(e){return{segments:e.segments.avalaibleSegments}})(Kn),Yn=function(e){function t(){return Object(H.a)(this,t),Object(q.a)(this,Object(Y.a)(t).call(this,"wait"))}return Object(J.a)(t,e),Object(K.a)(t,[{key:"generateReactWidget",value:function(e,t){return m.createElement(qn,{diagramEngine:e,node:t,classBaseName:"round-node",className:"wait-node"})}},{key:"getNewInstance",value:function(){return new Hn}}]),t}(Q.AbstractNodeFactory),Jn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top";return Object(H.a)(this,t),Object(q.a)(this,Object(Y.a)(t).call(this,e,"goal"))}return Object(J.a)(t,e),t}(gt),Xn=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,"goal",e.id))).name=e.name,n.selectedGoals=e.selectedGoals,n.timeoutTime=e.timeoutTime,n.timeoutUnit=e.timeoutUnit,n.recheckPeriodTime=e.recheckPeriodTime,n.recheckPeriodUnit=e.recheckPeriodUnit,n.addPort(new Jn("left")),n.addPort(new Jn("bottom")),n.addPort(new Jn("right")),n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"deSerialize",value:function(e,n){Object(ct.a)(Object(Y.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedGoals=e.selectedGoals,this.timeoutTime=e.timeoutTime||"",this.timeoutUnit=e.timeoutUnit||"days",this.recheckPeriodTime=e.recheckPeriodTime||"1",this.recheckPeriodUnit=e.recheckPeriodUnit||"hours"}},{key:"serialize",value:function(){return dt.merge(Object(ct.a)(Object(Y.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedGoals:this.selectedGoals,timeoutTime:this.timeoutTime,timeoutUnit:this.timeoutUnit,recheckPeriodTime:this.recheckPeriodTime,recheckPeriodUnit:this.recheckPeriodUnit})}}]),t}(Q.NodeModel),Zn=n(172),$n=n.n(Zn),Qn=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,selectedGoals:n.props.node.selectedGoals,timeoutTime:n.props.node.timeoutTime,timeoutUnit:n.props.node.timeoutUnit,recheckPeriodTime:n.props.node.recheckPeriodTime,recheckPeriodUnit:n.props.node.recheckPeriodUnit,anchorElementForTooltip:null}),n.props.dispatch(Tt(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Tt(!0))},n.transformOptionsForSelect=function(){return n.props.goals.map(function(e){return{value:e.code,label:e.name}})},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.getFormatedValue=function(){var e={};n.props.goals.forEach(function(t){e[t.code]=t});var t=[];return void 0!==n.state.selectedGoals&&n.state.selectedGoals.forEach(function(n){t.push({value:n,label:e[n].name})}),t},n.state={nodeFormName:n.props.node.name,selectedGoals:n.props.node.selectedGoals,timeoutTime:n.props.node.timeoutTime,timeoutUnit:n.props.node.timeoutUnit,recheckPeriodTime:n.props.node.recheckPeriodTime,recheckPeriodUnit:n.props.node.recheckPeriodUnit,dialogOpened:!1,anchorElementForTooltip:null},n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return m.createElement("div",{className:this.getClassName(),onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},m.createElement("div",{className:this.bem("__title")},m.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Goal")),m.createElement("div",{className:"node-container"},m.createElement("div",{className:this.bem("__icon")},m.createElement(Se.a,null)),m.createElement("div",{className:this.bem("__ports")},m.createElement("div",{className:this.bem("__left")},m.createElement(kt,{name:"left",node:this.props.node})),m.createElement("div",{className:this.bem("__right")},m.createElement(kt,{name:"right",node:this.props.node},m.createElement(bn.a,{style:{position:"absolute",top:"-20px",right:"-20px",color:"#2ECC40"}}))),m.createElement("div",{className:this.bem("__bottom")},m.createElement(kt,{name:"bottom",node:this.props.node},m.createElement($n.a,{style:{position:"absolute",top:"8px",right:"-22px",color:"#FF695E"}}))))),m.createElement(Wt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),m.createElement(bt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},m.createElement(Nt.a,{id:"form-dialog-title"},"Goal node"),m.createElement(yt.a,null,m.createElement(Ot.a,null,"Goal node evaluates whether user has completed selected onboarding goals. Timeout value can be optionally specified, defining a point in time when evalution of completed goals is stopped. Execution flow can be directed two ways from the node - a positive direction, when all goals are completed, or a negative one, when timeout threshold is reached."),m.createElement(se.a,{container:!0,spacing:32},m.createElement(se.a,{item:!0,xs:6},m.createElement(vt.a,{margin:"normal",id:"goal-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),m.createElement(se.a,{container:!0,spacing:32},m.createElement(se.a,{item:!0,xs:12},m.createElement(nn,{options:this.transformOptionsForSelect(),value:this.getFormatedValue(),onChange:function(t){e.setState({selectedGoals:t.map(function(e){return e.value})})},isMulti:!0,placeholder:"Pick goals",label:"Selected Goal(s)"}))),m.createElement(se.a,{container:!0,spacing:32},m.createElement(se.a,{item:!0,xs:6},m.createElement(vt.a,{id:"recheck-period-time",label:"Recheck period time",type:"number",helperText:"How often goals completition should be checked",fullWidth:!0,value:this.state.recheckPeriodTime,onChange:function(t){e.setState({recheckPeriodTime:t.target.value})}})),m.createElement(se.a,{item:!0,xs:6},m.createElement(cn.a,{fullWidth:!0},m.createElement(dn.a,{htmlFor:"time-unit"},"Time unit"),m.createElement(mn.a,{value:this.state.recheckPeriodUnit,onChange:function(t){e.setState({recheckPeriodUnit:t.target.value})},inputProps:{name:"recheck-period-unit",id:"recheck-period-unit"}},m.createElement(Jt.a,{value:"minutes"},"Minutes"),m.createElement(Jt.a,{value:"hours"},"Hours"),m.createElement(Jt.a,{value:"days"},"Days"))))),m.createElement(se.a,{container:!0,spacing:32},m.createElement(se.a,{item:!0,xs:6},m.createElement(vt.a,{id:"timeout-time",label:"Timeout time",type:"number",placeholder:"No timeout",helperText:"Optionally select a timeout",fullWidth:!0,value:this.state.timeoutTime,onChange:function(t){e.setState({timeoutTime:t.target.value})}})),m.createElement(se.a,{item:!0,xs:6},m.createElement(cn.a,{fullWidth:!0},m.createElement(dn.a,{htmlFor:"time-unit"},"Time unit"),m.createElement(mn.a,{value:this.state.timeoutUnit,onChange:function(t){e.setState({timeoutUnit:t.target.value})},inputProps:{name:"time-unit",id:"time-unit"}},m.createElement(Jt.a,{value:"minutes"},"Minutes"),m.createElement(Jt.a,{value:"hours"},"Hours"),m.createElement(Jt.a,{value:"days"},"Days")))))),m.createElement(Et.a,null,m.createElement(ee.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),m.createElement(ee.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedGoals=e.state.selectedGoals,e.props.node.timeoutTime=e.state.timeoutTime,e.props.node.timeoutUnit=e.state.timeoutUnit,e.props.node.recheckPeriodTime=e.state.recheckPeriodTime,e.props.node.recheckPeriodUnit=e.state.recheckPeriodUnit,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(m.Component);var ea=Object(g.b)(function(e){var t=e.goals,n=e.dispatch;return{goals:t.availableGoals,dispatch:n}})(Qn),ta=function(e){function t(){return Object(H.a)(this,t),Object(q.a)(this,Object(Y.a)(t).call(this,"goal"))}return Object(J.a)(t,e),Object(K.a)(t,[{key:"generateReactWidget",value:function(e,t){return m.createElement(ea,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"goal-node"})}},{key:"getNewInstance",value:function(){return new Xn}}]),t}(Q.AbstractNodeFactory),na=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top";return Object(H.a)(this,t),Object(q.a)(this,Object(Y.a)(t).call(this,e,"condition"))}return Object(J.a)(t,e),t}(gt),aa=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,"condition",e.id))).name=e.name,n.conditions=e.conditions,n.addPort(new na("left")),n.addPort(new na("bottom")),n.addPort(new na("right")),n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"deSerialize",value:function(e,n){Object(ct.a)(Object(Y.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.conditions=e.conditions}},{key:"serialize",value:function(){return dt.merge(Object(ct.a)(Object(Y.a)(t.prototype),"serialize",this).call(this),{name:this.name,conditions:this.conditions})}}]),t}(Q.NodeModel),ia=n(99),ra=n(174),oa=n.n(ra),la=n(175),sa=n.n(la),ca=n(389),da=n(390),ma=n(384),ua=n(173),pa=n.n(ua);function ga(){return{id:pa()(),key:""}}function ha(e,t){return{type:"SET_NODE_VALUES",payload:{values:t,nodeId:e}}}function fa(e,t){switch(t.type){case"SET_NODE_VALUES":return Object(E.a)({},e,{nodes:e.nodes.map(function(e){return e.id===t.payload.nodeId?Object(E.a)({},e,{values:t.payload.values}):e})});case"SET_EVENT":return Object(E.a)({},e,{nodes:[ga()],event:t.payload});case"ADD_CRITERION":return Object(E.a)({},e,{nodes:[].concat(Object(qe.a)(e.nodes),[ga()])});case"DELETE_NODE":return Object(E.a)({},e,{nodes:e.nodes.filter(function(e){return e.id!==t.payload.nodeId})});case"SET_KEY_FOR_NODE":var n=e.nodes.map(function(e){return t.payload.nodeId===e.id?{id:e.id,key:t.payload.key,values:[]}:e});return Object(E.a)({},e,{nodes:n});default:throw new Error("unsupported action type "+t.type)}}var va=Object(jn.a)(function(e){return{chipRoot:function(e){return{"&:not(:first-child)":{"&::before":{content:"'"+e.operator+"'",textTransform:"uppercase",position:"absolute",left:"-20px"},marginLeft:"20px"},position:"relative"}}}});function ba(e,t){var n=new Set(e);return t.filter(function(e){var t=n.has(e.value);return t&&n.delete(e.value),t}).concat(Object(qe.a)(n))}function Ea(e){return"string"===typeof e?e:e.label}function ya(e){return"string"===typeof e?"":e.hasOwnProperty("group")?e.group:""}function Oa(e){var t=va({operator:e.params.operator});return u.a.createElement(Sn.a,{multiple:!0,ChipProps:{classes:{root:t.chipRoot}},options:e.params.options,getOptionLabel:Ea,onChange:function(t,n){e.dispatch(ha(e.node.id,{operator:e.params.operator,selection:n.map(function(e){return"string"===typeof e?e:e.value})}))},value:ba(e.node.values.selection,e.params.options),freeSolo:e.params.freeSolo,groupBy:ya,renderInput:function(t){return u.a.createElement(vt.a,Object.assign({},t,{variant:"standard",label:e.params.label,placeholder:"",fullWidth:!0}))}})}var Na=n(408),ja=n(388);function Sa(e){void 0===e.node.values.selection&&e.dispatch(ha(e.node.id,{selection:!0}));return u.a.createElement(ja.a,{onChange:function(t){e.dispatch(ha(e.node.id,{selection:t.target.checked}))},control:u.a.createElement(Na.a,null),checked:void 0!==e.node.values.selection&&e.node.values.selection,label:e.params.label})}var ka=u.a.createContext(null);function wa(e){var t=Object(m.useContext)(ka),n=e.params[e.node.key];switch(n.type){case"string_labeled_array":return u.a.createElement(Oa,{node:e.node,params:n,dispatch:t});case"boolean":return u.a.createElement(Sa,{node:e.node,params:n,dispatch:t});default:throw new Error("unsupported node type "+n.type)}}var Ta=Object(jn.a)({cardContent:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",backgroundColor:"#F2F2F2"},formControl:{minWidth:"180px"}});function Ca(e){var t=Ta(),n=Object(m.useContext)(ka);return u.a.createElement(ca.a,null,u.a.createElement(da.a,{className:t.cardContent},u.a.createElement(cn.a,{className:t.formControl},u.a.createElement(dn.a,{id:"select-criteria-label"},"Criteria"),u.a.createElement(mn.a,{labelId:"select-criteria-label",id:"select-criteria",placeholder:"Select criteria",value:e.node.key,onChange:function(t){return n((a=e.node.id,{type:"SET_KEY_FOR_NODE",payload:{key:t.target.value,nodeId:a}}));var a}},e.criteria.map(function(e){return u.a.createElement(Jt.a,{key:e.key,value:e.key},e.label)}))),u.a.createElement(ma.a,{onClick:function(){return n({type:"DELETE_NODE",payload:{nodeId:e.node.id}})},size:"small",className:t.icon,"aria-label":"delete"},u.a.createElement(oa.a,null))),e.node.key&&u.a.createElement(da.a,null,u.a.createElement(wa,{node:e.node,params:e.criteria.filter(function(t){return t.key===e.node.key})[0].params})))}var Pa=Object(jn.a)({andContainer:{display:"flex",justifyContent:"center",flexGrow:0,maxWidth:"100%",flexBasis:"100%"}});function Ma(e){var t=Pa(),n=Object(m.useContext)(ka);return u.a.createElement(u.a.Fragment,null,e.nodes.map(function(n,a){return u.a.createElement(u.a.Fragment,{key:n.id},a>=1&&u.a.createElement("div",{className:t.andContainer},"AND"),u.a.createElement(se.a,{item:!0,xs:12},u.a.createElement(Ca,{node:n,criteria:e.blueprint.criteria})))}),u.a.createElement(se.a,{item:!0,xs:12},u.a.createElement(ee.a,{onClick:function(){return n({type:"ADD_CRITERION"})},className:t.button,startIcon:u.a.createElement(sa.a,null)},"Add new criteria")))}var _a=Object(jn.a)({selectedButton:{backgroundColor:"#E4E4E4"},deselectedButton:{color:"#A6A6A6"}});var Fa=Object(m.forwardRef)(function(e,t){var n=_a(),a=Object(g.c)(function(e){return e.criteria.criteria}),i=Object(m.useReducer)(fa,Object(E.a)({version:1,event:a[0].event,nodes:[ga()]},e.conditions)),r=Object(ia.a)(i,2),o=r[0],l=r[1];return Object(m.useImperativeHandle)(t,function(){return{state:o}}),u.a.createElement(ka.Provider,{value:l},u.a.createElement(se.a,{container:!0,item:!0,xs:12,spacing:3},u.a.createElement(se.a,{item:!0,xs:12},u.a.createElement(Nn.a,{"aria-label":"outlined button group"},a.map(function(e){return u.a.createElement(ee.a,{onClick:function(){return l({type:"SET_EVENT",payload:e.event})},className:o.event===e.event?n.selectedButton:n.deselectedButton,key:e.event},e.event)}))),a.filter(function(e){return e.event===o.event}).map(function(e){return u.a.createElement(Ma,{key:e.event,blueprint:e,nodes:o.nodes})})))}),xa=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,anchorElementForTooltip:null}),n.props.dispatch(Tt(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Tt(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.builderRef=m.createRef(),n.state={nodeFormName:n.props.node.name,dialogOpened:!1,anchorElementForTooltip:null},n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return m.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},m.createElement("div",{className:this.bem("__title")},m.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Condition")),m.createElement("div",{className:"node-container"},m.createElement("div",{className:this.bem("__icon")},m.createElement(Ne.a,null)),m.createElement("div",{className:this.bem("__ports")},m.createElement("div",{className:this.bem("__left")},m.createElement(kt,{name:"left",node:this.props.node})),m.createElement("div",{className:this.bem("__right")},m.createElement(kt,{name:"right",node:this.props.node},m.createElement(bn.a,{style:{position:"absolute",top:"-20px",right:"-20px",color:"#2ECC40"}}))),m.createElement("div",{className:this.bem("__bottom")},m.createElement(kt,{name:"bottom",node:this.props.node},m.createElement(yn.a,{style:{position:"absolute",top:"8px",right:"-22px",color:"#FF695E"}}))))),m.createElement(Wt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),m.createElement(bt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},m.createElement(Nt.a,{id:"form-dialog-title"},"Event Condition"),m.createElement(yt.a,null,m.createElement(se.a,{container:!0,spacing:32},m.createElement(se.a,{style:{marginBottom:"10px"},item:!0,xs:6},m.createElement(vt.a,{margin:"normal",id:"trigger-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}})),m.createElement(Fa,{conditions:this.props.node.conditions,ref:this.builderRef}))),m.createElement(Et.a,null,m.createElement(ee.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),m.createElement(ee.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.conditions=e.builderRef.current.state,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(m.Component);var Da=Object(g.b)(function(e){return{dispatch:e.dispatch}})(xa),Ua=function(e){function t(){return Object(H.a)(this,t),Object(q.a)(this,Object(Y.a)(t).call(this,"condition"))}return Object(J.a)(t,e),Object(K.a)(t,[{key:"generateReactWidget",value:function(e,t){return m.createElement(Da,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"condition-node"})}},{key:"getNewInstance",value:function(){return new aa}}]),t}(Q.AbstractNodeFactory),Ia=function(e){function t(e){var n;return Object(H.a)(this,t),(n=Object(q.a)(this,Object(Y.a)(t).call(this,e))).saveChanges=function(){var e=n.props.dispatch;if(n.props.app.isCorruptedPayload())e(Ct({open:!0,variant:"error",text:"Cannot modify corrupted scenario."}));else{var t=new Je(n.props.app.getDiagramEngine().getDiagramModel()),a=Object(E.a)({name:n.props.scenario.name},t.exportPayload()),i=n.props.scenario.id;i&&(a.id=i),e(_t(!0)),b.a.post("".concat(xe),a).then(function(t){e(Pt(t.data.id)),e(_t(!1)),e(Ct({open:!0,variant:"success",text:"Scenario saving succeeded."}))}).catch(function(t){e(_t(!1)),e(Ct({open:!0,variant:"error",text:"Scenario saving failed."})),console.log(t)})}},n.startEditingName=function(){n.setState({editedName:n.props.scenario.name,editingName:!0})},n.cancelEditingName=function(){n.setState({editedName:"",editingName:!1})},n.submitEditingName=function(){0!==n.state.editedName.length?(n.props.dispatch(Mt(n.state.editedName)),n.setState({editedName:"",editingName:!1})):n.cancelEditingName()},n.handleCloseAndSaveDuringChangingName=function(e){27===e.keyCode?n.cancelEditingName():13===e.keyCode&&n.submitEditingName()},n.handleNameTyping=function(e){n.setState({editedName:e.target.value})},n.closeNotification=function(){n.props.dispatch(Ct({open:!1}))},n.state={editingName:!1,editedName:""},n}return Object(J.a)(t,e),Object(K.a)(t,[{key:"componentDidUpdate",value:function(e){!0===this.props.app.isCorruptedPayload()&&!1===e.app.isCorruptedPayload()&&this.props.dispatch(Ct({open:!0,variant:"error",text:"Unable to load corrupted scenario."}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.classes,u=t.canvas,p={className:"srd-demo-canvas",diagramEngine:this.props.app.getDiagramEngine(),maxNumberPointsPerLink:0,allowLooseLinks:!1,allowCanvasTranslation:u.pannable,allowCanvasZoom:u.zoomable};return m.createElement("div",{className:"body"},m.createElement("div",{className:n.root},m.createElement(ae.a,null),m.createElement(ne.a,{position:"fixed",className:n.appBar},m.createElement(ie.a,null,m.createElement(se.a,{container:!0},m.createElement(se.a,{item:!0,xs:4},m.createElement(le.a,{variant:"h6",color:"inherit",noWrap:!0},this.state.editingName?m.createElement("input",{autoFocus:!0,type:"text",value:this.state.editedName,onChange:this.handleNameTyping,onKeyDown:this.handleCloseAndSaveDuringChangingName,onBlur:this.submitEditingName,className:"changing-name-input"}):m.createElement("span",{onClick:this.startEditingName,className:"scenario-name"},this.props.scenario.name))),m.createElement(se.a,{item:!0,xs:8},m.createElement(se.a,{container:!0,direction:"row",justify:"flex-end"},!!this.props.scenario.loading&&m.createElement(de.a,{className:"circular-loading",size:19,color:"inherit"}),m.createElement(ee.a,{size:"small",variant:"contained",color:"secondary",onClick:function(){return e.saveChanges()}},this.props.scenario.id?"Update":"Save")))))),m.createElement(te.a,{className:n.drawer,variant:"permanent",classes:{paper:n.drawerPaper}},m.createElement("div",{className:n.toolbar}),m.createElement(re.a,{component:"nav",subheader:m.createElement(oe.a,{component:"div"},"Triggers")},m.createElement(Ke,{model:{type:"trigger"},name:"Event",icon:m.createElement(fe.a,null)}),m.createElement(Ke,{model:{type:"before_trigger"},name:"Before Event",icon:m.createElement(we.a,null)})),m.createElement(re.a,{component:"nav",subheader:m.createElement(oe.a,{component:"div"},"Actions")},m.createElement(Ke,{model:{type:"email"},name:"Send email",icon:m.createElement(ue.a,null)}),_e&&m.createElement(Ke,{model:{type:"banner"},name:"Show banner",icon:m.createElement(ge.a,null)})),m.createElement(re.a,{component:"nav",subheader:m.createElement(oe.a,{component:"div"},"Operations")},m.createElement(Ke,{model:{type:"segment"},name:"Segment",icon:m.createElement(ye.a,null)}),m.createElement(Ke,{model:{type:"condition"},name:"Condition",icon:m.createElement(Ne.a,null)}),m.createElement(Ke,{model:{type:"wait"},name:"Wait",icon:m.createElement(be.a,null)}),m.createElement(Ke,{model:{type:"goal"},name:"Goal",icon:m.createElement(Se.a,null)}))),m.createElement(lt,{variant:this.props.canvas.notification.variant,text:this.props.canvas.notification.text,open:this.props.canvas.notification.open,handleClose:this.closeNotification}),m.createElement("main",{className:n.content},m.createElement("div",{className:"diagram-layer",onDrop:function(t){var n=t.dataTransfer.getData("storm-diagram-node");if(n){var m=JSON.parse(n),u=null;"email"===m.type?u=new a.NodeModel({}):"banner"===m.type?u=new i.NodeModel({expiresInUnit:"days",expiresInTime:1}):"segment"===m.type?u=new r.NodeModel({}):"condition"===m.type?u=new d.NodeModel({}):"trigger"===m.type?u=new o.NodeModel({}):"before_trigger"===m.type?u=new l.NodeModel({}):"wait"===m.type?u=new s.NodeModel({}):"goal"===m.type&&(u=new c.NodeModel({recheckPeriodUnit:"hours",recheckPeriodTime:1}));var p=e.props.app.getDiagramEngine().getRelativeMousePoint(t);u.x=p.x,u.y=p.y,e.props.app.getDiagramEngine().getDiagramModel().addNode(u),e.forceUpdate()}},onDragOver:function(e){e.preventDefault()}},m.createElement(Q.DiagramWidget,p)))))}}]),t}(m.Component);var Ba=$()(Object(ce.a)(function(e){return{root:{display:"flex"},appBar:{zIndex:e.zIndex.drawer+1},drawer:{width:240,flexShrink:0},drawerPaper:{width:240},content:{flexGrow:1,padding:0},toolbar:e.mixins.toolbar}},{name:"BodyWidget"}),Object(g.b)(function(e){return{canvas:e.canvas,scenario:e.scenario}},null))(Ia),La=(n(321),n(176)),za=n.n(La);function Aa(e){return e%1440===0?{unit:"days",time:e/1440}:e%60===0?{unit:"hours",time:e/60}:{unit:"minutes",time:e}}var Wa=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(H.a)(this,e),this.activeModel=t,this.payload=n}return Object(K.a)(e,[{key:"renderPayload",value:function(e){var t=this;this.payload=e,za()(e.triggers,function(n){var a=e.visual[n.id];return t.renderElements(n,a)})}},{key:"renderElements",value:function(e,t){var n=this,d=[],m=null;if("event"===e.type)e.selectedTrigger=e.event.code,m=new o.NodeModel(e),d=e.elements.flatMap(function(e){var t=n.payload.elements[e],a=n.payload.visual[t.id],i=n.renderElements(t,a),r=m.getPort("right").link(i[0].getPort("left"));return n.activeModel.addLink(r),i});else if("before_event"===e.type){var u=Aa(e.options.minutes);e.timeUnit=u.unit,e.time=u.time,e.selectedTrigger=e.event.code,m=new l.NodeModel(e),d=e.elements.flatMap(function(e){var t=n.payload.elements[e],a=n.payload.visual[t.id],i=n.renderElements(t,a),r=m.getPort("right").link(i[0].getPort("left"));return n.activeModel.addLink(r),i})}else if("email"===e.type)e.selectedMail=e.email.code,m=new a.NodeModel(e),d=e.email.descendants.flatMap(function(e){var t=n.payload.elements[e.uuid],a=n.payload.visual[t.id],i=n.renderElements(t,a),r=m.getPort("right").link(i[0].getPort("left"));return n.activeModel.addLink(r),i});else if("banner"===e.type){if(!_e)throw Error("BANNER_ENABLED configuration is false, but loaded scenario contains banner element.");var p=Aa(e.banner.expiresInMinutes);e.expiresInUnit=p.unit,e.expiresInTime=p.time,e.selectedBanner=e.banner.id,m=new i.NodeModel(e),d=e.banner.descendants.flatMap(function(e){var t=n.payload.elements[e.uuid],a=n.payload.visual[t.id],i=n.renderElements(t,a),r=m.getPort("right").link(i[0].getPort("left"));return n.activeModel.addLink(r),i})}else if("segment"===e.type)e.selectedSegment=e.segment.code,m=new r.NodeModel(e),d=e.segment.descendants.flatMap(function(e){var t=n.payload.elements[e.uuid],a=n.payload.visual[t.id],i=n.renderElements(t,a);if(e.direction)if("positive"===e.direction){var r=m.getPort("right").link(i[0].getPort("left"));n.activeModel.addLink(r)}else if("negative"===e.direction){var o=m.getPort("bottom").link(i[0].getPort("left"));n.activeModel.addLink(o)}return i});else if("wait"===e.type){var g=Aa(e.wait.minutes);e.waitingUnit=g.unit,e.waitingTime=g.time,m=new s.NodeModel(e),d=e.wait.descendants.flatMap(function(e){var t=n.payload.elements[e.uuid],a=n.payload.visual[t.id],i=n.renderElements(t,a),r=m.getPort("right").link(i[0].getPort("left"));return n.activeModel.addLink(r),i})}else if("goal"===e.type){if(e.goal.hasOwnProperty("timeoutMinutes")){var h=Aa(e.goal.timeoutMinutes);e.timeoutUnit=h.unit,e.timeoutTime=h.time}var f=Aa(e.goal.recheckPeriodMinutes);e.recheckPeriodUnit=f.unit,e.recheckPeriodTime=f.time,e.selectedGoals=e.goal.codes,m=new c.NodeModel(e),d=e.goal.descendants.flatMap(function(e){var t=n.payload.elements[e.uuid],a=n.payload.visual[t.id],i=n.renderElements(t,a);if(e.direction)if("positive"===e.direction){var r=m.getPort("right").link(i[0].getPort("left"));n.activeModel.addLink(r)}else if("negative"===e.direction){var o=m.getPort("bottom").link(i[0].getPort("left"));n.activeModel.addLink(o)}return i})}else if("condition"===e.type){var v=this.renderCondition(e),b=Object(ia.a)(v,2);m=b[0],d=b[1]}return this.activeModel.addNode(m),m.setPosition(t.x,t.y),[m].concat(Object(qe.a)(d))}},{key:"renderCondition",value:function(e){var t=this,n=new d.NodeModel({id:e.id,name:e.name,conditions:e.condition.conditions}),a=e.condition.descendants.flatMap(function(e){var a=t.payload.elements[e.uuid],i=t.payload.visual[a.id],r=t.renderElements(a,i);if(e.direction)if("positive"===e.direction){var o=n.getPort("right").link(r[0].getPort("left"));t.activeModel.addLink(o)}else if("negative"===e.direction){var l=n.getPort("bottom").link(r[0].getPort("left"));t.activeModel.addLink(l)}return r});return[n,a]}}]),e}(),Ra=function(){function e(t){Object(H.a)(this,e),this.diagramEngine=new Q.DiagramEngine,this.diagramEngine.installDefaultFactories(),this.activeModel=new Q.DiagramModel,this.renderService=new Wa(this.activeModel),this.payload=t,this.corruptedPayload=!1,t?this.renderPayload():this.registerCustomModels()}return Object(K.a)(e,[{key:"renderPayload",value:function(){this.registerCustomModels();try{this.renderService.renderPayload(this.payload)}catch(e){console.log(e.message),this.corruptedPayload=!0,this.activeModel=new Q.DiagramModel}this.diagramEngine.setDiagramModel(this.activeModel),this.diagramEngine.repaintCanvas()}},{key:"registerCustomModels",value:function(){this.diagramEngine.registerLinkFactory(new ut),this.diagramEngine.registerPortFactory(new st("email",function(e){return new a.PortModel})),this.diagramEngine.registerNodeFactory(new a.NodeFactory),this.diagramEngine.registerPortFactory(new st("segment",function(e){return new r.PortModel})),this.diagramEngine.registerNodeFactory(new r.NodeFactory),this.diagramEngine.registerPortFactory(new st("trigger",function(e){return new o.PortModel})),this.diagramEngine.registerNodeFactory(new o.NodeFactory),this.diagramEngine.registerPortFactory(new st("before_trigger",function(e){return new l.PortModel})),this.diagramEngine.registerNodeFactory(new l.NodeFactory),this.diagramEngine.registerPortFactory(new st("wait",function(e){return new s.PortModel})),this.diagramEngine.registerNodeFactory(new s.NodeFactory),this.diagramEngine.registerPortFactory(new st("goal",function(e){return new c.PortModel})),this.diagramEngine.registerNodeFactory(new c.NodeFactory),this.diagramEngine.registerPortFactory(new st("banner",function(e){return new i.PortModel})),this.diagramEngine.registerNodeFactory(new i.NodeFactory),this.diagramEngine.registerPortFactory(new st("condition",function(e){return new d.PortModel})),this.diagramEngine.registerNodeFactory(new d.NodeFactory)}},{key:"getActiveDiagram",value:function(){return this.activeModel}},{key:"getDiagramEngine",value:function(){return this.diagramEngine}},{key:"isCorruptedPayload",value:function(){return this.corruptedPayload}}]),e}(),Ga=function(e){function t(){return Object(H.a)(this,t),Object(q.a)(this,Object(Y.a)(t).apply(this,arguments))}return Object(J.a)(t,e),Object(K.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.dispatch;e(xt()),e(Lt()),e(It()),e(Dt()),e(zt()),e(Ut()),_e&&e(Bt()),e(Me?Ft(Me):Mt("Unnamed scenario")),X.load()}},{key:"render",value:function(){var e=new Ra(this.props.scenarioPayload);return u.a.createElement(Ba,{app:e})}}]),t}(m.Component);var Va=Object(g.b)(function(e){return{scenarioPayload:e.scenario.payload}})(Ga);window.__MUI_USE_NEXT_TYPOGRAPHY_VARIANTS__=!0,b.a.defaults.headers.common.Authorization=Ce;var Ha=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||h.d,Ka=Object(h.e)(V,{},Ha(Object(h.a)(f.a)));Object(p.render)(u.a.createElement(g.a,{store:Ka},u.a.createElement(Va,null)),document.getElementById("root"))}},[[199,2,1]]]);
//# sourceMappingURL=main.4528a7e0.chunk.js.map