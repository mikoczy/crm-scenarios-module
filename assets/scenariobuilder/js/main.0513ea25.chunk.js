(this["webpackJsonpremp-scenario-builder"]=this["webpackJsonpremp-scenario-builder"]||[]).push([[0],{209:function(e,t,a){e.exports=a(357)},352:function(e,t,a){},357:function(e,t,a){"use strict";a.r(t);var n={};a.r(n),a.d(n,"NodeModel",(function(){return lt})),a.d(n,"NodeFactory",(function(){return Vt})),a.d(n,"PortModel",(function(){return ot}));var i={};a.r(i),a.d(i,"NodeModel",(function(){return Kt})),a.d(i,"NodeFactory",(function(){return Qt})),a.d(i,"PortModel",(function(){return Ht}));var s={};a.r(s),a.d(s,"NodeModel",(function(){return ea})),a.d(s,"NodeFactory",(function(){return ra})),a.d(s,"PortModel",(function(){return $t}));var r={};a.r(r),a.d(r,"NodeModel",(function(){return la})),a.d(r,"NodeFactory",(function(){return Oa})),a.d(r,"PortModel",(function(){return oa}));var o={};a.r(o),a.d(o,"NodeModel",(function(){return Fa})),a.d(o,"NodeFactory",(function(){return Pa})),a.d(o,"PortModel",(function(){return xa}));var l={};a.r(l),a.d(l,"NodeModel",(function(){return ja})),a.d(l,"NodeFactory",(function(){return Ba})),a.d(l,"PortModel",(function(){return Da}));var c={};a.r(c),a.d(c,"NodeModel",(function(){return La})),a.d(c,"NodeFactory",(function(){return Ga})),a.d(c,"PortModel",(function(){return Aa}));var d={};a.r(d),a.d(d,"NodeModel",(function(){return Va})),a.d(d,"NodeFactory",(function(){return Ja})),a.d(d,"PortModel",(function(){return Ra}));var m={};a.r(m),a.d(m,"NodeModel",(function(){return Za})),a.d(m,"NodeFactory",(function(){return In})),a.d(m,"PortModel",(function(){return Xa}));var p={};a.r(p),a.d(p,"NodeModel",(function(){return An})),a.d(p,"NodeFactory",(function(){return Wn})),a.d(p,"PortModel",(function(){return Bn}));var h=a(0),u=a.n(h),g=a(12),E=a(13),v=a(50),b=a(163),N=a(16),f=a.n(N),y=a(6),T={avalaibleSegments:[]},S={criteria:[]},C={avalaibleTriggers:[]},_={availableBeforeTriggers:[]},w={pannable:!0,zoomable:!0,notification:{open:!1,variant:"success",text:""}},O={id:null,name:"",loading:0,payload:null},x={availableMails:[]},F={generics:[]},k={availableGoals:[]},M={availableBanners:[]},P={availableTemplates:[],availableApplications:[]},D=Object(v.c)({segments:(e=T,t)=>{switch(t.type){case"segments_changed":return Object(y.a)(Object(y.a)({},e),{},{avalaibleSegments:t.payload});default:return e}},triggers:(e=C,t)=>{switch(t.type){case"triggers_changed":return Object(y.a)(Object(y.a)({},e),{},{avalaibleTriggers:t.payload});default:return e}},beforeTriggers:(e=_,t)=>{switch(t.type){case"before_triggers_changed":return Object(y.a)(Object(y.a)({},e),{},{availableBeforeTriggers:t.payload});default:return e}},canvas:(e=w,t)=>{switch(t.type){case"canvas_pannable":return Object(y.a)(Object(y.a)({},e),{},{pannable:t.payload});case"canvas_zoomable":return Object(y.a)(Object(y.a)({},e),{},{zoomable:t.payload});case"canvas_zoomable_pannable":return Object(y.a)(Object(y.a)({},e),{},{zoomable:t.payload,pannable:t.payload});case"canvas_notification":return Object(y.a)(Object(y.a)({},e),{},{notification:Object(y.a)(Object(y.a)({},e.notification),t.payload)});default:return e}},criteria:(e=S,t)=>{switch(t.type){case"criteria_changed":return Object(y.a)(Object(y.a)({},e),{},{criteria:t.payload});default:return e}},scenario:(e=O,t)=>{switch(t.type){case"set_scenario_id":return Object(y.a)(Object(y.a)({},e),{},{id:t.payload});case"set_scenario_name":return Object(y.a)(Object(y.a)({},e),{},{name:t.payload});case"set_scenario_loading":var a=e.loading;return t.payload?++a:--a,Object(y.a)(Object(y.a)({},e),{},{loading:a});case"set_scenario_payload":return Object(y.a)(Object(y.a)({},e),{},{payload:t.payload});default:return e}},mails:(e=x,t)=>{switch(t.type){case"mails_changed":return Object(y.a)(Object(y.a)({},e),{},{availableMails:t.payload});default:return e}},generics:(e=F,t)=>{switch(t.type){case"generics_changed":return Object(y.a)(Object(y.a)({},e),{},{generics:t.payload});default:return e}},goals:(e=k,t)=>{switch(t.type){case"goals_changed":return Object(y.a)(Object(y.a)({},e),{},{availableGoals:t.payload});default:return e}},banners:(e=M,t)=>{switch(t.type){case"banners_changed":return Object(y.a)(Object(y.a)({},e),{},{availableBanners:t.payload});default:return e}},pushNotifications:(e=P,t)=>{switch(t.type){case"push_notifications_changed":return Object(y.a)(Object(y.a)({},e),{},{availableTemplates:t.payload.templates,availableApplications:t.payload.applications});default:return e}}}),j=a(125),U=a(164),I=a.n(U),B=a(8),A=a(360),L=a(428),z=a(422),W=a(421),G=a(423),R=a(405),V=a(413),H=a(57),K=a(411),q=a(4),Y=a(401),J=a(76),X=a.n(J),Z=a(96),Q=a.n(Z),$=a(95),ee=a.n($),te=a(99),ae=a.n(te),ne=a(101),ie=a.n(ne),se=a(97),re=a.n(se),oe=a(103),le=a.n(oe),ce=a(102),de=a.n(ce),me=a(100),pe=a.n(me),he=a(104),ue=a.n(he),ge=window.Scenario.config,Ee=ge.AUTH_TOKEN,ve=ge.CRM_HOST,be=ge.SCENARIO_ID,Ne=ge.BANNER_ENABLED,fe=ge.PUSH_NOTIFICATION_ENABLED,ye="".concat(ve,"/api/v1/scenarios/info?id="),Te="".concat(ve,"/api/v1/scenarios/create"),Se="".concat(ve,"/api/v1/scenarios/criteria"),Ce="".concat(ve,"/api/v1/segments/list"),_e="".concat(ve,"/api/v1/events/list"),we="".concat(ve,"/api/v1/event-generators/list"),Oe="".concat(ve,"/api/v1/mail-template/list"),xe="".concat(ve,"/api/v1/scenarios/generics"),Fe="".concat(ve,"/api/v1/onboarding-goals/list"),ke="".concat(ve,"/api/v1/remp/list-banners"),Me="".concat(ve,"/api/v1/scenarios/element"),Pe="".concat(ve,"/api/v1/scenarios/trigger"),De="".concat(ve,"/api/v1/onesignal-templates/list"),je="".concat(ve,"/api/v1/onesignal-applications/list"),Ue="".concat(ve,"/segment/stored-segments/new"),Ie=a(358),Be=a(396),Ae=a(397);class Le extends h.Component{constructor(e){super(e),this.state={}}render(){return h.createElement(Ie.a,{key:this.props.name,draggable:!0,onDragStart:e=>{e.dataTransfer.setData("storm-diagram-node",JSON.stringify(this.props.model))},className:"tray-item"},h.createElement(Be.a,null,this.props.icon),h.createElement(Ae.a,{primary:this.props.name}))}}function ze(e,t){switch(t){case"minutes":return parseInt(e);case"hours":return 60*e;case"days":return 60*e*24;default:return parseInt(e)}}class We{constructor(e){this.formatDescendant=(e,t)=>{var a={uuid:e.id};return("segment"===t.type||"goal"===t.type||"condition"===t.type)&&(a.direction="right"===e.portName?"positive":"negative"),a},this.model=e}exportPayload(){var e={},t=this.model.serializeDiagram(),a=["trigger","before_trigger"];return e.triggers={},e.elements={},e.visual={},t.nodes.filter(e=>a.includes(e.type)).map(t=>e.triggers[t.id]=this.formatNode(t)),Object.entries(this.model.getNodes()).forEach(t=>{e.visual[t[0]]={x:t[1].x,y:t[1].y}}),Object.entries(this.model.getNodes()).forEach(t=>{a.includes(t[1].type)||(e.elements[t[0]]=this.formatNode(t[1].serialize()))}),e}getAllChildrenNodes(e,t="right"){return e.ports.find(e=>e.name===t).links.map(a=>{var n=null;return n=this.model.links[a].targetPort.parent.id!==e.id?this.model.links[a].targetPort.parent:this.model.links[a].sourcePort.parent,Object(y.a)(Object(y.a)({},n.serialize()),{},{portName:t})})}getPositiveAndNegativeDescendants(e){return[...this.getAllChildrenNodes(e,"right").map(t=>this.formatDescendant(t,e)),...this.getAllChildrenNodes(e,"bottom").map(t=>this.formatDescendant(t,e))]}formatNode(e){if("email"===e.type)return{id:e.id,name:e.name?e.name:"",type:"email",email:{code:e.selectedMail,descendants:this.getAllChildrenNodes(e).map(t=>this.formatDescendant(t,e))}};if("banner"===e.type)return{id:e.id,name:e.name?e.name:"",type:"banner",banner:{id:e.selectedBanner,expiresInMinutes:ze(e.expiresInTime,e.expiresInUnit),descendants:this.getAllChildrenNodes(e).map(t=>this.formatDescendant(t,e))}};if("generic"===e.type)return{id:e.id,name:e.name?e.name:"",type:"generic",generic:{code:e.selectedGeneric,descendants:this.getAllChildrenNodes(e).map(t=>this.formatDescendant(t,e))}};if("condition"===e.type)return{id:e.id,name:e.name?e.name:"",type:"condition",condition:{conditions:e.conditions,descendants:this.getPositiveAndNegativeDescendants(e)}};if("segment"===e.type)return{id:e.id,name:e.name?e.name:"",type:"segment",segment:{code:e.selectedSegment?e.selectedSegment:"all_users",descendants:this.getPositiveAndNegativeDescendants(e)}};if("trigger"===e.type)return{id:e.id,name:e.name?e.name:"",type:"event",event:{code:e.selectedTrigger?e.selectedTrigger:"user_created"},elements:this.getAllChildrenNodes(e).map(e=>e.id)};if("before_trigger"===e.type)return{id:e.id,name:e.name?e.name:"",type:"before_event",event:{code:e.selectedTrigger?e.selectedTrigger:"subscription_ends"},elements:this.getAllChildrenNodes(e).map(e=>e.id),options:{minutes:ze(e.time,e.timeUnit)}};if("wait"===e.type)return{id:e.id,name:e.name?e.name:"",type:"wait",wait:{minutes:ze(e.waitingTime,e.waitingUnit),descendants:this.getAllChildrenNodes(e).map(t=>this.formatDescendant(t,e))}};if("goal"===e.type){var t={codes:e.selectedGoals?e.selectedGoals:[],descendants:this.getPositiveAndNegativeDescendants(e),recheckPeriodMinutes:ze(e.recheckPeriodTime,e.recheckPeriodUnit)};return e.timeoutTime&&e.timeoutUnit&&(t.timeoutMinutes=ze(e.timeoutTime,e.timeoutUnit)),{id:e.id,name:e.name?e.name:"",type:"goal",goal:t}}return"push_notification"===e.type?{id:e.id,name:e.name?e.name:"",type:"push_notification",push_notification:{template:e.selectedTemplate,application:e.selectedApplication,descendants:this.getAllChildrenNodes(e).map(t=>this.formatDescendant(t,e))}}:void 0}}var Ge=a(427),Re=a(398),Ve=a(168),He=a.n(Ve),Ke=a(170),qe=a.n(Ke),Ye=a(171),Je=a.n(Ye),Xe=a(169),Ze=a.n(Xe),Qe={success:He.a,warning:Ze.a,error:qe.a,info:Je.a};class $e extends u.a.Component{render(){var e=Qe[this.props.variant];return u.a.createElement(Ge.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:this.props.open,autoHideDuration:3e3,onClose:this.props.handleClose},u.a.createElement(Re.a,{className:"toast-"+this.props.variant,message:u.a.createElement("span",{id:"client-snackbar",className:"toast__message"},u.a.createElement(e,{className:"toast__icon toast__icon-variant"}),this.props.text)}))}}var et=$e;class tt extends B.AbstractPortFactory{constructor(e,t){super(e),this.cb=t}getNewInstance(e){return this.cb(e)}}var at=a(17);class nt extends B.DefaultLinkModel{constructor(){super("custom"),this.width=3,this.curvyness=50,this.color="rgba(0,0,0,0.3)"}}class it extends B.DefaultLinkFactory{constructor(){super(),this.type="custom"}getNewInstance(e){return new nt}generateLinkSegment(e,t,a,n){return h.createElement("path",{className:a?t.bem("--path-selected"):"",strokeWidth:e.width,stroke:e.color,d:n})}}class st extends B.PortModel{constructor(e="left",t){super(e,t),this.position=e,this.in="left"===this.position}link(e){var t=this.createLinkModel();return t.setSourcePort(this),t.setTargetPort(e),t}canLinkToPort(e){return this.in!==e.in}serialize(){return at.merge(super.serialize(),{position:this.position})}deSerialize(e,t){super.deSerialize(e,t),this.position=e.position}createLinkModel(){return new nt}}class rt extends B.PortModel{constructor(e="left",t){super(e,t),this.position=e,this.in="left"===this.position}link(e){var t=this.createLinkModel();return t.setSourcePort(this),t.setTargetPort(e),t}serialize(){return at.merge(super.serialize(),{position:this.position})}canLinkToPort(e){return this.in!==e.in}deSerialize(e,t){super.deSerialize(e,t),this.position=e.position}createLinkModel(){return new nt}}class ot extends st{constructor(e="left"){super(e,"email")}}class lt extends B.NodeModel{constructor(e){super("email",e.id),this.name=e.name,this.selectedMail=e.selectedMail,this.addPort(new ot("left")),this.addPort(new ot("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.selectedMail=e.selectedMail}serialize(){return at.merge(super.serialize(),{name:this.name,selectedMail:this.selectedMail})}}var ct=a(429),dt=a(407),mt=a(412),pt=a(409),ht=a(410),ut=a(408),gt=a(172),Et=a.n(gt),vt=a(426);class bt extends B.PortWidget{constructor(e){super(e),this.state={selected:!1}}getClassName(){return"port "+super.getClassName()+(this.state.selected?this.bem("--selected"):"")}render(){return h.createElement("div",Object.assign({},this.getProps(),{onMouseEnter:()=>{this.setState({selected:!0})},onMouseLeave:()=>{this.setState({selected:!1})},"data-name":this.props.name,"data-nodeid":this.props.node.getID()}),this.props.children)}}var Nt=a(399);function ft(e){return{type:"canvas_zoomable_pannable",payload:e}}function yt(e){return{type:"canvas_notification",payload:e}}function Tt(e){return{type:"set_scenario_id",payload:e}}function St(e){return{type:"set_scenario_name",payload:e}}function Ct(e){return{type:"set_scenario_loading",payload:e}}class _t extends u.a.Component{constructor(...e){super(...e),this.state={html:null,loading:!0}}componentDidUpdate(e){this.props.scenarioID&&this.props.scenarioID!==e.scenarioID&&this.fetchStatistics()}fetchStatistics(){var e=this.props,t=e.dispatch,a=e.id,n=e.scenarioID,i=e.isTrigger;if(n){var s=i?"".concat(Pe,"?trigger_uuid=").concat(a):"".concat(Me,"?element_uuid=").concat(a);this.setState({loading:!0}),f.a.get(s).then(({data:e})=>{this.setState({html:e.html})}).catch(e=>{console.log(e),t(yt({open:!0,variant:"error",text:"Tooltip fetching failed."}))}).then(()=>{this.setState({loading:!1})})}}render(){var e=this.props.anchorElement;return this.state.html?u.a.createElement(Nt.a,{open:Boolean(e),anchorEl:e,style:{pointerEvents:"none"},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},this.state.loading&&u.a.createElement("div",{className:"node-tooltip-loader"},u.a.createElement(Y.a,{size:30})),u.a.createElement("div",{className:"node-tooltip-wrapper",dangerouslySetInnerHTML:{__html:this.state.html}})):null}}var wt=Object(E.b)((function(e){return{scenarioID:e.scenario.id}}))(_t),Ot=a(185),xt=a(173),Ft=a.n(xt),kt=a(186),Mt=a(78),Pt=a(431),Dt=a(406),jt=a(175),Ut=a.n(jt),It=a(174);function Bt(e){var t=e.inputRef,a=Object(Ot.a)(e,["inputRef"]);return u.a.createElement("div",Object.assign({ref:t},a))}var At={Control:function(e){return u.a.createElement(ct.a,Object.assign({fullWidth:!0,multiline:!0,InputProps:{inputComponent:Bt,inputProps:Object(y.a)({className:e.selectProps.classes.input,inputRef:e.innerRef,children:e.children},e.innerProps)}},e.selectProps.textFieldProps))},Menu:function(e){return u.a.createElement(Mt.a,Object.assign({square:!0,className:e.selectProps.classes.paper},e.innerProps),e.children)},MultiValue:function(e){return u.a.createElement(Pt.a,{tabIndex:-1,label:e.children,className:Ft()(e.selectProps.classes.chip,{[e.selectProps.classes.chipFocused]:e.isFocused}),onDelete:e.removeProps.onClick,deleteIcon:u.a.createElement(Ut.a,e.removeProps)})},NoOptionsMessage:function(e){return u.a.createElement(H.a,Object.assign({color:"textSecondary",className:e.selectProps.classes.noOptionsMessage},e.innerProps),e.children)},Option:function(e){return u.a.createElement(Dt.a,Object.assign({buttonRef:e.innerRef,selected:e.isFocused,component:"div",style:{fontWeight:e.isSelected?500:400}},e.innerProps),e.children)},Placeholder:function(e){return u.a.createElement(H.a,Object.assign({color:"textSecondary",className:e.selectProps.classes.placeholder},e.innerProps),e.children)},SingleValue:function(e){return u.a.createElement(H.a,Object.assign({className:e.selectProps.classes.singleValue},e.innerProps),e.children)},ValueContainer:function(e){return u.a.createElement("div",{className:e.selectProps.classes.valueContainer},e.children)}};class Lt extends u.a.Component{constructor(...e){super(...e),this.state={single:null,multi:null},this.handleChange=e=>t=>{this.setState({[e]:t})}}render(){var e=this.props,t=e.classes,a=e.theme,n={input:e=>Object(y.a)(Object(y.a)({},e),{},{color:a.palette.text.primary,"& input":{font:"inherit"}})};return u.a.createElement("div",{className:t.root},u.a.createElement(kt.a,{classes:t,styles:n,components:At,menuPosition:"fixed",textFieldProps:{label:this.props.label,InputLabelProps:{shrink:!0}},isMulti:this.props.isMulti,options:this.props.options,value:this.props.value,onChange:this.props.onChange,placeholder:this.props.placeholder}))}}Lt.defaultProp={isMulti:!1};var zt=Object(q.a)(e=>({root:{flexGrow:1,marginTop:"10px",marginBottom:"10px",fontFamily:"Roboto, Helvetica, Arial, sans-serif"},input:{display:"flex",padding:0},valueContainer:{display:"flex",flexWrap:"wrap",flex:1,alignItems:"center",overflow:"hidden"},chip:{margin:"".concat(e.spacing.unit/2,"px ").concat(e.spacing.unit/4,"px")},chipFocused:{backgroundColor:Object(It.emphasize)("light"===e.palette.type?e.palette.grey[300]:e.palette.grey[700],.08)},noOptionsMessage:{padding:"".concat(e.spacing.unit,"px ").concat(2*e.spacing.unit,"px")},singleValue:{fontSize:14},placeholder:{position:"absolute",left:2,fontSize:14},paper:{position:"absolute",zIndex:1,marginTop:e.spacing.unit,left:0,right:0},divider:{height:2*e.spacing.unit}}),{withTheme:!0})(Lt),Wt=Object(vt.a)(A.a)({marginRight:"auto"});class Gt extends h.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,anchorElementForTooltip:null}),this.props.dispatch(ft(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(ft(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.getFormatedValue=()=>{var e=this.props.mails.find(e=>e.code===this.state.selectedMail);return e?{value:e.code,label:e.name}:{}},this.transformOptionsForSelect=()=>{var e=Et()(this.props.mails,e=>e.mail_type.code),t=[];return Object.keys(e).forEach(a=>{t.push({label:e[a][0].mail_type.name,sorting:e[a][0].mail_type.sorting,options:e[a].map(e=>({value:e.code,label:e.name}))})}),t.sort((e,t)=>e.sorting-t.sorting)},this.getSelectedMailValue=()=>{var e=this.props.mails.find(e=>e.code===this.props.node.selectedMail);return e?" - ".concat(e.name):""},this.state={nodeFormName:this.props.node.name,selectedMail:this.props.node.selectedMail,dialogOpened:!1,anchorElementForTooltip:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){return h.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(X.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__left")},h.createElement(bt,{name:"left",node:this.props.node})),h.createElement("div",{className:this.bem("__right")},h.createElement(bt,{name:"right",node:this.props.node})))),h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Mail ".concat(this.getSelectedMailValue()))),h.createElement(wt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),h.createElement(dt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},h.createElement(ut.a,{id:"form-dialog-title"},"Email node"),h.createElement(pt.a,null,h.createElement(ht.a,null,"Sends an email to user."),h.createElement(K.a,{container:!0},h.createElement(K.a,{item:!0,xs:6},h.createElement(ct.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),h.createElement(K.a,{container:!0,alignItems:"center",alignContent:"space-between"},h.createElement(K.a,{item:!0,xs:12},h.createElement(zt,{options:this.transformOptionsForSelect(),value:this.getFormatedValue(),onChange:e=>{this.setState({selectedMail:e.value})},placeholder:"Pick one",label:"Selected Mail"})))),h.createElement(mt.a,null,this.props.mails.filter(e=>e.link&&e.code===this.state.selectedMail).map(e=>h.createElement(Wt,{color:"primary",href:e.link,target:"_blank"},h.createElement(X.a,{style:{marginRight:"5px"}}),"Preview")),h.createElement(A.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),h.createElement(A.a,{color:"primary",onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.selectedMail=this.state.selectedMail,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var Rt=Object(E.b)((function(e){return{mails:e.mails.availableMails}}))(Gt);class Vt extends B.AbstractNodeFactory{constructor(){super("email")}generateReactWidget(e,t){return h.createElement(Rt,{diagramEngine:e,node:t,classBaseName:"square-node",className:"email-node"})}getNewInstance(){return new lt}}class Ht extends st{constructor(e="left"){super(e,"banner")}}class Kt extends B.NodeModel{constructor(e){super("banner",e.id),this.name=e.name,this.selectedBanner=e.selectedBanner,this.expiresInTime=e.expiresInTime,this.expiresInUnit=e.expiresInUnit,this.addPort(new Ht("left")),this.addPort(new Ht("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.selectedBanner=e.selectedBanner,this.expiresInTime=e.expiresInTime||"1",this.expiresInUnit=e.expiresInUnit||"days"}serialize(){return at.merge(super.serialize(),{name:this.name,selectedBanner:this.selectedBanner,expiresInTime:this.expiresInTime,expiresInUnit:this.expiresInUnit})}}var qt=a(404),Yt=a(430),Jt=a(424);class Xt extends h.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,anchorElementForTooltip:null}),this.props.dispatch(ft(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(ft(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.getFormatedValue=()=>{var e=this.props.banners.find(e=>e.id===this.state.selectedBanner);return e?{value:e.id,label:e.name}:{}},this.transformOptionsForSelect=()=>this.props.banners.map(e=>({value:e.id,label:e.name})),this.getSelectedMailValue=()=>{var e=this.props.banners.find(e=>e.id===this.props.node.selectedBanner);return e?" - ".concat(e.name):""},this.state={nodeFormName:this.props.node.name,selectedBanner:this.props.node.selectedBanner,dialogOpened:!1,anchorElementForTooltip:null,expiresInTime:this.props.node.expiresInTime,expiresInUnit:this.props.node.expiresInUnit}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){return h.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(ee.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__left")},h.createElement(bt,{name:"left",node:this.props.node})),h.createElement("div",{className:this.bem("__right")},h.createElement(bt,{name:"right",node:this.props.node})))),h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Banner ".concat(this.getSelectedMailValue()))),h.createElement(wt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),h.createElement(dt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},h.createElement(ut.a,{id:"form-dialog-title"},"Banner node"),h.createElement(pt.a,null,h.createElement(ht.a,null,"Shows a one-time banner to user."),h.createElement(K.a,{container:!0},h.createElement(K.a,{item:!0,xs:6},h.createElement(ct.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),h.createElement(K.a,{container:!0},h.createElement(K.a,{item:!0,xs:12},h.createElement(zt,{options:this.transformOptionsForSelect(),value:this.getFormatedValue(),onChange:e=>{this.setState({selectedBanner:e.value})},placeholder:"Pick one",label:"Selected Banner"}))),h.createElement(K.a,{container:!0},h.createElement(K.a,{item:!0,xs:6},h.createElement(ct.a,{id:"expires-in-time",label:"Expires in",type:"number",helperText:"Banner is not shown after given period",fullWidth:!0,value:this.state.expiresInTime,onChange:e=>{this.setState({expiresInTime:e.target.value})}})),h.createElement(K.a,{item:!0,xs:6},h.createElement(qt.a,{fullWidth:!0},h.createElement(Yt.a,{htmlFor:"time-unit"},"Time unit"),h.createElement(Jt.a,{value:this.state.expiresInUnit,onChange:e=>{this.setState({expiresInUnit:e.target.value})},inputProps:{name:"expires-in-unit",id:"expires-in-unit"}},h.createElement(Dt.a,{value:"minutes"},"Minutes"),h.createElement(Dt.a,{value:"hours"},"Hours"),h.createElement(Dt.a,{value:"days"},"Days")))))),h.createElement(mt.a,null,h.createElement(A.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),h.createElement(A.a,{color:"primary",onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.selectedBanner=this.state.selectedBanner,this.props.node.expiresInTime=this.state.expiresInTime,this.props.node.expiresInUnit=this.state.expiresInUnit,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var Zt=Object(E.b)((function(e){return{banners:e.banners.availableBanners}}))(Xt);class Qt extends B.AbstractNodeFactory{constructor(){super("banner")}generateReactWidget(e,t){return h.createElement(Zt,{diagramEngine:e,node:t,classBaseName:"square-node",className:"banner-node"})}getNewInstance(){return new Kt}}class $t extends st{constructor(e="left"){super(e,"generic")}}class ea extends B.NodeModel{constructor(e){super("generic",e.id),this.name=e.name,this.selectedGeneric=e.selectedGeneric,this.addPort(new $t("left")),this.addPort(new $t("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.selectedGeneric=e.selectedGeneric}serialize(){return at.merge(super.serialize(),{name:this.name,selectedGeneric:this.selectedGeneric})}}var ta=a(425),aa=a(433),na=Object(aa.a)({matchFrom:"any",trim:!0,ignoreAccents:!0,ignoreCase:!0,stringify:e=>e.label+" "+e.value});class ia extends h.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,anchorElementForTooltip:null}),this.props.dispatch(ft(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(ft(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.getFormatedValue=()=>{var e=this.props.generics.find(e=>e.code===this.state.selectedGeneric);return e||null},this.transformOptionsForSelect=()=>{var e=[];return Object.keys(this.props.generics).forEach(t=>{e.push({value:this.props.generics[t].code,label:this.props.generics[t].label})}),e},this.getSelectedGenericValue=()=>{var e=this.props.generics.find(e=>e.code===this.props.node.selectedGeneric);return e?" - ".concat(e.label):""},this.state={nodeFormName:this.props.node.name,selectedGeneric:this.props.node.selectedGeneric,dialogOpened:!1,anchorElementForTooltip:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){var e=this.props.classes;return h.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(Q.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__left")},h.createElement(bt,{name:"left",node:this.props.node})),h.createElement("div",{className:this.bem("__right")},h.createElement(bt,{name:"right",node:this.props.node})))),h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Generic ".concat(this.getSelectedGenericValue()))),h.createElement(dt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},h.createElement(ut.a,{id:"form-dialog-title"},"Generic action node"),h.createElement(pt.a,null,h.createElement(ht.a,null,"Runs defined generic action."),h.createElement(K.a,{container:!0},h.createElement(K.a,{item:!0,xs:6},h.createElement(ct.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),h.createElement(K.a,{container:!0,alignItems:"center",alignContent:"space-between"},h.createElement(K.a,{item:!0,xs:12},h.createElement(ta.a,{value:this.getFormatedValue(),options:this.transformOptionsForSelect(),getOptionLabel:e=>e.label,filterOptions:na,onChange:(e,t)=>{null!==t&&this.setState({selectedGeneric:t.value})},renderInput:e=>h.createElement(ct.a,Object.assign({},e,{variant:"standard",label:"Action",fullWidth:!0})),renderOption:(t,{selected:a})=>h.createElement("div",null,h.createElement("span",{className:e.title},t.label),h.createElement("small",{className:e.subtitle},"(",t.value,")"))})))),h.createElement(mt.a,null,h.createElement(A.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),h.createElement(A.a,{color:"primary",onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.selectedGeneric=this.state.selectedGeneric,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var sa=Object(E.b)((function(e){return{generics:e.generics.generics}}))(Object(q.a)(e=>({autocomplete:{margin:e.spacing(1)},subtitle:{paddingLeft:"6px",color:e.palette.grey[600]}}))(ia));class ra extends B.AbstractNodeFactory{constructor(){super("generic")}generateReactWidget(e,t){return h.createElement(sa,{diagramEngine:e,node:t,classBaseName:"square-node",className:"generic-node"})}getNewInstance(){return new ea}}class oa extends rt{constructor(e="top"){super(e,"segment")}}class la extends B.NodeModel{constructor(e){super("segment",e.id),this.name=e.name,this.selectedSegment=e.selectedSegment,this.addPort(new oa("left")),this.addPort(new oa("bottom")),this.addPort(new oa("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.selectedSegment=e.selectedSegment}serialize(){return at.merge(super.serialize(),{name:this.name,selectedSegment:this.selectedSegment})}}var ca=a(62),da=a.n(ca),ma=a(98),pa=a.n(ma),ha=a(417),ua=a(416),ga=a(415),Ea=Object(ga.a)(e=>({autocomplete:{margin:e.spacing(1)},subtitle:{paddingLeft:"6px",color:e.palette.grey[600]}}));function va(e){return"string"===typeof e?e:e.name}function ba(e,t){return!(!t||!t.hasOwnProperty("code"))&&e.code===t.code}function Na(e,t){var a=t.filter(t=>t.code===e)[0];return a||null}var fa=Object(aa.a)({matchFrom:"any",trim:!0,ignoreAccents:!0,ignoreCase:!0,stringify:e=>e.name+" "+e.code});function ya(e){var t=Ea(),a=Object(E.c)(t=>t.segments.avalaibleSegments.filter(t=>t.table===e.selectedSegmentSourceTable))[0].segments.sort((e,t)=>e.group.sorting-t.group.sorting===0?e.group.id-t.group.id:e.group.sorting-t.group.sorting);return u.a.createElement(ta.a,{fullWidth:!0,className:t.autocomplete,value:Na(e.selectedSegment,a),options:a,getOptionSelected:ba,getOptionLabel:va,groupBy:e=>e.group.name,filterOptions:fa,onChange:(t,a)=>{e.onSegmentSelectedChange(a)},renderInput:e=>u.a.createElement(ct.a,Object.assign({},e,{variant:"standard",label:"Segment",fullWidth:!0})),renderOption:(e,{selected:a})=>u.a.createElement("div",null,u.a.createElement("span",{className:t.title},va(e)),u.a.createElement("small",{className:t.subtitle},"(",e.code,")"))})}var Ta=Object(ga.a)({selectedButton:{backgroundColor:"#E4E4E4"},deselectedButton:{color:"#A6A6A6"}});function Sa(e){var t=Ta(),a=Object(E.c)(e=>e.segments.avalaibleSegments),n=function(e,t,a){if(e)return e;if(t){var n=a.filter(e=>e.segments.filter(e=>e.code===t).length>0);return n[0]&&n[0].hasOwnProperty("table")?n[0].table:"users"}return"users"}(e.selectedSegmentSourceTable,e.selectedSegment,a);return u.a.createElement(K.a,{container:!0,item:!0,xs:12,spacing:2},u.a.createElement(K.a,{item:!0,xs:12},u.a.createElement(ua.a,{"aria-label":"outlined button group"},a.map(a=>u.a.createElement(A.a,{onClick:()=>e.onSegmentTypeButtonClick(a.table),className:n===a.table?t.selectedButton:t.deselectedButton,key:a.table},a.table)))),u.a.createElement(ya,{selectedSegment:e.selectedSegment,selectedSegmentSourceTable:n,onSegmentSelectedChange:e.onSegmentSelectedChange}))}var Ca=Object(vt.a)(A.a)({marginRight:"auto"});class _a extends h.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,selectedSegment:this.props.node.selectedSegment,anchorElementForTooltip:null}),this.props.dispatch(ft(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(ft(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.actionSetTable=e=>{this.state.selectedSegmentSourceTable!==e&&(this.setState({selectedSegment:null}),this.setState({selectedSegmentSourceTable:e}))},this.segmentSelectedChange=e=>{var t=null;e&&e.hasOwnProperty("code")&&(t=e.code),this.setState({selectedSegment:t})},this.getSelectedSegmentValue=()=>{var e=this.props.segments.flatMap(e=>e.segments).find(e=>e.code===this.props.node.selectedSegment);return e?" - ".concat(e.name):""},this.handleNewSegmentClick=()=>{window.open(Ue)},this.state={nodeFormName:this.props.node.name,selectedSegment:this.props.node.selectedSegment,dialogOpened:!1,anchorElementForTooltip:null,creatingNewSegment:!1,selectedSegmentSourceTable:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){return h.createElement("div",{className:this.getClassName(),onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Segment ".concat(this.getSelectedSegmentValue()))),h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(re.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__left")},h.createElement(bt,{name:"left",node:this.props.node})),h.createElement("div",{className:this.bem("__right")},h.createElement(bt,{name:"right",node:this.props.node},h.createElement(da.a,{style:{position:"absolute",top:"-20px",right:"-20px",color:"#2ECC40"}}))),h.createElement("div",{className:this.bem("__bottom")},h.createElement(bt,{name:"bottom",node:this.props.node},h.createElement(pa.a,{style:{position:"absolute",top:"8px",right:"-22px",color:"#FF695E"}}))))),h.createElement(wt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),h.createElement(dt.a,{fullWidth:!0,maxWidth:"md",open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},h.createElement(ut.a,{id:"form-dialog-title"},"Segment node"),h.createElement(pt.a,null,h.createElement(ht.a,null,"Segments evaluate user's presence in a group of users defined by system-provided conditions. Execution flow can be directed based on presence/absence of user within the selected segment. You can either pick one of the existing segments or create a new one."),h.createElement(K.a,{container:!0,spacing:3},h.createElement(K.a,{item:!0,xs:6},h.createElement(ct.a,{margin:"normal",id:"segment-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),h.createElement(K.a,{container:!0,spacing:3,alignItems:"flex-end"},h.createElement(K.a,{item:!0,xs:12},h.createElement(Sa,{selectedSegment:this.state.selectedSegment,selectedSegmentSourceTable:this.state.selectedSegmentSourceTable,onSegmentTypeButtonClick:this.actionSetTable,onSegmentSelectedChange:this.segmentSelectedChange})))),h.createElement(mt.a,null,h.createElement(Ca,{color:"primary",onClick:this.handleNewSegmentClick},h.createElement(ha.a,{style:{marginRight:"5px"}},"add_circle"),"New segment"),h.createElement(A.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),h.createElement(A.a,{color:"primary",onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.selectedSegment=this.state.selectedSegment,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var wa=Object(E.b)((function(e){var t=e.segments,a=e.dispatch;return{segments:t.avalaibleSegments,dispatch:a}}))(_a);class Oa extends B.AbstractNodeFactory{constructor(){super("segment")}generateReactWidget(e,t){return h.createElement(wa,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"segment-node"})}getNewInstance(){return new la}}class xa extends st{constructor(e="left"){super(e,"trigger")}}class Fa extends B.NodeModel{constructor(e){super("trigger",e.id),this.name=e.name,this.selectedTrigger=e.selectedTrigger,this.addPort(new xa("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.selectedTrigger=e.selectedTrigger}serialize(){return at.merge(super.serialize(),{name:this.name,selectedTrigger:this.selectedTrigger})}}class ka extends h.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,anchorElementForTooltip:null}),this.props.dispatch(ft(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(ft(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.getTriggersInSelectableFormat=()=>this.props.triggers.map(e=>({value:e.code,label:e.name})),this.getSelectedTriggerValue=()=>{var e=this.getTriggersInSelectableFormat().find(e=>e.value===this.props.node.selectedTrigger);return e?" - ".concat(e.label):""},this.state={nodeFormName:this.props.node.name,selectedTrigger:this.props.node.selectedTrigger,dialogOpened:!1,anchorElementForTooltip:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){return h.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(ae.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__right")},h.createElement(bt,{name:"right",node:this.props.node})))),h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Event ".concat(this.getSelectedTriggerValue()))),h.createElement(wt,{id:this.props.node.id,isTrigger:!0,anchorElement:this.state.anchorElementForTooltip}),h.createElement(dt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},h.createElement(ut.a,{id:"form-dialog-title"},"Event node"),h.createElement(pt.a,null,h.createElement(ht.a,null,'Events are emitted on any change related to user. We recommend to combine "before" events with "Wait" operations to achieve execution at any desired time.'),h.createElement(K.a,{container:!0},h.createElement(K.a,{item:!0,xs:6},h.createElement(ct.a,{margin:"normal",id:"trigger-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),h.createElement(K.a,{container:!0},h.createElement(K.a,{item:!0,xs:12},h.createElement(ta.a,{value:this.getTriggersInSelectableFormat().find(e=>e.value===this.state.selectedTrigger),options:this.getTriggersInSelectableFormat(),getOptionLabel:e=>e.label,style:{marginTop:16},onChange:(e,t)=>{null!==t&&this.setState({selectedTrigger:t.value})},renderInput:e=>h.createElement(ct.a,Object.assign({},e,{variant:"standard",label:"Trigger",fullWidth:!0}))})))),h.createElement(mt.a,null,h.createElement(A.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),h.createElement(A.a,{color:"primary",onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.selectedTrigger=this.state.selectedTrigger,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var Ma=Object(E.b)((function(e){return{triggers:e.triggers.avalaibleTriggers}}))(ka);class Pa extends B.AbstractNodeFactory{constructor(){super("trigger")}generateReactWidget(e,t){return h.createElement(Ma,{diagramEngine:e,node:t,classBaseName:"square-node",className:"trigger-node"})}getNewInstance(){return new Fa}}class Da extends st{constructor(e="left"){super(e,"trigger_before")}}class ja extends B.NodeModel{constructor(e){super("before_trigger",e.id),this.name=e.name,this.selectedTrigger=e.selectedTrigger,this.time=void 0!==e.time?e.time:10,this.timeUnit=void 0!==e.timeUnit?e.timeUnit:"hours",this.addPort(new Da("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.selectedTrigger=e.selectedTrigger,this.time=e.time,this.timeUnit=e.timeUnit}serialize(){return at.merge(super.serialize(),{name:this.name,selectedTrigger:this.selectedTrigger,time:this.time,timeUnit:this.timeUnit})}}class Ua extends h.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,nodeFormBeforeTime:this.props.node.time,timeUnit:this.props.node.timeUnit,anchorElementForTooltip:null}),this.props.dispatch(ft(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(ft(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.getTriggersInSelectableFormat=()=>this.props.beforeTriggers.map(e=>({value:e.code,label:e.name})),this.getSelectedTriggerValue=()=>{var e=this.getTriggersInSelectableFormat().find(e=>e.value===this.props.node.selectedTrigger);return e?"".concat(this.props.node.time," ").concat(this.props.node.timeUnit," before - ").concat(e.label," event"):"Before Event"},this.state={nodeFormName:this.props.node.name,selectedTrigger:this.props.node.selectedTrigger,nodeFormBeforeTime:this.props.node.time,timeUnit:this.props.node.timeUnit,dialogOpened:!1,anchorElementForTooltip:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){return h.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(pe.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__right")},h.createElement(bt,{name:"right",node:this.props.node})))),h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:this.getSelectedTriggerValue())),h.createElement(wt,{id:this.props.node.id,isTrigger:!0,anchorElement:this.state.anchorElementForTooltip}),h.createElement(dt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},h.createElement(ut.a,{id:"form-dialog-title"},"Before event node"),h.createElement(pt.a,null,h.createElement(ht.a,null,"Events are emitted in advanced of trigger according to selected time period."),h.createElement(K.a,{container:!0},h.createElement(K.a,{item:!0,xs:6},h.createElement(ct.a,{margin:"normal",id:"trigger-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),h.createElement(K.a,{container:!0},h.createElement(K.a,{item:!0,xs:12},h.createElement(ta.a,{value:this.getTriggersInSelectableFormat().find(e=>e.value===this.state.selectedTrigger),options:this.getTriggersInSelectableFormat(),getOptionLabel:e=>e.label,style:{marginBottom:16},onChange:(e,t)=>{null!==t&&this.setState({selectedTrigger:t.value})},renderInput:e=>h.createElement(ct.a,Object.assign({},e,{variant:"standard",label:"Trigger",fullWidth:!0}))}))),h.createElement(K.a,{container:!0},h.createElement(K.a,{item:!0,xs:6},h.createElement(ct.a,{id:"waiting-time",label:"Before time",type:"number",fullWidth:!0,value:this.state.nodeFormBeforeTime,onChange:e=>{this.setState({nodeFormBeforeTime:e.target.value})}})),h.createElement(K.a,{item:!0,xs:6},h.createElement(qt.a,{fullWidth:!0},h.createElement(Yt.a,{htmlFor:"time-unit"},"Time unit"),h.createElement(Jt.a,{value:this.state.timeUnit,onChange:e=>{this.setState({timeUnit:e.target.value})},inputProps:{name:"time-unit",id:"time-unit"}},h.createElement(Dt.a,{value:"minutes"},"Minutes"),h.createElement(Dt.a,{value:"hours"},"Hours"),h.createElement(Dt.a,{value:"days"},"Days")))))),h.createElement(mt.a,null,h.createElement(A.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),h.createElement(A.a,{color:"primary",onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.selectedTrigger=this.state.selectedTrigger,this.props.node.time=this.state.nodeFormBeforeTime,this.props.node.timeUnit=this.state.timeUnit,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var Ia=Object(E.b)((function(e){return{beforeTriggers:e.beforeTriggers.availableBeforeTriggers}}))(Ua);class Ba extends B.AbstractNodeFactory{constructor(){super("before_trigger")}generateReactWidget(e,t){return h.createElement(Ia,{diagramEngine:e,node:t,classBaseName:"square-node",className:"before-trigger-node"})}getNewInstance(){return new ja}}class Aa extends st{constructor(e="left"){super(e,"wait")}}class La extends B.NodeModel{constructor(e){super("wait",e.id),this.name=e.name,this.waitingTime=void 0!==e.waitingTime?e.waitingTime:10,this.waitingUnit=void 0!==e.waitingUnit?e.waitingUnit:"minutes",this.addPort(new Aa("left")),this.addPort(new Aa("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.waitingTime=e.waitingTime,this.waitingUnit=e.waitingUnit}serialize(){return at.merge(super.serialize(),{name:this.name,waitingTime:this.waitingTime,waitingUnit:this.waitingUnit})}}class za extends h.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormWaitingTime:this.props.node.waitingTime,nodeFormName:this.props.node.name,timeUnit:this.props.node.waitingUnit,anchorElementForTooltip:null}),this.props.dispatch(ft(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(ft(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.state={nodeFormWaitingTime:this.props.node.waitingTime,nodeFormName:this.props.node.name,timeUnit:this.props.node.waitingUnit,dialogOpened:!1,anchorElementForTooltip:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){return h.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(ie.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__left")},h.createElement(bt,{name:"left",node:this.props.node})),h.createElement("div",{className:this.bem("__right")},h.createElement(bt,{name:"right",node:this.props.node})))),h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Wait - ".concat(this.props.node.waitingTime," ").concat(this.props.node.waitingUnit))),h.createElement(wt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),h.createElement(dt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},h.createElement(ut.a,{id:"form-dialog-title"},"Wait node"),h.createElement(pt.a,null,h.createElement(ht.a,null,"Postpones the execution of next node in flow by selected amount of time."),h.createElement(K.a,{container:!0},h.createElement(K.a,{item:!0,xs:6},h.createElement(ct.a,{margin:"normal",id:"waiting-time",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),h.createElement(K.a,{container:!0},h.createElement(K.a,{item:!0,xs:6},h.createElement(ct.a,{id:"waiting-time",label:"Waiting time",type:"number",fullWidth:!0,value:this.state.nodeFormWaitingTime,onChange:e=>{this.setState({nodeFormWaitingTime:e.target.value})}})),h.createElement(K.a,{item:!0,xs:6},h.createElement(qt.a,{fullWidth:!0},h.createElement(Yt.a,{htmlFor:"time-unit"},"Time unit"),h.createElement(Jt.a,{value:this.state.timeUnit,onChange:e=>{this.setState({timeUnit:e.target.value})},inputProps:{name:"time-unit",id:"time-unit"}},h.createElement(Dt.a,{value:"minutes"},"Minutes"),h.createElement(Dt.a,{value:"hours"},"Hours"),h.createElement(Dt.a,{value:"days"},"Days")))))),h.createElement(mt.a,null,h.createElement(A.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),h.createElement(A.a,{color:"primary",onClick:()=>{this.props.node.waitingTime=this.state.nodeFormWaitingTime,this.props.node.name=this.state.nodeFormName,this.props.node.waitingUnit=this.state.timeUnit,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var Wa=Object(E.b)((function(e){return{segments:e.segments.avalaibleSegments}}))(za);class Ga extends B.AbstractNodeFactory{constructor(){super("wait")}generateReactWidget(e,t){return h.createElement(Wa,{diagramEngine:e,node:t,classBaseName:"round-node",className:"wait-node"})}getNewInstance(){return new La}}class Ra extends rt{constructor(e="top"){super(e,"goal")}}class Va extends B.NodeModel{constructor(e){super("goal",e.id),this.name=e.name,this.selectedGoals=e.selectedGoals,this.timeoutTime=e.timeoutTime,this.timeoutUnit=e.timeoutUnit,this.recheckPeriodTime=e.recheckPeriodTime,this.recheckPeriodUnit=e.recheckPeriodUnit,this.addPort(new Ra("left")),this.addPort(new Ra("bottom")),this.addPort(new Ra("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.selectedGoals=e.selectedGoals,this.timeoutTime=null!==e.timeoutTime&&void 0!==e.timeoutTime?e.timeoutTime:"",this.timeoutUnit=null!==e.timeoutUnit&&void 0!==e.timeoutUnit?e.timeoutUnit:"days",this.recheckPeriodTime=null!==e.recheckPeriodTime&&void 0!==e.recheckPeriodTime?e.recheckPeriodTime:"1",this.recheckPeriodUnit=null!==e.recheckPeriodUnit&&void 0!==e.recheckPeriodUnit?e.recheckPeriodUnit:"hours"}serialize(){return at.merge(super.serialize(),{name:this.name,selectedGoals:this.selectedGoals,timeoutTime:this.timeoutTime,timeoutUnit:this.timeoutUnit,recheckPeriodTime:this.recheckPeriodTime,recheckPeriodUnit:this.recheckPeriodUnit})}}var Ha=a(180),Ka=a.n(Ha);class qa extends h.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,selectedGoals:this.props.node.selectedGoals,timeoutTime:this.props.node.timeoutTime,timeoutUnit:this.props.node.timeoutUnit,recheckPeriodTime:this.props.node.recheckPeriodTime,recheckPeriodUnit:this.props.node.recheckPeriodUnit,anchorElementForTooltip:null}),this.props.dispatch(ft(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(ft(!0))},this.transformOptionsForSelect=()=>this.props.goals.map(e=>({value:e.code,label:e.name})),this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.getFormatedValue=()=>{var e={};this.props.goals.forEach(t=>{e[t.code]=t});var t=[];return void 0!==this.state.selectedGoals&&this.state.selectedGoals.forEach(a=>{t.push({value:a,label:e[a].name})}),t},this.state={nodeFormName:this.props.node.name,selectedGoals:this.props.node.selectedGoals,timeoutTime:this.props.node.timeoutTime,timeoutUnit:this.props.node.timeoutUnit,recheckPeriodTime:this.props.node.recheckPeriodTime,recheckPeriodUnit:this.props.node.recheckPeriodUnit,dialogOpened:!1,anchorElementForTooltip:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){return h.createElement("div",{className:this.getClassName(),onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Goal")),h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(de.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__left")},h.createElement(bt,{name:"left",node:this.props.node})),h.createElement("div",{className:this.bem("__right")},h.createElement(bt,{name:"right",node:this.props.node},h.createElement(da.a,{style:{position:"absolute",top:"-20px",right:"-20px",color:"#2ECC40"}}))),h.createElement("div",{className:this.bem("__bottom")},h.createElement(bt,{name:"bottom",node:this.props.node},h.createElement(Ka.a,{style:{position:"absolute",top:"8px",right:"-22px",color:"#FF695E"}}))))),h.createElement(wt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),h.createElement(dt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},h.createElement(ut.a,{id:"form-dialog-title"},"Goal node"),h.createElement(pt.a,null,h.createElement(ht.a,null,"Goal node evaluates whether user has completed selected onboarding goals. Timeout value can be optionally specified, defining a point in time when evalution of completed goals is stopped. Execution flow can be directed two ways from the node - a positive direction, when all goals are completed, or a negative one, when timeout threshold is reached."),h.createElement(K.a,{container:!0},h.createElement(K.a,{item:!0,xs:6},h.createElement(ct.a,{margin:"normal",id:"goal-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),h.createElement(K.a,{container:!0},h.createElement(K.a,{item:!0,xs:12},h.createElement(zt,{options:this.transformOptionsForSelect(),value:this.getFormatedValue(),onChange:e=>{this.setState({selectedGoals:e.map(e=>e.value)})},isMulti:!0,placeholder:"Pick goals",label:"Selected Goal(s)"}))),h.createElement(K.a,{container:!0},h.createElement(K.a,{item:!0,xs:6},h.createElement(ct.a,{id:"recheck-period-time",label:"Recheck period time",type:"number",helperText:"How often goals completition should be checked",fullWidth:!0,value:this.state.recheckPeriodTime,onChange:e=>{this.setState({recheckPeriodTime:e.target.value})}})),h.createElement(K.a,{item:!0,xs:6},h.createElement(qt.a,{fullWidth:!0},h.createElement(Yt.a,{htmlFor:"time-unit"},"Time unit"),h.createElement(Jt.a,{value:this.state.recheckPeriodUnit,onChange:e=>{this.setState({recheckPeriodUnit:e.target.value})},inputProps:{name:"recheck-period-unit",id:"recheck-period-unit"}},h.createElement(Dt.a,{value:"minutes"},"Minutes"),h.createElement(Dt.a,{value:"hours"},"Hours"),h.createElement(Dt.a,{value:"days"},"Days"))))),h.createElement(K.a,{container:!0},h.createElement(K.a,{item:!0,xs:6},h.createElement(ct.a,{id:"timeout-time",label:"Timeout time",type:"number",placeholder:"No timeout",helperText:"Optionally select a timeout",fullWidth:!0,value:this.state.timeoutTime,onChange:e=>{this.setState({timeoutTime:e.target.value})}})),h.createElement(K.a,{item:!0,xs:6},h.createElement(qt.a,{fullWidth:!0},h.createElement(Yt.a,{htmlFor:"time-unit"},"Time unit"),h.createElement(Jt.a,{value:this.state.timeoutUnit,onChange:e=>{this.setState({timeoutUnit:e.target.value})},inputProps:{name:"time-unit",id:"time-unit"}},h.createElement(Dt.a,{value:"minutes"},"Minutes"),h.createElement(Dt.a,{value:"hours"},"Hours"),h.createElement(Dt.a,{value:"days"},"Days")))))),h.createElement(mt.a,null,h.createElement(A.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),h.createElement(A.a,{color:"primary",onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.selectedGoals=this.state.selectedGoals,this.props.node.timeoutTime=this.state.timeoutTime,this.props.node.timeoutUnit=this.state.timeoutUnit,this.props.node.recheckPeriodTime=this.state.recheckPeriodTime,this.props.node.recheckPeriodUnit=this.state.recheckPeriodUnit,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var Ya=Object(E.b)((function(e){var t=e.goals,a=e.dispatch;return{goals:t.availableGoals,dispatch:a}}))(qa);class Ja extends B.AbstractNodeFactory{constructor(){super("goal")}generateReactWidget(e,t){return h.createElement(Ya,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"goal-node"})}getNewInstance(){return new Va}}class Xa extends rt{constructor(e="top"){super(e,"condition")}}class Za extends B.NodeModel{constructor(e){super("condition",e.id),this.name=e.name,this.conditions=e.conditions,this.addPort(new Xa("left")),this.addPort(new Xa("bottom")),this.addPort(new Xa("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.conditions=e.conditions}serialize(){return at.merge(super.serialize(),{name:this.name,conditions:this.conditions})}}var Qa=a(77),$a=a(182),en=a.n($a),tn=a(183),an=a.n(tn),nn=a(419),sn=a(420),rn=a(414);function on(e,t){return{type:"SET_PARAM_VALUES",payload:{name:e,values:t}}}function ln(e,t){return{type:"UPDATE_PARAM_VALUES",payload:{name:e,values:t}}}var cn=Object(ga.a)(e=>({chipRoot:e=>({"&:not(:first-child)":{"&::before":{content:"'"+e.operator+"'",textTransform:"uppercase",position:"absolute",left:"-20px"},marginLeft:"20px"},position:"relative"}),subtitle:{paddingLeft:"6px",color:e.palette.grey[600]}}));function dn(e,t){var a=new Set(e);return t.filter(e=>{var t=a.has(e.value);return t&&a.delete(e.value),t}).concat([...a])}function mn(e){return"string"===typeof e?e:e.label}function pn(e){return"string"===typeof e?"":void 0!==e.subtitle?e.subtitle:""}function hn(e){return"string"===typeof e?"":e.hasOwnProperty("group")?e.group:""}var un=Object(aa.a)({matchFrom:"any",trim:!0,ignoreAccents:!0,ignoreCase:!0,stringify:e=>mn(e)+" "+pn(e)});function gn(e){var t=cn({operator:e.blueprint.operator});return u.a.createElement(ta.a,{multiple:!0,disableCloseOnSelect:!0,ChipProps:{classes:{root:t.chipRoot}},options:e.blueprint.options,getOptionLabel:mn,onChange:(t,a)=>{e.dispatch(on(e.name,{operator:e.blueprint.operator,selection:a.map(e=>"string"===typeof e?e:e.value)}))},value:dn(e.values.selection,e.blueprint.options),freeSolo:e.blueprint.freeSolo,groupBy:hn,filterOptions:un,renderInput:t=>u.a.createElement(ct.a,Object.assign({},t,{variant:"standard",label:e.blueprint.label,placeholder:"",fullWidth:!0})),renderOption:(e,{selected:a})=>u.a.createElement(u.a.Fragment,null,mn(e),u.a.createElement("small",{className:t.subtitle},pn(e)))})}var En=a(434),vn=a(418);function bn(e){void 0===e.values.selection&&e.dispatch(on(e.name,{selection:!0}));return u.a.createElement(vn.a,{onChange:t=>{e.dispatch(on(e.name,{selection:t.target.checked}))},control:u.a.createElement(En.a,null),checked:void 0!==e.values.selection&&e.values.selection,label:e.blueprint.label})}var Nn=Object(ga.a)(e=>({formControl:{margin:e.spacing(1),minWidth:100},numberInput:{margin:e.spacing(1)}}));function fn(e){var t,a,n,i=Nn();void 0===e.values.operator&&1===e.blueprint.operators.length&&e.dispatch(on(e.name,{operator:e.blueprint.operators[0]}));return u.a.createElement(u.a.Fragment,null,u.a.createElement(qt.a,{className:i.formControl,disabled:1===e.blueprint.operators.length},u.a.createElement(Yt.a,null,"Operator"),u.a.createElement(Jt.a,{autoWidth:!0,value:null!==(t=e.values.operator)&&void 0!==t?t:"",onChange:t=>{e.dispatch(ln(e.name,{operator:t.target.value}))}},e.blueprint.operators.map(e=>u.a.createElement(Dt.a,{key:e,value:e},e)))),u.a.createElement(ct.a,{className:i.numberInput,label:e.blueprint.unit,type:"number",onChange:t=>{e.dispatch(ln(e.name,{selection:t.target.value}))},value:null!==(a=e.values.selection)&&void 0!==a?a:"",inputProps:null!==(n=e.blueprint.numberInputAttributes)&&void 0!==n?n:{}}))}var yn=a(181),Tn=a.n(yn);function Sn(){return{id:Tn()(),key:"",params:[]}}function Cn(e,t){switch(t.type){case"UPDATE_PARAM_VALUES":var a=Object(Qa.a)(t.payload.name,2),n=a[0],i=a[1];return Object(y.a)(Object(y.a)({},e),{},{nodes:e.nodes.map(e=>e.id===n?Object(y.a)(Object(y.a)({},e),{},{params:e.params.map(e=>e.key===i?Object(y.a)(Object(y.a)({},e),{},{values:Object.assign(e.values,t.payload.values)}):e)}):e)});case"SET_PARAM_VALUES":var s=Object(Qa.a)(t.payload.name,2),r=s[0],o=s[1];return Object(y.a)(Object(y.a)({},e),{},{nodes:e.nodes.map(e=>e.id===r?Object(y.a)(Object(y.a)({},e),{},{params:e.params.map(e=>e.key===o?Object(y.a)(Object(y.a)({},e),{},{values:t.payload.values}):e)}):e)});case"SET_EVENT":return Object(y.a)(Object(y.a)({},e),{},{nodes:[Sn()],event:t.payload});case"ADD_CRITERION":return Object(y.a)(Object(y.a)({},e),{},{nodes:[...e.nodes,Sn()]});case"DELETE_NODE":return Object(y.a)(Object(y.a)({},e),{},{nodes:e.nodes.filter(e=>e.id!==t.payload.nodeId)});case"SET_KEY_FOR_NODE":var l=e.nodes.map(e=>t.payload.nodeId===e.id?{id:e.id,key:t.payload.key,params:t.payload.params}:e);return Object(y.a)(Object(y.a)({},e),{},{nodes:l});default:throw new Error("unsupported action type "+t.type)}}var _n=u.a.createContext(null);function wn(e){var t=Object(h.useContext)(_n),a=e.node.params.filter(t=>t.key===e.blueprint.key)[0],n=[e.node.id,a.key];switch(e.blueprint.type){case"string_labeled_array":return u.a.createElement(gn,{name:n,values:a.values,blueprint:e.blueprint,dispatch:t});case"boolean":return u.a.createElement(bn,{name:n,values:a.values,blueprint:e.blueprint,dispatch:t});case"number":return u.a.createElement(fn,{name:n,values:a.values,blueprint:e.blueprint,dispatch:t});default:throw new Error("unsupported node type "+e.blueprint.type)}}function On(e){return u.a.createElement(u.a.Fragment,null,e.blueprint.map(t=>u.a.createElement(wn,{key:t.key,node:e.node,blueprint:t})))}var xn=Object(ga.a)({cardContent:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",backgroundColor:"#F2F2F2"},formControl:{minWidth:"180px"}});function Fn(e){var t=xn(),a=Object(h.useContext)(_n);return u.a.createElement(nn.a,null,u.a.createElement(sn.a,{className:t.cardContent},u.a.createElement(qt.a,{className:t.formControl},u.a.createElement(Yt.a,{id:"select-criteria-label"},"Criterion"),u.a.createElement(Jt.a,{labelId:"select-criteria-label",id:"select-criteria",placeholder:"Select criteria",value:e.node.key,onChange:t=>{var n,i=e.criteriaBlueprint.filter(e=>e.key===t.target.value)[0].params.map(e=>({key:e.key,values:{}}));a((n=e.node.id,{type:"SET_KEY_FOR_NODE",payload:{key:t.target.value,nodeId:n,params:i}}))}},e.criteriaBlueprint.map(e=>u.a.createElement(Dt.a,{key:e.key,value:e.key},e.label)))),u.a.createElement(rn.a,{onClick:()=>a({type:"DELETE_NODE",payload:{nodeId:e.node.id}}),size:"small",className:t.icon,"aria-label":"delete"},u.a.createElement(en.a,null))),e.node.key&&u.a.createElement(sn.a,null,u.a.createElement(On,{node:e.node,blueprint:e.criteriaBlueprint.filter(t=>t.key===e.node.key)[0].params})))}var kn=Object(ga.a)({andContainer:{display:"flex",justifyContent:"center",flexGrow:0,maxWidth:"100%",flexBasis:"100%"}});function Mn(e){var t=kn(),a=Object(h.useContext)(_n);return u.a.createElement(u.a.Fragment,null,e.nodes.map((a,n)=>u.a.createElement(u.a.Fragment,{key:a.id},n>=1&&u.a.createElement("div",{className:t.andContainer},"AND"),u.a.createElement(K.a,{item:!0,xs:12},u.a.createElement(Fn,{node:a,criteriaBlueprint:e.criteriaBlueprint})))),u.a.createElement(K.a,{item:!0,xs:12},u.a.createElement(A.a,{onClick:()=>a({type:"ADD_CRITERION"}),className:t.button,startIcon:u.a.createElement(an.a,null)},"Add new criterion")))}var Pn=Object(ga.a)({selectedButton:{backgroundColor:"#E4E4E4"},deselectedButton:{color:"#A6A6A6"}});var Dn=Object(h.forwardRef)((function(e,t){var a=Pn(),n=Object(E.c)(e=>e.criteria.criteria),i=Object(h.useReducer)(Cn,Object(y.a)({version:1,event:n[0].event,nodes:[Sn()]},e.conditions)),s=Object(Qa.a)(i,2),r=s[0],o=s[1];return Object(h.useImperativeHandle)(t,()=>({state:r})),u.a.createElement(_n.Provider,{value:o},u.a.createElement(K.a,{container:!0,item:!0,xs:12,spacing:3},u.a.createElement(K.a,{item:!0,xs:12},u.a.createElement(ua.a,{"aria-label":"outlined button group"},n.map(e=>u.a.createElement(A.a,{onClick:()=>o({type:"SET_EVENT",payload:e.event}),className:r.event===e.event?a.selectedButton:a.deselectedButton,key:e.event},e.event)))),n.filter(e=>e.event===r.event).map(e=>u.a.createElement(Mn,{key:e.event,criteriaBlueprint:e.criteria,nodes:r.nodes}))))}));class jn extends h.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,anchorElementForTooltip:null}),this.props.dispatch(ft(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(ft(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.builderRef=h.createRef(),this.state={nodeFormName:this.props.node.name,dialogOpened:!1,anchorElementForTooltip:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){return h.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Condition")),h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(le.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__left")},h.createElement(bt,{name:"left",node:this.props.node})),h.createElement("div",{className:this.bem("__right")},h.createElement(bt,{name:"right",node:this.props.node},h.createElement(da.a,{style:{position:"absolute",top:"-20px",right:"-20px",color:"#2ECC40"}}))),h.createElement("div",{className:this.bem("__bottom")},h.createElement(bt,{name:"bottom",node:this.props.node},h.createElement(pa.a,{style:{position:"absolute",top:"8px",right:"-22px",color:"#FF695E"}}))))),h.createElement(wt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),h.createElement(dt.a,{fullWidth:!0,maxWidth:"md",open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},h.createElement(ut.a,{id:"form-dialog-title"},"Event Condition"),h.createElement(pt.a,null,h.createElement(K.a,{container:!0},h.createElement(K.a,{style:{marginBottom:"10px"},item:!0,xs:6},h.createElement(ct.a,{margin:"normal",id:"trigger-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}})),h.createElement(Dn,{conditions:this.props.node.conditions,ref:this.builderRef}))),h.createElement(mt.a,null,h.createElement(A.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),h.createElement(A.a,{color:"primary",onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.conditions=this.builderRef.current.state,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var Un=Object(E.b)((function(e){return{dispatch:e.dispatch}}))(jn);class In extends B.AbstractNodeFactory{constructor(){super("condition")}generateReactWidget(e,t){return h.createElement(Un,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"condition-node"})}getNewInstance(){return new Za}}class Bn extends st{constructor(e="left"){super(e,"push_notification")}}class An extends B.NodeModel{constructor(e){super("push_notification",e.id),this.name=e.name,this.selectedTemplate=e.selectedTemplate,this.selectedApplication=e.selectedApplication,this.addPort(new Bn("left")),this.addPort(new Bn("right"))}deSerialize(e,t){super.deSerialize(e,t),this.name=e.name,this.selectedTemplate=e.selectedTemplate,this.selectedApplication=e.selectedApplication}serialize(){return at.merge(super.serialize(),{name:this.name,selectedTemplate:this.selectedTemplate,selectedApplication:this.selectedApplication})}}class Ln extends h.Component{constructor(e){super(e),this.openDialog=()=>{this.setState({dialogOpened:!0,nodeFormName:this.props.node.name,anchorElementForTooltip:null}),this.props.dispatch(ft(!1))},this.closeDialog=()=>{this.setState({dialogOpened:!1}),this.props.dispatch(ft(!0))},this.handleNodeMouseEnter=e=>{this.state.dialogOpened||this.setState({anchorElementForTooltip:e.currentTarget})},this.handleNodeMouseLeave=()=>{this.setState({anchorElementForTooltip:null})},this.getTemplatesInSelectableFormat=()=>this.props.templates.map(e=>({value:e.code,label:e.name})),this.getApplicationsInSelectableFormat=()=>this.props.applications.map(e=>({value:e.code,label:e.name})),this.getSelectedTemplateValue=()=>{var e=this.props.templates.find(e=>e.code===this.props.node.selectedTemplate);return e?" - ".concat(e.name):""},this.state={nodeFormName:this.props.node.name,selectedTemplate:this.props.node.selectedTemplate,selectedApplication:this.props.node.selectedApplication,dialogOpened:!1,anchorElementForTooltip:null}}bem(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}getClassName(){return this.props.classBaseName+" "+this.props.className}render(){return h.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:()=>{this.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},h.createElement("div",{className:"node-container"},h.createElement("div",{className:this.bem("__icon")},h.createElement(ue.a,null)),h.createElement("div",{className:this.bem("__ports")},h.createElement("div",{className:this.bem("__left")},h.createElement(bt,{name:"left",node:this.props.node})),h.createElement("div",{className:this.bem("__right")},h.createElement(bt,{name:"right",node:this.props.node})))),h.createElement("div",{className:this.bem("__title")},h.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Notification ".concat(this.getSelectedTemplateValue()))),h.createElement(wt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),h.createElement(dt.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:e=>{if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},h.createElement(ut.a,{id:"form-dialog-title"},"Notification node"),h.createElement(pt.a,null,h.createElement(ht.a,null,"Sends a push notification to user."),h.createElement(K.a,{container:!0},h.createElement(K.a,{item:!0,xs:6},h.createElement(ct.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:e=>{this.setState({nodeFormName:e.target.value})}}))),h.createElement(K.a,{container:!0,alignItems:"center",alignContent:"space-between"},h.createElement(K.a,{item:!0,xs:12},h.createElement(ta.a,{value:this.getTemplatesInSelectableFormat().find(e=>e.value===this.state.selectedTemplate),options:this.getTemplatesInSelectableFormat(),getOptionLabel:e=>e.label,style:{marginBottom:16},onChange:(e,t)=>{console.log(this.state),null!==t&&this.setState({selectedTemplate:t.value})},renderInput:e=>h.createElement(ct.a,Object.assign({},e,{variant:"standard",label:"Notification template",fullWidth:!0}))}))),h.createElement(K.a,{container:!0,alignItems:"center",alignContent:"space-between"},h.createElement(K.a,{item:!0,xs:12},h.createElement(ta.a,{value:this.getApplicationsInSelectableFormat().find(e=>e.value===this.state.selectedApplication),options:this.getApplicationsInSelectableFormat(),getOptionLabel:e=>e.label,style:{marginBottom:16},onChange:(e,t)=>{null!==t&&this.setState({selectedApplication:t.value})},renderInput:e=>h.createElement(ct.a,Object.assign({},e,{variant:"standard",label:"Application",fullWidth:!0}))})))),h.createElement(mt.a,null,h.createElement(A.a,{color:"secondary",onClick:()=>{this.closeDialog()}},"Cancel"),h.createElement(A.a,{color:"primary",onClick:()=>{this.props.node.name=this.state.nodeFormName,this.props.node.selectedTemplate=this.state.selectedTemplate,this.props.node.selectedApplication=this.state.selectedApplication,this.props.diagramEngine.repaintCanvas(),this.closeDialog()}},"Save changes"))))}}var zn=Object(E.b)((function(e){return{templates:e.pushNotifications.availableTemplates,applications:e.pushNotifications.availableApplications}}))(Ln);class Wn extends B.AbstractNodeFactory{constructor(){super("push_notification")}generateReactWidget(e,t){return h.createElement(zn,{diagramEngine:e,node:t,classBaseName:"square-node",className:"push-notification-node"})}getNewInstance(){return new An}}class Gn extends h.Component{constructor(e){super(e),this.saveChanges=()=>{var e=this.props.dispatch;if(this.props.app.isCorruptedPayload())e(yt({open:!0,variant:"error",text:"Cannot modify corrupted scenario."}));else{var t=new We(this.props.app.getDiagramEngine().getDiagramModel()),a=Object(y.a)({name:this.props.scenario.name},t.exportPayload()),n=this.props.scenario.id;n&&(a.id=n),e(Ct(!0)),f.a.post("".concat(Te),a).then(t=>{e(Tt(t.data.id)),e(Ct(!1)),e(yt({open:!0,variant:"success",text:"Scenario saving succeeded."}))}).catch(t=>{e(Ct(!1)),e(yt({open:!0,variant:"error",text:"Scenario saving failed."})),console.log(t)})}},this.startEditingName=()=>{this.setState({editedName:this.props.scenario.name,editingName:!0})},this.cancelEditingName=()=>{this.setState({editedName:"",editingName:!1})},this.submitEditingName=()=>{0!==this.state.editedName.length?(this.props.dispatch(St(this.state.editedName)),this.setState({editedName:"",editingName:!1})):this.cancelEditingName()},this.handleCloseAndSaveDuringChangingName=e=>{27===e.keyCode?this.cancelEditingName():13===e.keyCode&&this.submitEditingName()},this.handleNameTyping=e=>{this.setState({editedName:e.target.value})},this.closeNotification=()=>{this.props.dispatch(yt({open:!1}))},this.state={editingName:!1,editedName:""},this.ctrlDown=!1,this.nodesToCopy=[],this.keydownHandler=this.keydownHandler.bind(this),this.keyupHandler=this.keyupHandler.bind(this),this.copyNode=this.copyNode.bind(this)}copyNode(e){var t=75,a=75,n=this.props.app.getDiagramEngine().getDiagramModel(),i=n.getNodes();if(void 0!==i[e]){var s=i[e].clone({});s.setPosition(s.x+t,s.y+a),s.selected=!1,n.addNode(s),this.forceUpdate()}else console.warn("Unable to copy node with ID "+e)}keydownHandler(e){if(17!==e.keyCode&&91!==e.keyCode||(this.ctrlDown=!0),this.ctrlDown&&67===e.keyCode){var t=this.props.app.getDiagramEngine().getDiagramModel();this.nodesToCopy=[];var a,n=Object(j.a)(t.getSelectedItems());try{for(n.s();!(a=n.n()).done;){var i=a.value;i.selected&&i instanceof B.NodeModel&&this.nodesToCopy.push(i.id)}}catch(l){n.e(l)}finally{n.f()}}if(this.ctrlDown&&86===e.keyCode){var s,r=Object(j.a)(this.nodesToCopy);try{for(r.s();!(s=r.n()).done;){var o=s.value;this.copyNode(o)}}catch(l){r.e(l)}finally{r.f()}this.nodesToCopy=[]}}keyupHandler(e){17!==e.keyCode&&91!==e.keyCode||(this.ctrlDown=!1)}componentDidMount(){document.addEventListener("keydown",this.keydownHandler),document.addEventListener("keyup",this.keyupHandler)}componentWillUnmount(){document.removeEventListener("keydown",this.keydownHandler),document.removeEventListener("keyup",this.keyupHandler)}componentDidUpdate(e){!0===this.props.app.isCorruptedPayload()&&!1===e.app.isCorruptedPayload()&&this.props.dispatch(yt({open:!0,variant:"error",text:"Unable to load corrupted scenario."}))}render(){var e=this.props,t=e.classes,a=e.canvas,u={className:"srd-demo-canvas",diagramEngine:this.props.app.getDiagramEngine(),maxNumberPointsPerLink:0,allowLooseLinks:!1,allowCanvasTranslation:a.pannable,allowCanvasZoom:a.zoomable};return h.createElement("div",{className:"body"},h.createElement("div",{className:t.root},h.createElement(W.a,null),h.createElement(z.a,{position:"fixed",className:t.appBar},h.createElement(G.a,null,h.createElement(K.a,{container:!0},h.createElement(K.a,{item:!0,xs:4},h.createElement(H.a,{variant:"h6",color:"inherit",noWrap:!0},this.state.editingName?h.createElement("input",{autoFocus:!0,type:"text",value:this.state.editedName,onChange:this.handleNameTyping,onKeyDown:this.handleCloseAndSaveDuringChangingName,onBlur:this.submitEditingName,className:"changing-name-input"}):h.createElement("span",{onClick:this.startEditingName,className:"scenario-name"},this.props.scenario.name))),h.createElement(K.a,{item:!0,xs:8},h.createElement(K.a,{container:!0,direction:"row",justify:"flex-end"},!!this.props.scenario.loading&&h.createElement(Y.a,{className:"circular-loading",size:19,color:"inherit"}),h.createElement(A.a,{size:"small",variant:"contained",color:"secondary",onClick:()=>this.saveChanges()},this.props.scenario.id?"Update":"Save")))))),h.createElement(L.a,{className:t.drawer,variant:"permanent",classes:{paper:t.drawerPaper}},h.createElement("div",{className:t.toolbar}),h.createElement(R.a,{component:"nav",subheader:h.createElement(V.a,{component:"div"},"Triggers")},h.createElement(Le,{model:{type:"trigger"},name:"Event",icon:h.createElement(ae.a,null)}),h.createElement(Le,{model:{type:"before_trigger"},name:"Before Event",icon:h.createElement(pe.a,null)})),h.createElement(R.a,{component:"nav",subheader:h.createElement(V.a,{component:"div"},"Actions")},h.createElement(Le,{model:{type:"email"},name:"Send email",icon:h.createElement(X.a,null)}),h.createElement(Le,{model:{type:"generic"},name:"Run generic action",icon:h.createElement(Q.a,null)}),Ne&&h.createElement(Le,{model:{type:"banner"},name:"Show banner",icon:h.createElement(ee.a,null)}),fe&&h.createElement(Le,{model:{type:"push_notification"},name:"Send notification",icon:h.createElement(ue.a,null)})),h.createElement(R.a,{component:"nav",subheader:h.createElement(V.a,{component:"div"},"Operations")},h.createElement(Le,{model:{type:"segment"},name:"Segment",icon:h.createElement(re.a,null)}),h.createElement(Le,{model:{type:"condition"},name:"Condition",icon:h.createElement(le.a,null)}),h.createElement(Le,{model:{type:"wait"},name:"Wait",icon:h.createElement(ie.a,null)}),h.createElement(Le,{model:{type:"goal"},name:"Goal",icon:h.createElement(de.a,null)}))),h.createElement(et,{variant:this.props.canvas.notification.variant,text:this.props.canvas.notification.text,open:this.props.canvas.notification.open,handleClose:this.closeNotification}),h.createElement("main",{className:t.content},h.createElement("div",{className:"diagram-layer",onDrop:e=>{var t=e.dataTransfer.getData("storm-diagram-node");if(t){var a=JSON.parse(t),h=null;"email"===a.type?h=new n.NodeModel({}):"generic"===a.type?h=new s.NodeModel({}):"banner"===a.type?h=new i.NodeModel({expiresInUnit:"days",expiresInTime:1}):"push_notification"===a.type?h=new p.NodeModel({}):"segment"===a.type?h=new r.NodeModel({}):"condition"===a.type?h=new m.NodeModel({}):"trigger"===a.type?h=new o.NodeModel({}):"before_trigger"===a.type?h=new l.NodeModel({}):"wait"===a.type?h=new c.NodeModel({}):"goal"===a.type&&(h=new d.NodeModel({recheckPeriodUnit:"hours",recheckPeriodTime:1}));var u=this.props.app.getDiagramEngine().getRelativeMousePoint(e);h.x=u.x,h.y=u.y,this.props.app.getDiagramEngine().getDiagramModel().addNode(h),this.forceUpdate()}},onDragOver:e=>{e.preventDefault()}},h.createElement(B.DiagramWidget,u)))))}}var Rn=I()(Object(q.a)(e=>({root:{display:"flex"},appBar:{zIndex:e.zIndex.drawer+1},drawer:{width:240,flexShrink:0},drawerPaper:{width:240},content:{flexGrow:1,padding:0},toolbar:e.mixins.toolbar}),{name:"BodyWidget"}),Object(E.b)((function(e){return{canvas:e.canvas,scenario:e.scenario}}),null))(Gn),Vn=(a(352),a(107)),Hn=a.n(Vn);function Kn(e){return 0===e?{unit:"minutes",time:e}:e%1440===0?{unit:"days",time:e/1440}:e%60===0?{unit:"hours",time:e/60}:{unit:"minutes",time:e}}class qn{constructor(e,t={}){this.activeModel=e,this.payload=t}renderPayload(e){this.payload=e;var t=this.payload.visual;Hn()(e.elements,e=>{var a=null;if("segment"===e.type)e.selectedSegment=e.segment.code,a=new r.NodeModel(e);else if("condition"===e.type)a=new m.NodeModel({id:e.id,name:e.name,conditions:e.condition.conditions});else if("email"===e.type)e.selectedMail=e.email.code,a=new n.NodeModel(e);else if("generic"===e.type)e.selectedGeneric=e.generic.code,a=new s.NodeModel(e);else if("wait"===e.type){var o=Kn(e.wait.minutes);e.waitingUnit=o.unit,e.waitingTime=o.time,a=new c.NodeModel(e)}else if("banner"===e.type){if(!Ne)throw Error("BANNER_ENABLED configuration is false, but loaded scenario contains banner element.");var l=Kn(e.banner.expiresInMinutes);e.expiresInUnit=l.unit,e.expiresInTime=l.time,e.selectedBanner=e.banner.id,a=new i.NodeModel(e)}else if("goal"===e.type){if(e.goal.hasOwnProperty("timeoutMinutes")){var h=Kn(e.goal.timeoutMinutes);e.timeoutUnit=h.unit,e.timeoutTime=h.time}var u=Kn(e.goal.recheckPeriodMinutes);e.recheckPeriodUnit=u.unit,e.recheckPeriodTime=u.time,e.selectedGoals=e.goal.codes,a=new d.NodeModel(e)}else"push_notification"===e.type&&(e.selectedTemplate=e.push_notification.template,e.selectedApplication=e.push_notification.application,a=new p.NodeModel(e));this.activeModel.addNode(a),a.setPosition(t[e.id].x,t[e.id].y)}),Hn()(e.elements,e=>{var t=this.activeModel.getNode(e.id);e[e.type].descendants.forEach(e=>{this.linkNodes(t,this.activeModel.getNode(e.uuid),e.direction)})}),Hn()(e.triggers,e=>{var a=null;if("event"===e.type)e.selectedTrigger=e.event.code,a=new o.NodeModel(e);else if("before_event"===e.type){var n=Kn(e.options.minutes);e.timeUnit=n.unit,e.time=n.time,e.selectedTrigger=e.event.code,a=new l.NodeModel(e)}this.activeModel.addNode(a),a.setPosition(t[e.id].x,t[e.id].y),e.elements.forEach(e=>{this.linkNodes(a,this.activeModel.getNode(e))})})}linkNodes(e,t,a){if(a){if("positive"===a){var n=e.getPort("right").link(t.getPort("left"));return void this.activeModel.addLink(n)}if("negative"===a){var i=e.getPort("bottom").link(t.getPort("left"));return void this.activeModel.addLink(i)}}var s=e.getPort("right").link(t.getPort("left"));this.activeModel.addLink(s)}}class Yn{constructor(e){this.diagramEngine=new B.DiagramEngine,this.diagramEngine.installDefaultFactories(),this.activeModel=new B.DiagramModel,this.renderService=new qn(this.activeModel),this.payload=e,this.corruptedPayload=!1,e?this.renderPayload():this.registerCustomModels()}renderPayload(){this.registerCustomModels();try{this.renderService.renderPayload(this.payload)}catch(e){console.log(e.message),this.corruptedPayload=!0,this.activeModel=new B.DiagramModel}this.diagramEngine.setDiagramModel(this.activeModel),this.diagramEngine.repaintCanvas()}registerCustomModels(){this.diagramEngine.registerLinkFactory(new it),this.diagramEngine.registerPortFactory(new tt("email",e=>new n.PortModel)),this.diagramEngine.registerNodeFactory(new n.NodeFactory),this.diagramEngine.registerPortFactory(new tt("generic",e=>new s.PortModel)),this.diagramEngine.registerNodeFactory(new s.NodeFactory),this.diagramEngine.registerPortFactory(new tt("segment",e=>new r.PortModel)),this.diagramEngine.registerNodeFactory(new r.NodeFactory),this.diagramEngine.registerPortFactory(new tt("trigger",e=>new o.PortModel)),this.diagramEngine.registerNodeFactory(new o.NodeFactory),this.diagramEngine.registerPortFactory(new tt("before_trigger",e=>new l.PortModel)),this.diagramEngine.registerNodeFactory(new l.NodeFactory),this.diagramEngine.registerPortFactory(new tt("wait",e=>new c.PortModel)),this.diagramEngine.registerNodeFactory(new c.NodeFactory),this.diagramEngine.registerPortFactory(new tt("goal",e=>new d.PortModel)),this.diagramEngine.registerNodeFactory(new d.NodeFactory),this.diagramEngine.registerPortFactory(new tt("banner",e=>new i.PortModel)),this.diagramEngine.registerNodeFactory(new i.NodeFactory),this.diagramEngine.registerPortFactory(new tt("condition",e=>new m.PortModel)),this.diagramEngine.registerNodeFactory(new m.NodeFactory),this.diagramEngine.registerPortFactory(new tt("push_notification",e=>new p.PortModel)),this.diagramEngine.registerNodeFactory(new p.NodeFactory)}getActiveDiagram(){return this.activeModel}getDiagramEngine(){return this.diagramEngine}isCorruptedPayload(){return this.corruptedPayload}}class Jn extends h.Component{componentDidMount(){var e,t=this.props.dispatch;t(e=>(e(Ct(!0)),f.a.get("".concat(Ce)).then(t=>{e({type:"segments_changed",payload:t.data.result}),e(Ct(!1))}).catch(t=>{console.log(t),e(Ct(!1)),e(yt({open:!0,variant:"error",text:"Segments fetching failed."}))}))),t(e=>(e(Ct(!0)),f.a.get(Se).then(t=>{e({type:"criteria_changed",payload:t.data.blueprint}),e(Ct(!1))}).catch(t=>{console.log(t),e(Ct(!1)),e(yt({open:!0,variant:"error",text:"Criteria fetching failed."}))}))),t(e=>(e(Ct(!0)),f.a.get(Fe).then(t=>{e({type:"goals_changed",payload:t.data.goals}),e(Ct(!1))}).catch(t=>{e(Ct(!1)),console.log(t),e(yt({open:!0,variant:"error",text:"Goals fetching failed."}))}))),t(e=>(e(Ct(!0)),f.a.get("".concat(_e)).then(t=>{e({type:"triggers_changed",payload:t.data.events}),e(Ct(!1))}).catch(t=>{e(Ct(!1)),console.log(t),e(yt({open:!0,variant:"error",text:"Triggers fetching failed."}))}))),t(e=>(e(Ct(!0)),f.a.get("".concat(we)).then(t=>{e({type:"before_triggers_changed",payload:t.data.events}),e(Ct(!1))}).catch(t=>{e(Ct(!1)),console.log(t),e(yt({open:!0,variant:"error",text:"Triggers fetching failed."}))}))),t(e=>(e(Ct(!0)),f.a.get("".concat(Oe)).then(t=>{e({type:"mails_changed",payload:t.data.mail_templates}),e(Ct(!1))}).catch(t=>{e(Ct(!1)),console.log(t),e(yt({open:!0,variant:"error",text:"Mails fetching failed."}))}))),t(e=>(e(Ct(!0)),f.a.get("".concat(xe)).then(t=>{e({type:"generics_changed",payload:t.data}),e(Ct(!1))}).catch(t=>{e(Ct(!1)),console.log(t),e(yt({open:!0,variant:"error",text:"Generics fetching failed."}))}))),Ne&&t(e=>(e(Ct(!0)),f.a.get(ke).then(t=>{e({type:"banners_changed",payload:t.data.banners}),e(Ct(!1))}).catch(t=>{e(Ct(!1)),console.log(t),e(yt({open:!0,variant:"error",text:"Banners fetching failed."}))}))),fe&&t(e=>{e(Ct(!0));var t=f.a.get("".concat(De)),a=f.a.get("".concat(je));return f.a.all([t,a]).then(t=>{var a,n;e((a=t[0].data.templates,n=t[1].data.applications,{type:"push_notifications_changed",payload:{templates:a,applications:n}})),e(Ct(!1))}).catch(t=>{e(Ct(!1)),console.log(t),e(yt({open:!0,variant:"error",text:"Notifications fetching failed."}))})}),t(be?(e=be,t=>(t(Ct(!0)),f.a.get(ye+e).then(e=>{t({type:"set_scenario_payload",payload:e.data}),t(St(e.data.name)),t(Tt(e.data.id)),t(Ct(!1))}).catch(e=>{t(Ct(!1)),t(yt({open:!0,variant:"error",text:"Scenario fetching failed."})),console.log(e)}))):St("Unnamed scenario"))}render(){var e=new Yn(this.props.scenarioPayload);return u.a.createElement(Rn,{app:e})}}var Xn=Object(E.b)((function(e){return{scenarioPayload:e.scenario.payload}}))(Jn);window.__MUI_USE_NEXT_TYPOGRAPHY_VARIANTS__=!0,f.a.defaults.headers.common.Authorization=Ee;var Zn=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||v.d,Qn=Object(v.e)(D,{},Zn(Object(v.a)(b.a)));Object(g.render)(u.a.createElement(E.a,{store:Qn},u.a.createElement(Xn,null)),document.getElementById("root"))}},[[209,1,2]]]);