(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{191:function(e,t,n){e.exports=n(321)},315:function(e,t,n){},321:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"NodeModel",function(){return dt}),n.d(a,"NodeFactory",function(){return $t}),n.d(a,"PortModel",function(){return ct});var i={};n.r(i),n.d(i,"NodeModel",function(){return en}),n.d(i,"NodeFactory",function(){return sn}),n.d(i,"PortModel",function(){return Qt});var o={};n.r(o),n.d(o,"NodeModel",function(){return cn}),n.d(o,"NodeFactory",function(){return wn}),n.d(o,"PortModel",function(){return ln});var r={};n.r(r),n.d(r,"NodeModel",function(){return Tn}),n.d(r,"NodeFactory",function(){return xn}),n.d(r,"PortModel",function(){return Cn});var s={};n.r(s),n.d(s,"NodeModel",function(){return Fn}),n.d(s,"NodeFactory",function(){return Un}),n.d(s,"PortModel",function(){return _n});var l={};n.r(l),n.d(l,"NodeModel",function(){return Ln}),n.d(l,"NodeFactory",function(){return Gn}),n.d(l,"PortModel",function(){return Bn});var c={};n.r(c),n.d(c,"NodeModel",function(){return Hn}),n.d(c,"NodeFactory",function(){return ja}),n.d(c,"PortModel",function(){return Vn});var d=n(0),m=n.n(d),u=n(16),p=n(21),h=n(47),g=n(147),f=n(22),v=n.n(f),b=n(14),E="segments_changed",y="criteria_changed",O="triggers_changed",N="mails_changed",j="goals_changed",S="banners_changed",k="canvas_zoomable",w="canvas_pannable",C="canvas_zoomable_pannable",T="canvas_notification",P="set_scenario_id",M="set_scenario_name",x="set_scenario_payload",_="set_scenario_loading",F={avalaibleSegments:[]},D={criteria:[]},I={avalaibleTriggers:[]},U={pannable:!0,zoomable:!0,notification:{open:!1,variant:"success",text:""}},B={id:null,name:"",loading:0,payload:null},L={availableMails:[]},z={availableGoals:[]},A={availableBanners:[]},W=Object(h.c)({segments:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case E:return Object(b.a)({},e,{avalaibleSegments:t.payload});default:return e}},triggers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return Object(b.a)({},e,{avalaibleTriggers:t.payload});default:return e}},canvas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case w:return Object(b.a)({},e,{pannable:t.payload});case k:return Object(b.a)({},e,{zoomable:t.payload});case C:return Object(b.a)({},e,{zoomable:t.payload,pannable:t.payload});case T:return Object(b.a)({},e,{notification:Object(b.a)({},e.notification,t.payload)});default:return e}},criteria:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y:return Object(b.a)({},e,{criteria:t.payload});default:return e}},scenario:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case P:return Object(b.a)({},e,{id:t.payload});case M:return Object(b.a)({},e,{name:t.payload});case _:var n=e.loading;return t.payload?++n:--n,Object(b.a)({},e,{loading:n});case x:return Object(b.a)({},e,{payload:t.payload});default:return e}},mails:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case N:return Object(b.a)({},e,{availableMails:t.payload});default:return e}},goals:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case j:return Object(b.a)({},e,{availableGoals:t.payload});default:return e}},banners:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case S:return Object(b.a)({},e,{availableBanners:t.payload});default:return e}}}),R=n(7),G=n(10),V=n(8),H=n(6),K=n(9),Y=function(){function e(){Object(R.a)(this,e)}return Object(G.a)(e,null,[{key:"load",value:function(){var e=document.createElement("script");e.type="text/javascript",e.src="/segmenter/vue.min.js";var t=document.createElement("script");t.type="text/javascript",t.src="/segmenter/RempSegmenter.umd.min.js";var n=document.createElement("link");n.rel="stylesheet",n.href="/segmenter/RempSegmenter.css",document.head.appendChild(e),document.head.appendChild(t),document.head.appendChild(n)}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#segmenter";new window.Vue({render:function(e){return e(window.RempSegmenter)}}).$mount(e)}}]),e}(),q=n(148),J=n.n(q),X=n(12),Z=n(376),$=n(397),Q=n(385),ee=n(384),te=n(386),ne=n(367),ae=n(377),ie=n(357),oe=n(374),re=n(5),se=n(363),le=n(84),ce=n.n(le),de=n(85),me=n.n(de),ue=n(88),pe=n.n(ue),he=n(89),ge=n.n(he),fe=n(86),ve=n.n(fe),be=n(91),Ee=n.n(be),ye=n(90),Oe=n.n(ye),Ne=window.Scenario.config,je=Ne.AUTH_TOKEN,Se=Ne.API_HOST,ke=Ne.SCENARIO_ID,we=Ne.BANNER_ENABLED,Ce="".concat(Se,"/scenarios/info?id="),Te="".concat(Se,"/scenarios/create"),Pe="".concat(Se,"/scenarios/criteria"),Me="".concat(Se,"/segments/list"),xe="".concat(Se,"/events/list"),_e="".concat(Se,"/mail-template/list"),Fe="".concat(Se,"/onboarding-goals/list"),De="".concat(Se,"/remp/list-banners"),Ie="".concat(Se,"/scenarios/element"),Ue="".concat(Se,"/scenarios/trigger"),Be=n(351),Le=n(355),ze=n(356),Ae=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(V.a)(this,Object(H.a)(t).call(this,e))).state={},n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"render",value:function(){var e=this;return d.createElement(Be.a,{key:this.props.name,draggable:!0,onDragStart:function(t){t.dataTransfer.setData("storm-diagram-node",JSON.stringify(e.props.model))},className:"tray-item"},d.createElement(Le.a,null,this.props.icon),d.createElement(ze.a,{primary:this.props.name}))}}]),t}(d.Component),We=n(43);function Re(e,t){switch(t){case"minutes":return e;case"hours":return 60*e;case"days":return 60*e*24;default:return e}}var Ge=function(){function e(t){Object(R.a)(this,e),this.formatDescendant=function(e,t){var n={uuid:e.id};return"segment"===t.type?n.direction="right"===e.portName?"positive":"negative":"goal"===t.type?n.direction="right"===e.portName?"positive":"negative":"condition"===t.type&&(n.direction="right"===e.portName?"positive":"negative"),n},this.model=t}return Object(G.a)(e,[{key:"exportPayload",value:function(){var e=this,t={},n=this.model.serializeDiagram();return t.triggers={},t.elements={},t.visual={},n.nodes.filter(function(e){return"trigger"===e.type}).map(function(n){return t.triggers[n.id]=e.formatNode(n)}),Object.entries(this.model.getNodes()).forEach(function(e){t.visual[e[0]]={x:e[1].x,y:e[1].y}}),Object.entries(this.model.getNodes()).forEach(function(n){"trigger"!==n[1].type&&(t.elements[n[0]]=e.formatNode(n[1].serialize()))}),t}},{key:"getAllChildrenNodes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right";return e.ports.find(function(e){return e.name===n}).links.map(function(a){var i=null;return i=t.model.links[a].targetPort.parent.id!==e.id?t.model.links[a].targetPort.parent:t.model.links[a].sourcePort.parent,Object(b.a)({},i.serialize(),{portName:n})})}},{key:"getPositiveAndNegativeDescendants",value:function(e){var t=this,n=this.getAllChildrenNodes(e,"right").map(function(n){return t.formatDescendant(n,e)}),a=this.getAllChildrenNodes(e,"bottom").map(function(n){return t.formatDescendant(n,e)});return[].concat(Object(We.a)(n),Object(We.a)(a))}},{key:"formatNode",value:function(e){var t=this;if("email"===e.type)return{id:e.id,name:e.name?e.name:"",type:"email",email:{code:e.selectedMail,descendants:this.getAllChildrenNodes(e).map(function(n){return t.formatDescendant(n,e)})}};if("banner"===e.type)return{id:e.id,name:e.name?e.name:"",type:"banner",banner:{id:e.selectedBanner,expiresInMinutes:Re(e.expiresInTime,e.expiresInUnit),descendants:this.getAllChildrenNodes(e).map(function(n){return t.formatDescendant(n,e)})}};if("condition"===e.type)return{id:e.id,name:e.name?e.name:"",type:"condition",condition:{conditions:e.conditions,descendants:this.getPositiveAndNegativeDescendants(e)}};if("segment"===e.type)return{id:e.id,name:e.name?e.name:"",type:"segment",segment:{code:e.selectedSegment?e.selectedSegment:"all_users",descendants:this.getPositiveAndNegativeDescendants(e)}};if("trigger"===e.type)return{id:e.id,name:e.name?e.name:"",type:"event",event:{code:e.selectedTrigger?e.selectedTrigger:"user_created"},elements:this.getAllChildrenNodes(e).map(function(e){return e.id})};if("wait"===e.type)return{id:e.id,name:e.name?e.name:"",type:"wait",wait:{minutes:Re(e.waitingTime,e.waitingUnit),descendants:this.getAllChildrenNodes(e).map(function(n){return t.formatDescendant(n,e)})}};if("goal"===e.type){var n={codes:e.selectedGoals?e.selectedGoals:[],descendants:this.getPositiveAndNegativeDescendants(e),recheckPeriodMinutes:Re(e.recheckPeriodTime,e.recheckPeriodUnit)};return e.timeoutTime&&e.timeoutUnit&&(n.timeoutMinutes=Re(e.timeoutTime,e.timeoutUnit)),{id:e.id,name:e.name?e.name:"",type:"goal",goal:n}}}}]),e}(),Ve=n(393),He=n(359),Ke=n(151),Ye=n.n(Ke),qe=n(153),Je=n.n(qe),Xe=n(154),Ze=n.n(Xe),$e=n(152),Qe=n.n($e),et={success:Ye.a,warning:Qe.a,error:Je.a,info:Ze.a},tt=function(e){function t(){return Object(R.a)(this,t),Object(V.a)(this,Object(H.a)(t).apply(this,arguments))}return Object(K.a)(t,e),Object(G.a)(t,[{key:"render",value:function(){var e=et[this.props.variant];return m.a.createElement(Ve.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:this.props.open,autoHideDuration:3e3,onClose:this.props.handleClose},m.a.createElement(He.a,{className:"toast-"+this.props.variant,message:m.a.createElement("span",{id:"client-snackbar",className:"toast__message"},m.a.createElement(e,{className:"toast__icon toast__icon-variant"}),this.props.text)}))}}]),t}(m.a.Component),nt=function(e){function t(e,n){var a;return Object(R.a)(this,t),(a=Object(V.a)(this,Object(H.a)(t).call(this,e))).cb=n,a}return Object(K.a)(t,e),Object(G.a)(t,[{key:"getNewInstance",value:function(e){return this.cb(e)}}]),t}(X.AbstractPortFactory),at=n(18),it=n(23),ot=function(e){function t(){var e;return Object(R.a)(this,t),(e=Object(V.a)(this,Object(H.a)(t).call(this,"custom"))).width=3,e.curvyness=50,e.color="rgba(0,0,0,0.3)",e}return Object(K.a)(t,e),t}(X.DefaultLinkModel),rt=function(e){function t(){var e;return Object(R.a)(this,t),(e=Object(V.a)(this,Object(H.a)(t).call(this))).type="custom",e}return Object(K.a)(t,e),Object(G.a)(t,[{key:"getNewInstance",value:function(e){return new ot}},{key:"generateLinkSegment",value:function(e,t,n,a){return d.createElement("path",{className:n?t.bem("--path-selected"):"",strokeWidth:e.width,stroke:e.color,d:a})}}]),t}(X.DefaultLinkFactory),st=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left",a=arguments.length>1?arguments[1]:void 0;return Object(R.a)(this,t),(e=Object(V.a)(this,Object(H.a)(t).call(this,n,a))).position=n,e.in="left"===e.position,e}return Object(K.a)(t,e),Object(G.a)(t,[{key:"link",value:function(e){var t=this.createLinkModel();return t.setSourcePort(this),t.setTargetPort(e),t}},{key:"canLinkToPort",value:function(e){return this.in!==e.in}},{key:"serialize",value:function(){return it.merge(Object(at.a)(Object(H.a)(t.prototype),"serialize",this).call(this),{position:this.position})}},{key:"deSerialize",value:function(e,n){Object(at.a)(Object(H.a)(t.prototype),"deSerialize",this).call(this,e,n),this.position=e.position}},{key:"createLinkModel",value:function(){return new ot}}]),t}(X.PortModel),lt=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left",a=arguments.length>1?arguments[1]:void 0;return Object(R.a)(this,t),(e=Object(V.a)(this,Object(H.a)(t).call(this,n,a))).position=n,e.in="left"===e.position,e}return Object(K.a)(t,e),Object(G.a)(t,[{key:"link",value:function(e){var t=this.createLinkModel();return t.setSourcePort(this),t.setTargetPort(e),t}},{key:"serialize",value:function(){return it.merge(Object(at.a)(Object(H.a)(t.prototype),"serialize",this).call(this),{position:this.position})}},{key:"canLinkToPort",value:function(e){return this.in!==e.in}},{key:"deSerialize",value:function(e,n){Object(at.a)(Object(H.a)(t.prototype),"deSerialize",this).call(this,e,n),this.position=e.position}},{key:"createLinkModel",value:function(){return new ot}}]),t}(X.PortModel),ct=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(R.a)(this,t),Object(V.a)(this,Object(H.a)(t).call(this,e,"email"))}return Object(K.a)(t,e),t}(st),dt=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(V.a)(this,Object(H.a)(t).call(this,"email",e.id))).name=e.name,n.selectedMail=e.selectedMail,n.addPort(new ct("left")),n.addPort(new ct("right")),n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"deSerialize",value:function(e,n){Object(at.a)(Object(H.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedMail=e.selectedMail}},{key:"serialize",value:function(){return it.merge(Object(at.a)(Object(H.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedMail:this.selectedMail})}}]),t}(X.NodeModel),mt=n(395),ut=n(369),pt=n(375),ht=n(372),gt=n(373),ft=n(371),vt=n(155),bt=n.n(vt),Et=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(V.a)(this,Object(H.a)(t).call(this,e))).state={selected:!1},n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"getClassName",value:function(){return"port "+Object(at.a)(Object(H.a)(t.prototype),"getClassName",this).call(this)+(this.state.selected?this.bem("--selected"):"")}},{key:"render",value:function(){var e=this;return d.createElement("div",Object.assign({},this.getProps(),{onMouseEnter:function(){e.setState({selected:!0})},onMouseLeave:function(){e.setState({selected:!1})},"data-name":this.props.name,"data-nodeid":this.props.node.getID()}),this.props.children)}}]),t}(X.PortWidget),yt=n(361);function Ot(e){return{type:C,payload:e}}function Nt(e){return{type:T,payload:e}}function jt(e){return{type:P,payload:e}}function St(e){return{type:M,payload:e}}function kt(e){return{type:_,payload:e}}function wt(e){return function(t){return t(kt(!0)),v.a.get(Ce+e).then(function(e){var n;t((n=e.data,{type:x,payload:n})),t(St(e.data.name)),t(jt(e.data.id)),t(kt(!1))}).catch(function(e){t(kt(!1)),t(Nt({open:!0,variant:"error",text:"Scenario fetching failed."})),console.log(e)})}}function Ct(){return function(e){return e(kt(!0)),v.a.get("".concat(Me)).then(function(t){var n;e((n=t.data.result,{type:E,payload:n})),e(kt(!1))}).catch(function(t){console.log(t),e(kt(!1)),e(Nt({open:!0,variant:"error",text:"Segments fetching failed."}))})}}function Tt(){return function(e){return e(kt(!0)),v.a.get("".concat(xe)).then(function(t){var n;e((n=t.data.events,{type:O,payload:n})),e(kt(!1))}).catch(function(t){e(kt(!1)),console.log(t),e(Nt({open:!0,variant:"error",text:"Triggers fetching failed."}))})}}function Pt(){return function(e){return e(kt(!0)),v.a.get("".concat(_e)).then(function(t){var n;e((n=t.data.mail_templates,{type:N,payload:n})),e(kt(!1))}).catch(function(t){e(kt(!1)),console.log(t),e(Nt({open:!0,variant:"error",text:"Mails fetching failed."}))})}}function Mt(){return function(e){return e(kt(!0)),v.a.get(Fe).then(function(t){var n;e((n=t.data.goals,{type:j,payload:n})),e(kt(!1))}).catch(function(t){e(kt(!1)),console.log(t),e(Nt({open:!0,variant:"error",text:"Goals fetching failed."}))})}}function xt(){return function(e){return e(kt(!0)),v.a.get(De).then(function(t){var n;e((n=t.data.banners,{type:S,payload:n})),e(kt(!1))}).catch(function(t){e(kt(!1)),console.log(t),e(Nt({open:!0,variant:"error",text:"Banners fetching failed."}))})}}function _t(){return function(e){return e(kt(!0)),v.a.get(Pe).then(function(t){var n;e((n=t.data.blueprint,{type:y,payload:n})),e(kt(!1))}).catch(function(t){console.log(t),e(kt(!1)),e(Nt({open:!0,variant:"error",text:"Criteria fetching failed."}))})}}var Ft=function(e){function t(){var e,n;Object(R.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(V.a)(this,(e=Object(H.a)(t)).call.apply(e,[this].concat(i)))).state={html:null,loading:!0},n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.scenarioID&&this.props.scenarioID!==e.scenarioID&&this.fetchStatistics()}},{key:"fetchStatistics",value:function(){var e=this,t=this.props,n=t.dispatch,a=t.id,i=t.scenarioID,o=t.isTrigger;if(i){var r=o?"".concat(Ue,"?trigger_uuid=").concat(a):"".concat(Ie,"?element_uuid=").concat(a);this.setState({loading:!0}),v.a.get(r).then(function(t){var n=t.data;e.setState({html:n.html})}).catch(function(e){console.log(e),n(Nt({open:!0,variant:"error",text:"Tooltip fetching failed."}))}).then(function(){e.setState({loading:!1})})}}},{key:"render",value:function(){var e=this.props.anchorElement;return this.state.html?m.a.createElement(yt.a,{open:Boolean(e),anchorEl:e,style:{pointerEvents:"none"},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},this.state.loading&&m.a.createElement("div",{className:"node-tooltip-loader"},m.a.createElement(se.a,{size:30})),m.a.createElement("div",{className:"node-tooltip-wrapper",dangerouslySetInnerHTML:{__html:this.state.html}})):null}}]),t}(m.a.Component);var Dt=Object(p.b)(function(e){return{scenarioID:e.scenario.id}})(Ft),It=n(74),Ut=n(169),Bt=n(156),Lt=n.n(Bt),zt=n(170),At=n(360),Wt=n(398),Rt=n(368),Gt=n(158),Vt=n.n(Gt),Ht=n(157);function Kt(e){var t=e.inputRef,n=Object(Ut.a)(e,["inputRef"]);return m.a.createElement("div",Object.assign({ref:t},n))}var Yt={Control:function(e){return m.a.createElement(mt.a,Object.assign({fullWidth:!0,multiline:!0,InputProps:{inputComponent:Kt,inputProps:Object(b.a)({className:e.selectProps.classes.input,inputRef:e.innerRef,children:e.children},e.innerProps)}},e.selectProps.textFieldProps))},Menu:function(e){return m.a.createElement(At.a,Object.assign({square:!0,className:e.selectProps.classes.paper},e.innerProps),e.children)},MultiValue:function(e){return m.a.createElement(Wt.a,{tabIndex:-1,label:e.children,className:Lt()(e.selectProps.classes.chip,Object(It.a)({},e.selectProps.classes.chipFocused,e.isFocused)),onDelete:e.removeProps.onClick,deleteIcon:m.a.createElement(Vt.a,e.removeProps)})},NoOptionsMessage:function(e){return m.a.createElement(ie.a,Object.assign({color:"textSecondary",className:e.selectProps.classes.noOptionsMessage},e.innerProps),e.children)},Option:function(e){return m.a.createElement(Rt.a,Object.assign({buttonRef:e.innerRef,selected:e.isFocused,component:"div",style:{fontWeight:e.isSelected?500:400}},e.innerProps),e.children)},Placeholder:function(e){return m.a.createElement(ie.a,Object.assign({color:"textSecondary",className:e.selectProps.classes.placeholder},e.innerProps),e.children)},SingleValue:function(e){return m.a.createElement(ie.a,Object.assign({className:e.selectProps.classes.singleValue},e.innerProps),e.children)},ValueContainer:function(e){return m.a.createElement("div",{className:e.selectProps.classes.valueContainer},e.children)}},qt=function(e){function t(){var e,n;Object(R.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(V.a)(this,(e=Object(H.a)(t)).call.apply(e,[this].concat(i)))).state={single:null,multi:null},n.handleChange=function(e){return function(t){n.setState(Object(It.a)({},e,t))}},n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,n=e.theme,a={input:function(e){return Object(b.a)({},e,{color:n.palette.text.primary,"& input":{font:"inherit"}})}};return m.a.createElement("div",{className:t.root},m.a.createElement(zt.a,{classes:t,styles:a,components:Yt,menuPosition:"fixed",textFieldProps:{label:this.props.label,InputLabelProps:{shrink:!0}},isMulti:this.props.isMulti,options:this.props.options,value:this.props.value,onChange:this.props.onChange,placeholder:this.props.placeholder}))}}]),t}(m.a.Component);qt.defaultProp={isMulti:!1};var Jt=Object(re.a)(function(e){return{root:{flexGrow:1,marginTop:"10px",marginBottom:"10px",fontFamily:"Roboto, Helvetica, Arial, sans-serif"},input:{display:"flex",padding:0},valueContainer:{display:"flex",flexWrap:"wrap",flex:1,alignItems:"center",overflow:"hidden"},chip:{margin:"".concat(e.spacing.unit/2,"px ").concat(e.spacing.unit/4,"px")},chipFocused:{backgroundColor:Object(Ht.emphasize)("light"===e.palette.type?e.palette.grey[300]:e.palette.grey[700],.08)},noOptionsMessage:{padding:"".concat(e.spacing.unit,"px ").concat(2*e.spacing.unit,"px")},singleValue:{fontSize:14},placeholder:{position:"absolute",left:2,fontSize:14},paper:{position:"absolute",zIndex:1,marginTop:e.spacing.unit,left:0,right:0},divider:{height:2*e.spacing.unit}}},{withTheme:!0})(qt),Xt=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(V.a)(this,Object(H.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,anchorElementForTooltip:null}),n.props.dispatch(Ot(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Ot(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.getFormatedValue=function(){var e=n.props.mails.find(function(e){return e.code===n.state.selectedMail});return e?{value:e.code,label:e.name}:{}},n.transformOptionsForSelect=function(){var e=bt()(n.props.mails,function(e){return e.mail_type.code}),t=[];return Object.keys(e).forEach(function(n){t.push({label:e[n][0].mail_type.name,sorting:e[n][0].mail_type.sorting,options:e[n].map(function(e){return{value:e.code,label:e.name}})})}),t.sort(function(e,t){return e.sorting-t.sorting})},n.getSelectedMailValue=function(){var e=n.props.mails.find(function(e){return e.code===n.props.node.selectedMail});return e?" - ".concat(e.name):""},n.state={nodeFormName:n.props.node.name,selectedMail:n.props.node.selectedMail,dialogOpened:!1,anchorElementForTooltip:null},n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return d.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},d.createElement("div",{className:"node-container"},d.createElement("div",{className:this.bem("__icon")},d.createElement(ce.a,null)),d.createElement("div",{className:this.bem("__ports")},d.createElement("div",{className:this.bem("__left")},d.createElement(Et,{name:"left",node:this.props.node})),d.createElement("div",{className:this.bem("__right")},d.createElement(Et,{name:"right",node:this.props.node})))),d.createElement("div",{className:this.bem("__title")},d.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Mail ".concat(this.getSelectedMailValue()))),d.createElement(Dt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),d.createElement(ut.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},d.createElement(ft.a,{id:"form-dialog-title"},"Email node"),d.createElement(ht.a,null,d.createElement(gt.a,null,"Sends an email to user."),d.createElement(oe.a,{container:!0,spacing:32},d.createElement(oe.a,{item:!0,xs:6},d.createElement(mt.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),d.createElement(oe.a,{container:!0,spacing:32},d.createElement(oe.a,{item:!0,xs:12},d.createElement(Jt,{options:this.transformOptionsForSelect(),value:this.getFormatedValue(),onChange:function(t){e.setState({selectedMail:t.value})},placeholder:"Pick one",label:"Selected Mail"})))),d.createElement(pt.a,null,d.createElement(Z.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),d.createElement(Z.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedMail=e.state.selectedMail,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(d.Component);var Zt=Object(p.b)(function(e){return{mails:e.mails.availableMails}})(Xt),$t=function(e){function t(){return Object(R.a)(this,t),Object(V.a)(this,Object(H.a)(t).call(this,"email"))}return Object(K.a)(t,e),Object(G.a)(t,[{key:"generateReactWidget",value:function(e,t){return d.createElement(Zt,{diagramEngine:e,node:t,classBaseName:"square-node",className:"email-node"})}},{key:"getNewInstance",value:function(){return new dt}}]),t}(X.AbstractNodeFactory),Qt=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(R.a)(this,t),Object(V.a)(this,Object(H.a)(t).call(this,e,"banner"))}return Object(K.a)(t,e),t}(st),en=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(V.a)(this,Object(H.a)(t).call(this,"banner",e.id))).name=e.name,n.selectedBanner=e.selectedBanner,n.expiresInTime=e.expiresInTime,n.expiresInUnit=e.expiresInUnit,n.addPort(new Qt("left")),n.addPort(new Qt("right")),n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"deSerialize",value:function(e,n){Object(at.a)(Object(H.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedBanner=e.selectedBanner,this.expiresInTime=e.expiresInTime||"1",this.expiresInUnit=e.expiresInUnit||"days"}},{key:"serialize",value:function(){return it.merge(Object(at.a)(Object(H.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedBanner:this.selectedBanner,expiresInTime:this.expiresInTime,expiresInUnit:this.expiresInUnit})}}]),t}(X.NodeModel),tn=n(366),nn=n(396),an=n(389),on=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(V.a)(this,Object(H.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,anchorElementForTooltip:null}),n.props.dispatch(Ot(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Ot(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.getFormatedValue=function(){var e=n.props.banners.find(function(e){return e.id===n.state.selectedBanner});return e?{value:e.id,label:e.name}:{}},n.transformOptionsForSelect=function(){return n.props.banners.map(function(e){return{value:e.id,label:e.name}})},n.getSelectedMailValue=function(){var e=n.props.banners.find(function(e){return e.id===n.props.node.selectedBanner});return e?" - ".concat(e.name):""},n.state={nodeFormName:n.props.node.name,selectedBanner:n.props.node.selectedBanner,dialogOpened:!1,anchorElementForTooltip:null,expiresInTime:n.props.node.expiresInTime,expiresInUnit:n.props.node.expiresInUnit},n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return d.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},d.createElement("div",{className:"node-container"},d.createElement("div",{className:this.bem("__icon")},d.createElement(me.a,null)),d.createElement("div",{className:this.bem("__ports")},d.createElement("div",{className:this.bem("__left")},d.createElement(Et,{name:"left",node:this.props.node})),d.createElement("div",{className:this.bem("__right")},d.createElement(Et,{name:"right",node:this.props.node})))),d.createElement("div",{className:this.bem("__title")},d.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Banner ".concat(this.getSelectedMailValue()))),d.createElement(Dt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),d.createElement(ut.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullWidth:!0},d.createElement(ft.a,{id:"form-dialog-title"},"Banner node"),d.createElement(ht.a,null,d.createElement(gt.a,null,"Shows a one-time banner to user."),d.createElement(oe.a,{container:!0,spacing:32},d.createElement(oe.a,{item:!0,xs:6},d.createElement(mt.a,{margin:"normal",id:"action-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),d.createElement(oe.a,{container:!0,spacing:32},d.createElement(oe.a,{item:!0,xs:12},d.createElement(Jt,{options:this.transformOptionsForSelect(),value:this.getFormatedValue(),onChange:function(t){e.setState({selectedBanner:t.value})},placeholder:"Pick one",label:"Selected Banner"}))),d.createElement(oe.a,{container:!0,spacing:32},d.createElement(oe.a,{item:!0,xs:6},d.createElement(mt.a,{id:"expires-in-time",label:"Expires in",type:"number",helperText:"Banner is not shown after given period",fullWidth:!0,value:this.state.expiresInTime,onChange:function(t){e.setState({expiresInTime:t.target.value})}})),d.createElement(oe.a,{item:!0,xs:6},d.createElement(tn.a,{fullWidth:!0},d.createElement(nn.a,{htmlFor:"time-unit"},"Time unit"),d.createElement(an.a,{value:this.state.expiresInUnit,onChange:function(t){e.setState({expiresInUnit:t.target.value})},inputProps:{name:"expires-in-unit",id:"expires-in-unit"}},d.createElement(Rt.a,{value:"minutes"},"Minutes"),d.createElement(Rt.a,{value:"hours"},"Hours"),d.createElement(Rt.a,{value:"days"},"Days")))))),d.createElement(pt.a,null,d.createElement(Z.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),d.createElement(Z.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedBanner=e.state.selectedBanner,e.props.node.expiresInTime=e.state.expiresInTime,e.props.node.expiresInUnit=e.state.expiresInUnit,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(d.Component);var rn=Object(p.b)(function(e){return{banners:e.banners.availableBanners}})(on),sn=function(e){function t(){return Object(R.a)(this,t),Object(V.a)(this,Object(H.a)(t).call(this,"banner"))}return Object(K.a)(t,e),Object(G.a)(t,[{key:"generateReactWidget",value:function(e,t){return d.createElement(rn,{diagramEngine:e,node:t,classBaseName:"square-node",className:"banner-node"})}},{key:"getNewInstance",value:function(){return new en}}]),t}(X.AbstractNodeFactory),ln=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top";return Object(R.a)(this,t),Object(V.a)(this,Object(H.a)(t).call(this,e,"segment"))}return Object(K.a)(t,e),t}(lt),cn=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(V.a)(this,Object(H.a)(t).call(this,"segment",e.id))).name=e.name,n.selectedSegment=e.selectedSegment,n.addPort(new ln("left")),n.addPort(new ln("bottom")),n.addPort(new ln("right")),n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"deSerialize",value:function(e,n){Object(at.a)(Object(H.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedSegment=e.selectedSegment}},{key:"serialize",value:function(){return it.merge(Object(at.a)(Object(H.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedSegment:this.selectedSegment})}}]),t}(X.NodeModel),dn=n(62),mn=n.n(dn),un=n(87),pn=n.n(un),hn=n(380),gn=n(379),fn=n(312),vn=n(390);function bn(e){return"string"===typeof e?e:e.name}function En(e,t){return!(!t||!t.hasOwnProperty("code"))&&e.code===t.code}function yn(e,t){var n=t.filter(function(t){return t.code===e})[0];return n||null}function On(e){var t=Object(p.c)(function(t){return t.segments.avalaibleSegments.filter(function(t){return t.table===e.selectedSegmentSourceTable})})[0].segments.sort(function(e,t){return e.group.sorting-t.group.sorting===0?e.group.id-t.group.id:e.group.sorting-t.group.sorting});return m.a.createElement(vn.a,{value:yn(e.selectedSegment,t),options:t,getOptionSelected:En,getOptionLabel:bn,groupBy:function(e){return e.group.name},style:{width:700,marginLeft:10,marginBottom:5},onChange:function(t,n){e.onSegmentSelectedChange(n)},renderInput:function(e){return m.a.createElement(mt.a,Object.assign({},e,{variant:"standard",label:"Segment",fullWidth:!0}))}})}var Nn=Object(fn.a)({selectedButton:{backgroundColor:"#E4E4E4"},deselectedButton:{color:"#A6A6A6"}});function jn(e){var t=Nn(),n=Object(p.c)(function(e){return e.segments.avalaibleSegments}),a=function(e,t,n){if(e)return e;if(t){var a=n.filter(function(e){return e.segments.filter(function(e){return e.code===t}).length>0});return a[0]&&a[0].hasOwnProperty("table")?a[0].table:"users"}return"users"}(e.selectedSegmentSourceTable,e.selectedSegment,n);return m.a.createElement(oe.a,{container:!0,item:!0,xs:12,spacing:3},m.a.createElement(oe.a,{item:!0,xs:12},m.a.createElement(gn.a,{"aria-label":"outlined button group"},n.map(function(n){return m.a.createElement(Z.a,{onClick:function(){return e.onSegmentTypeButtonClick(n.table)},className:a===n.table?t.selectedButton:t.deselectedButton,key:n.table},n.table)}))),m.a.createElement(On,{selectedSegment:e.selectedSegment,selectedSegmentSourceTable:a,onSegmentSelectedChange:e.onSegmentSelectedChange}))}var Sn=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(V.a)(this,Object(H.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,selectedSegment:n.props.node.selectedSegment,anchorElementForTooltip:null}),n.props.dispatch(Ot(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Ot(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.actionSetTable=function(e){n.state.selectedSegmentSourceTable!==e&&(n.setState({selectedSegment:null}),n.setState({selectedSegmentSourceTable:e}))},n.segmentSelectedChange=function(e){var t=null;e&&e.hasOwnProperty("code")&&(t=e.code),n.setState({selectedSegment:t})},n.getSelectedSegmentValue=function(){var e=n.props.segments.flatMap(function(e){return e.segments}).find(function(e){return e.code===n.props.node.selectedSegment});return e?" - ".concat(e.name):""},n.handleNewSegmentClick=function(){window.addEventListener("savedSegment",n.handleSavedNewSegment),window.addEventListener("canceledNewSegment",n.handleCancelNewSegment),n.setState({creatingNewSegment:!0}),setTimeout(function(){Y.init()})},n.handleSavedNewSegment=function(e){n.props.dispatch(Ct()),n.setState({selectedSegment:e.detail.code,creatingNewSegment:!1}),n.props.node.name=n.state.nodeFormName,n.props.node.selectedSegment=n.state.selectedSegment,n.props.diagramEngine.repaintCanvas(),n.closeDialog(),window.removeEventListener("savedSegment",n.handleSavedNewSegment)},n.handleCancelNewSegment=function(e){n.setState({creatingNewSegment:!1}),window.removeEventListener("canceledNewSegment",n.handleSavedNewSegment)},n.state={nodeFormName:n.props.node.name,selectedSegment:n.props.node.selectedSegment,dialogOpened:!1,anchorElementForTooltip:null,creatingNewSegment:!1,selectedSegmentSourceTable:null},n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return d.createElement("div",{className:this.getClassName(),onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},d.createElement("div",{className:this.bem("__title")},d.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Segment ".concat(this.getSelectedSegmentValue()))),d.createElement("div",{className:"node-container"},d.createElement("div",{className:this.bem("__icon")},d.createElement(ve.a,null)),d.createElement("div",{className:this.bem("__ports")},d.createElement("div",{className:this.bem("__left")},d.createElement(Et,{name:"left",node:this.props.node})),d.createElement("div",{className:this.bem("__right")},d.createElement(Et,{name:"right",node:this.props.node},d.createElement(mn.a,{style:{position:"absolute",top:"-20px",right:"-20px",color:"#2ECC40"}}))),d.createElement("div",{className:this.bem("__bottom")},d.createElement(Et,{name:"bottom",node:this.props.node},d.createElement(pn.a,{style:{position:"absolute",top:"8px",right:"-22px",color:"#FF695E"}}))))),d.createElement(Dt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),d.createElement(ut.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1},fullScreen:this.state.creatingNewSegment,disableEscapeKeyDown:this.state.creatingNewSegment},!this.state.creatingNewSegment&&d.createElement(d.Fragment,null,d.createElement(ft.a,{id:"form-dialog-title"},"Segment node"),d.createElement(ht.a,null,d.createElement(gt.a,null,"Segments evaluate user's presence in a group of users defined by system-provided conditions. Execution flow can be directed based on presence/absence of user within the selected segment. You can either pick one of the existing segments or create a new one."),d.createElement(oe.a,{container:!0,spacing:3},d.createElement(oe.a,{item:!0,xs:6},d.createElement(mt.a,{margin:"normal",id:"segment-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),d.createElement(oe.a,{container:!0,spacing:3,alignItems:"flex-end"},d.createElement(oe.a,{item:!0,xs:8},d.createElement(jn,{selectedSegment:this.state.selectedSegment,selectedSegmentSourceTable:this.state.selectedSegmentSourceTable,onSegmentTypeButtonClick:this.actionSetTable,onSegmentSelectedChange:this.segmentSelectedChange})),window.RempSegmenter&&d.createElement(oe.a,{item:!0,xs:4,style:{textAlign:"right",paddingBottom:"4px"}},d.createElement(Z.a,{variant:"contained",color:"primary",size:"small",style:{position:"relative",bottom:"10px"},onClick:this.handleNewSegmentClick},d.createElement(hn.a,{style:{marginRight:"5px"}},"add_circle"),"New segment"))))),this.state.creatingNewSegment&&d.createElement(ht.a,null,d.createElement("div",{id:"segmenter",style:{position:"fixed",zIndex:"99999999"}})),!this.state.creatingNewSegment&&d.createElement(pt.a,null,d.createElement(Z.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),d.createElement(Z.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedSegment=e.state.selectedSegment,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(d.Component);var kn=Object(p.b)(function(e){var t=e.segments,n=e.dispatch;return{segments:t.avalaibleSegments,dispatch:n}})(Sn),wn=function(e){function t(){return Object(R.a)(this,t),Object(V.a)(this,Object(H.a)(t).call(this,"segment"))}return Object(K.a)(t,e),Object(G.a)(t,[{key:"generateReactWidget",value:function(e,t){return d.createElement(kn,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"segment-node"})}},{key:"getNewInstance",value:function(){return new cn}}]),t}(X.AbstractNodeFactory),Cn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(R.a)(this,t),Object(V.a)(this,Object(H.a)(t).call(this,e,"trigger"))}return Object(K.a)(t,e),t}(st),Tn=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(V.a)(this,Object(H.a)(t).call(this,"trigger",e.id))).name=e.name,n.selectedTrigger=e.selectedTrigger,n.addPort(new Cn("right")),n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"deSerialize",value:function(e,n){Object(at.a)(Object(H.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedTrigger=e.selectedTrigger}},{key:"serialize",value:function(){return it.merge(Object(at.a)(Object(H.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedTrigger:this.selectedTrigger})}}]),t}(X.NodeModel),Pn=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(V.a)(this,Object(H.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,anchorElementForTooltip:null}),n.props.dispatch(Ot(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Ot(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.getTriggersInSelectableFormat=function(){return n.props.triggers.map(function(e){return{value:e.code,label:e.name}})},n.getSelectedTriggerValue=function(){var e=n.getTriggersInSelectableFormat().find(function(e){return e.value===n.props.node.selectedTrigger});return e?" - ".concat(e.label):""},n.state={nodeFormName:n.props.node.name,selectedTrigger:n.props.node.selectedTrigger,dialogOpened:!1,anchorElementForTooltip:null},n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return d.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},d.createElement("div",{className:"node-container"},d.createElement("div",{className:this.bem("__icon")},d.createElement(pe.a,null)),d.createElement("div",{className:this.bem("__ports")},d.createElement("div",{className:this.bem("__right")},d.createElement(Et,{name:"right",node:this.props.node})))),d.createElement("div",{className:this.bem("__title")},d.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Event ".concat(this.getSelectedTriggerValue()))),d.createElement(Dt,{id:this.props.node.id,isTrigger:!0,anchorElement:this.state.anchorElementForTooltip}),d.createElement(ut.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},d.createElement(ft.a,{id:"form-dialog-title"},"Trigger node"),d.createElement(ht.a,null,d.createElement(gt.a,null,'Events are emitted on any change related to user. We recommend to combine "before" events with "Wait" operations to achieve execution at any desired time.'),d.createElement(oe.a,{container:!0,spacing:32},d.createElement(oe.a,{item:!0,xs:6},d.createElement(mt.a,{margin:"normal",id:"trigger-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),d.createElement(oe.a,{container:!0,spacing:32},d.createElement(oe.a,{item:!0,xs:12},d.createElement(Jt,{options:this.getTriggersInSelectableFormat(),value:this.getTriggersInSelectableFormat().find(function(t){return t.value===e.state.selectedTrigger}),onChange:function(t){e.setState({selectedTrigger:t.value})},placeholder:"Pick one",label:"Selected Trigger"})))),d.createElement(pt.a,null,d.createElement(Z.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),d.createElement(Z.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedTrigger=e.state.selectedTrigger,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(d.Component);var Mn=Object(p.b)(function(e){return{triggers:e.triggers.avalaibleTriggers}})(Pn),xn=function(e){function t(){return Object(R.a)(this,t),Object(V.a)(this,Object(H.a)(t).call(this,"trigger"))}return Object(K.a)(t,e),Object(G.a)(t,[{key:"generateReactWidget",value:function(e,t){return d.createElement(Mn,{diagramEngine:e,node:t,classBaseName:"square-node",className:"trigger-node"})}},{key:"getNewInstance",value:function(){return new Tn}}]),t}(X.AbstractNodeFactory),_n=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left";return Object(R.a)(this,t),Object(V.a)(this,Object(H.a)(t).call(this,e,"wait"))}return Object(K.a)(t,e),t}(st),Fn=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(V.a)(this,Object(H.a)(t).call(this,"wait",e.id))).name=e.name,n.waitingTime=e.waitingTime||10,n.waitingUnit=e.waitingUnit||"minutes",n.addPort(new _n("left")),n.addPort(new _n("right")),n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"deSerialize",value:function(e,n){Object(at.a)(Object(H.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.waitingTime=e.waitingTime,this.waitingUnit=e.waitingUnit}},{key:"serialize",value:function(){return it.merge(Object(at.a)(Object(H.a)(t.prototype),"serialize",this).call(this),{name:this.name,waitingTime:this.waitingTime,waitingUnit:this.waitingUnit})}}]),t}(X.NodeModel),Dn=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(V.a)(this,Object(H.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormWaitingTime:n.props.node.waitingTime,nodeFormName:n.props.node.name,timeUnit:n.props.node.waitingUnit,anchorElementForTooltip:null}),n.props.dispatch(Ot(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Ot(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.state={nodeFormWaitingTime:n.props.node.waitingTime,nodeFormName:n.props.node.name,timeUnit:n.props.node.waitingUnit,dialogOpened:!1,anchorElementForTooltip:null},n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return d.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},d.createElement("div",{className:"node-container"},d.createElement("div",{className:this.bem("__icon")},d.createElement(ge.a,null)),d.createElement("div",{className:this.bem("__ports")},d.createElement("div",{className:this.bem("__left")},d.createElement(Et,{name:"left",node:this.props.node})),d.createElement("div",{className:this.bem("__right")},d.createElement(Et,{name:"right",node:this.props.node})))),d.createElement("div",{className:this.bem("__title")},d.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Wait - ".concat(this.props.node.waitingTime," ").concat(this.props.node.waitingUnit))),d.createElement(Dt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),d.createElement(ut.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},d.createElement(ft.a,{id:"form-dialog-title"},"Wait node"),d.createElement(ht.a,null,d.createElement(gt.a,null,"Postpones the execution of next node in flow by selected amount of time."),d.createElement(oe.a,{container:!0,spacing:32},d.createElement(oe.a,{item:!0,xs:6},d.createElement(mt.a,{margin:"normal",id:"waiting-time",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),d.createElement(oe.a,{container:!0,spacing:32},d.createElement(oe.a,{item:!0,xs:6},d.createElement(mt.a,{id:"waiting-time",label:"Waiting time",type:"number",fullWidth:!0,value:this.state.nodeFormWaitingTime,onChange:function(t){e.setState({nodeFormWaitingTime:t.target.value})}})),d.createElement(oe.a,{item:!0,xs:6},d.createElement(tn.a,{fullWidth:!0},d.createElement(nn.a,{htmlFor:"time-unit"},"Time unit"),d.createElement(an.a,{value:this.state.timeUnit,onChange:function(t){e.setState({timeUnit:t.target.value})},inputProps:{name:"time-unit",id:"time-unit"}},d.createElement(Rt.a,{value:"minutes"},"Minutes"),d.createElement(Rt.a,{value:"hours"},"Hours"),d.createElement(Rt.a,{value:"days"},"Days")))))),d.createElement(pt.a,null,d.createElement(Z.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),d.createElement(Z.a,{color:"primary",onClick:function(){e.props.node.waitingTime=e.state.nodeFormWaitingTime,e.props.node.name=e.state.nodeFormName,e.props.node.waitingUnit=e.state.timeUnit,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(d.Component);var In=Object(p.b)(function(e){return{segments:e.segments.avalaibleSegments}})(Dn),Un=function(e){function t(){return Object(R.a)(this,t),Object(V.a)(this,Object(H.a)(t).call(this,"wait"))}return Object(K.a)(t,e),Object(G.a)(t,[{key:"generateReactWidget",value:function(e,t){return d.createElement(In,{diagramEngine:e,node:t,classBaseName:"round-node",className:"wait-node"})}},{key:"getNewInstance",value:function(){return new Fn}}]),t}(X.AbstractNodeFactory),Bn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top";return Object(R.a)(this,t),Object(V.a)(this,Object(H.a)(t).call(this,e,"goal"))}return Object(K.a)(t,e),t}(lt),Ln=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(V.a)(this,Object(H.a)(t).call(this,"goal",e.id))).name=e.name,n.selectedGoals=e.selectedGoals,n.timeoutTime=e.timeoutTime,n.timeoutUnit=e.timeoutUnit,n.recheckPeriodTime=e.recheckPeriodTime,n.recheckPeriodUnit=e.recheckPeriodUnit,n.addPort(new Bn("left")),n.addPort(new Bn("bottom")),n.addPort(new Bn("right")),n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"deSerialize",value:function(e,n){Object(at.a)(Object(H.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.selectedGoals=e.selectedGoals,this.timeoutTime=e.timeoutTime||"",this.timeoutUnit=e.timeoutUnit||"days",this.recheckPeriodTime=e.recheckPeriodTime||"1",this.recheckPeriodUnit=e.recheckPeriodUnit||"hours"}},{key:"serialize",value:function(){return it.merge(Object(at.a)(Object(H.a)(t.prototype),"serialize",this).call(this),{name:this.name,selectedGoals:this.selectedGoals,timeoutTime:this.timeoutTime,timeoutUnit:this.timeoutUnit,recheckPeriodTime:this.recheckPeriodTime,recheckPeriodUnit:this.recheckPeriodUnit})}}]),t}(X.NodeModel),zn=n(163),An=n.n(zn),Wn=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(V.a)(this,Object(H.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,selectedGoals:n.props.node.selectedGoals,timeoutTime:n.props.node.timeoutTime,timeoutUnit:n.props.node.timeoutUnit,recheckPeriodTime:n.props.node.recheckPeriodTime,recheckPeriodUnit:n.props.node.recheckPeriodUnit,anchorElementForTooltip:null}),n.props.dispatch(Ot(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Ot(!0))},n.transformOptionsForSelect=function(){return n.props.goals.map(function(e){return{value:e.code,label:e.name}})},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.getFormatedValue=function(){var e={};n.props.goals.forEach(function(t){e[t.code]=t});var t=[];return void 0!==n.state.selectedGoals&&n.state.selectedGoals.forEach(function(n){t.push({value:n,label:e[n].name})}),t},n.state={nodeFormName:n.props.node.name,selectedGoals:n.props.node.selectedGoals,timeoutTime:n.props.node.timeoutTime,timeoutUnit:n.props.node.timeoutUnit,recheckPeriodTime:n.props.node.recheckPeriodTime,recheckPeriodUnit:n.props.node.recheckPeriodUnit,dialogOpened:!1,anchorElementForTooltip:null},n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return d.createElement("div",{className:this.getClassName(),onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},d.createElement("div",{className:this.bem("__title")},d.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Goal")),d.createElement("div",{className:"node-container"},d.createElement("div",{className:this.bem("__icon")},d.createElement(Oe.a,null)),d.createElement("div",{className:this.bem("__ports")},d.createElement("div",{className:this.bem("__left")},d.createElement(Et,{name:"left",node:this.props.node})),d.createElement("div",{className:this.bem("__right")},d.createElement(Et,{name:"right",node:this.props.node},d.createElement(mn.a,{style:{position:"absolute",top:"-20px",right:"-20px",color:"#2ECC40"}}))),d.createElement("div",{className:this.bem("__bottom")},d.createElement(Et,{name:"bottom",node:this.props.node},d.createElement(An.a,{style:{position:"absolute",top:"8px",right:"-22px",color:"#FF695E"}}))))),d.createElement(Dt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),d.createElement(ut.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},d.createElement(ft.a,{id:"form-dialog-title"},"Goal node"),d.createElement(ht.a,null,d.createElement(gt.a,null,"Goal node evaluates whether user has completed selected onboarding goals. Timeout value can be optionally specified, defining a point in time when evalution of completed goals is stopped. Execution flow can be directed two ways from the node - a positive direction, when all goals are completed, or a negative one, when timeout threshold is reached."),d.createElement(oe.a,{container:!0,spacing:32},d.createElement(oe.a,{item:!0,xs:6},d.createElement(mt.a,{margin:"normal",id:"goal-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}}))),d.createElement(oe.a,{container:!0,spacing:32},d.createElement(oe.a,{item:!0,xs:12},d.createElement(Jt,{options:this.transformOptionsForSelect(),value:this.getFormatedValue(),onChange:function(t){e.setState({selectedGoals:t.map(function(e){return e.value})})},isMulti:!0,placeholder:"Pick goals",label:"Selected Goal(s)"}))),d.createElement(oe.a,{container:!0,spacing:32},d.createElement(oe.a,{item:!0,xs:6},d.createElement(mt.a,{id:"recheck-period-time",label:"Recheck period time",type:"number",helperText:"How often goals completition should be checked",fullWidth:!0,value:this.state.recheckPeriodTime,onChange:function(t){e.setState({recheckPeriodTime:t.target.value})}})),d.createElement(oe.a,{item:!0,xs:6},d.createElement(tn.a,{fullWidth:!0},d.createElement(nn.a,{htmlFor:"time-unit"},"Time unit"),d.createElement(an.a,{value:this.state.recheckPeriodUnit,onChange:function(t){e.setState({recheckPeriodUnit:t.target.value})},inputProps:{name:"recheck-period-unit",id:"recheck-period-unit"}},d.createElement(Rt.a,{value:"minutes"},"Minutes"),d.createElement(Rt.a,{value:"hours"},"Hours"),d.createElement(Rt.a,{value:"days"},"Days"))))),d.createElement(oe.a,{container:!0,spacing:32},d.createElement(oe.a,{item:!0,xs:6},d.createElement(mt.a,{id:"timeout-time",label:"Timeout time",type:"number",placeholder:"No timeout",helperText:"Optionally select a timeout",fullWidth:!0,value:this.state.timeoutTime,onChange:function(t){e.setState({timeoutTime:t.target.value})}})),d.createElement(oe.a,{item:!0,xs:6},d.createElement(tn.a,{fullWidth:!0},d.createElement(nn.a,{htmlFor:"time-unit"},"Time unit"),d.createElement(an.a,{value:this.state.timeoutUnit,onChange:function(t){e.setState({timeoutUnit:t.target.value})},inputProps:{name:"time-unit",id:"time-unit"}},d.createElement(Rt.a,{value:"minutes"},"Minutes"),d.createElement(Rt.a,{value:"hours"},"Hours"),d.createElement(Rt.a,{value:"days"},"Days")))))),d.createElement(pt.a,null,d.createElement(Z.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),d.createElement(Z.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.selectedGoals=e.state.selectedGoals,e.props.node.timeoutTime=e.state.timeoutTime,e.props.node.timeoutUnit=e.state.timeoutUnit,e.props.node.recheckPeriodTime=e.state.recheckPeriodTime,e.props.node.recheckPeriodUnit=e.state.recheckPeriodUnit,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(d.Component);var Rn=Object(p.b)(function(e){var t=e.goals,n=e.dispatch;return{goals:t.availableGoals,dispatch:n}})(Wn),Gn=function(e){function t(){return Object(R.a)(this,t),Object(V.a)(this,Object(H.a)(t).call(this,"goal"))}return Object(K.a)(t,e),Object(G.a)(t,[{key:"generateReactWidget",value:function(e,t){return d.createElement(Rn,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"goal-node"})}},{key:"getNewInstance",value:function(){return new Ln}}]),t}(X.AbstractNodeFactory),Vn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top";return Object(R.a)(this,t),Object(V.a)(this,Object(H.a)(t).call(this,e,"condition"))}return Object(K.a)(t,e),t}(lt),Hn=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(V.a)(this,Object(H.a)(t).call(this,"condition",e.id))).name=e.name,n.conditions=e.conditions,n.addPort(new Vn("left")),n.addPort(new Vn("bottom")),n.addPort(new Vn("right")),n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"deSerialize",value:function(e,n){Object(at.a)(Object(H.a)(t.prototype),"deSerialize",this).call(this,e,n),this.name=e.name,this.conditions=e.conditions}},{key:"serialize",value:function(){return it.merge(Object(at.a)(Object(H.a)(t.prototype),"serialize",this).call(this),{name:this.name,conditions:this.conditions})}}]),t}(X.NodeModel),Kn=n(92),Yn=n(165),qn=n.n(Yn),Jn=n(166),Xn=n.n(Jn),Zn=n(382),$n=n(383),Qn=n(378),ea=n(164),ta=n.n(ea);function na(){return{id:ta()(),key:""}}function aa(e,t){return{type:"SET_NODE_VALUES",payload:{values:t,nodeId:e}}}function ia(e,t){switch(t.type){case"SET_NODE_VALUES":return Object(b.a)({},e,{nodes:e.nodes.map(function(e){return e.id===t.payload.nodeId?Object(b.a)({},e,{values:t.payload.values}):e})});case"SET_EVENT":return Object(b.a)({},e,{nodes:[na()],event:t.payload});case"ADD_CRITERION":return Object(b.a)({},e,{nodes:[].concat(Object(We.a)(e.nodes),[na()])});case"DELETE_NODE":return Object(b.a)({},e,{nodes:e.nodes.filter(function(e){return e.id!==t.payload.nodeId})});case"SET_KEY_FOR_NODE":var n=e.nodes.map(function(e){return t.payload.nodeId===e.id?{id:e.id,key:t.payload.key,values:[]}:e});return Object(b.a)({},e,{nodes:n});default:throw new Error("unsupported action type "+t.type)}}var oa=Object(fn.a)(function(e){return{chipRoot:function(e){return{"&:not(:first-child)":{"&::before":{content:"'"+e.operator+"'",textTransform:"uppercase",position:"absolute",left:"-20px"},marginLeft:"20px"},position:"relative"}}}});function ra(e,t){var n=new Set(e);return t.filter(function(e){var t=n.has(e.value);return t&&n.delete(e.value),t}).concat(Object(We.a)(n))}function sa(e){return"string"===typeof e?e:e.label}function la(e){return"string"===typeof e?"":e.hasOwnProperty("group")?e.group:""}function ca(e){var t=oa({operator:e.params.operator});return m.a.createElement(vn.a,{multiple:!0,ChipProps:{classes:{root:t.chipRoot}},options:e.params.options,getOptionLabel:sa,onChange:function(t,n){e.dispatch(aa(e.node.id,{operator:e.params.operator,selection:n.map(function(e){return"string"===typeof e?e:e.value})}))},value:ra(e.node.values.selection,e.params.options),freeSolo:e.params.freeSolo,groupBy:la,renderInput:function(t){return m.a.createElement(mt.a,Object.assign({},t,{variant:"standard",label:e.params.label,placeholder:"",fullWidth:!0}))}})}var da=n(392),ma=n(381);function ua(e){void 0===e.node.values.selection&&e.dispatch(aa(e.node.id,{selection:!0}));return m.a.createElement(ma.a,{onChange:function(t){e.dispatch(aa(e.node.id,{selection:t.target.checked}))},control:m.a.createElement(da.a,null),checked:void 0!==e.node.values.selection&&e.node.values.selection,label:e.params.label})}var pa=m.a.createContext(null);function ha(e){var t=Object(d.useContext)(pa),n=e.params[e.node.key];switch(n.type){case"string_labeled_array":return m.a.createElement(ca,{node:e.node,params:n,dispatch:t});case"boolean":return m.a.createElement(ua,{node:e.node,params:n,dispatch:t});default:throw new Error("unsupported node type "+n.type)}}var ga=Object(fn.a)({cardContent:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",backgroundColor:"#F2F2F2"},formControl:{minWidth:"180px"}});function fa(e){var t=ga(),n=Object(d.useContext)(pa);return m.a.createElement(Zn.a,null,m.a.createElement($n.a,{className:t.cardContent},m.a.createElement(tn.a,{className:t.formControl},m.a.createElement(nn.a,{id:"select-criteria-label"},"Criteria"),m.a.createElement(an.a,{labelId:"select-criteria-label",id:"select-criteria",placeholder:"Select criteria",value:e.node.key,onChange:function(t){return n((a=e.node.id,{type:"SET_KEY_FOR_NODE",payload:{key:t.target.value,nodeId:a}}));var a}},e.criteria.map(function(e){return m.a.createElement(Rt.a,{key:e.key,value:e.key},e.label)}))),m.a.createElement(Qn.a,{onClick:function(){return n({type:"DELETE_NODE",payload:{nodeId:e.node.id}})},size:"small",className:t.icon,"aria-label":"delete"},m.a.createElement(qn.a,null))),e.node.key&&m.a.createElement($n.a,null,m.a.createElement(ha,{node:e.node,params:e.criteria.filter(function(t){return t.key===e.node.key})[0].params})))}var va=Object(fn.a)({andContainer:{display:"flex",justifyContent:"center",flexGrow:0,maxWidth:"100%",flexBasis:"100%"}});function ba(e){var t=va(),n=Object(d.useContext)(pa);return m.a.createElement(m.a.Fragment,null,e.nodes.map(function(n,a){return m.a.createElement(m.a.Fragment,{key:n.id},a>=1&&m.a.createElement("div",{className:t.andContainer},"AND"),m.a.createElement(oe.a,{item:!0,xs:12},m.a.createElement(fa,{node:n,criteria:e.blueprint.criteria})))}),m.a.createElement(oe.a,{item:!0,xs:12},m.a.createElement(Z.a,{onClick:function(){return n({type:"ADD_CRITERION"})},className:t.button,startIcon:m.a.createElement(Xn.a,null)},"Add new criteria")))}var Ea=Object(fn.a)({selectedButton:{backgroundColor:"#E4E4E4"},deselectedButton:{color:"#A6A6A6"}});var ya=Object(d.forwardRef)(function(e,t){var n=Ea(),a=Object(p.c)(function(e){return e.criteria.criteria}),i=Object(d.useReducer)(ia,Object(b.a)({version:1,event:a[0].event,nodes:[na()]},e.conditions)),o=Object(Kn.a)(i,2),r=o[0],s=o[1];return Object(d.useImperativeHandle)(t,function(){return{state:r}}),m.a.createElement(pa.Provider,{value:s},m.a.createElement(oe.a,{container:!0,item:!0,xs:12,spacing:3},m.a.createElement(oe.a,{item:!0,xs:12},m.a.createElement(gn.a,{"aria-label":"outlined button group"},a.map(function(e){return m.a.createElement(Z.a,{onClick:function(){return s({type:"SET_EVENT",payload:e.event})},className:r.event===e.event?n.selectedButton:n.deselectedButton,key:e.event},e.event)}))),a.filter(function(e){return e.event===r.event}).map(function(e){return m.a.createElement(ba,{key:e.event,blueprint:e,nodes:r.nodes})})))}),Oa=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(V.a)(this,Object(H.a)(t).call(this,e))).openDialog=function(){n.setState({dialogOpened:!0,nodeFormName:n.props.node.name,anchorElementForTooltip:null}),n.props.dispatch(Ot(!1))},n.closeDialog=function(){n.setState({dialogOpened:!1}),n.props.dispatch(Ot(!0))},n.handleNodeMouseEnter=function(e){n.state.dialogOpened||n.setState({anchorElementForTooltip:e.currentTarget})},n.handleNodeMouseLeave=function(){n.setState({anchorElementForTooltip:null})},n.builderRef=d.createRef(),n.state={nodeFormName:n.props.node.name,dialogOpened:!1,anchorElementForTooltip:null},n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"bem",value:function(e){return this.props.classBaseName+e+" "+this.props.className+e+" "}},{key:"getClassName",value:function(){return this.props.classBaseName+" "+this.props.className}},{key:"render",value:function(){var e=this;return d.createElement("div",{className:this.getClassName(),style:{background:this.props.node.color},onDoubleClick:function(){e.openDialog()},onMouseEnter:this.handleNodeMouseEnter,onMouseLeave:this.handleNodeMouseLeave},d.createElement("div",{className:this.bem("__title")},d.createElement("div",{className:this.bem("__name")},this.props.node.name?this.props.node.name:"Condition")),d.createElement("div",{className:"node-container"},d.createElement("div",{className:this.bem("__icon")},d.createElement(Ee.a,null)),d.createElement("div",{className:this.bem("__ports")},d.createElement("div",{className:this.bem("__left")},d.createElement(Et,{name:"left",node:this.props.node})),d.createElement("div",{className:this.bem("__right")},d.createElement(Et,{name:"right",node:this.props.node},d.createElement(mn.a,{style:{position:"absolute",top:"-20px",right:"-20px",color:"#2ECC40"}}))),d.createElement("div",{className:this.bem("__bottom")},d.createElement(Et,{name:"bottom",node:this.props.node},d.createElement(pn.a,{style:{position:"absolute",top:"8px",right:"-22px",color:"#FF695E"}}))))),d.createElement(Dt,{id:this.props.node.id,anchorElement:this.state.anchorElementForTooltip}),d.createElement(ut.a,{open:this.state.dialogOpened,onClose:this.closeDialog,"aria-labelledby":"form-dialog-title",onKeyUp:function(e){if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),e.stopPropagation(),!1}},d.createElement(ft.a,{id:"form-dialog-title"},"Event Condition"),d.createElement(ht.a,null,d.createElement(oe.a,{container:!0,spacing:32},d.createElement(oe.a,{style:{marginBottom:"10px"},item:!0,xs:6},d.createElement(mt.a,{margin:"normal",id:"trigger-name",label:"Node name",fullWidth:!0,value:this.state.nodeFormName,onChange:function(t){e.setState({nodeFormName:t.target.value})}})),d.createElement(ya,{conditions:this.props.node.conditions,ref:this.builderRef}))),d.createElement(pt.a,null,d.createElement(Z.a,{color:"secondary",onClick:function(){e.closeDialog()}},"Cancel"),d.createElement(Z.a,{color:"primary",onClick:function(){e.props.node.name=e.state.nodeFormName,e.props.node.conditions=e.builderRef.current.state,e.props.diagramEngine.repaintCanvas(),e.closeDialog()}},"Save changes"))))}}]),t}(d.Component);var Na=Object(p.b)(function(e){return{dispatch:e.dispatch}})(Oa),ja=function(e){function t(){return Object(R.a)(this,t),Object(V.a)(this,Object(H.a)(t).call(this,"condition"))}return Object(K.a)(t,e),Object(G.a)(t,[{key:"generateReactWidget",value:function(e,t){return d.createElement(Na,{diagramEngine:e,node:t,classBaseName:"diamond-node",className:"condition-node"})}},{key:"getNewInstance",value:function(){return new Hn}}]),t}(X.AbstractNodeFactory),Sa=function(e){function t(e){var n;return Object(R.a)(this,t),(n=Object(V.a)(this,Object(H.a)(t).call(this,e))).saveChanges=function(){var e=n.props.dispatch;if(n.props.app.isCorruptedPayload())e(Nt({open:!0,variant:"error",text:"Cannot modify corrupted scenario."}));else{var t=new Ge(n.props.app.getDiagramEngine().getDiagramModel()),a=Object(b.a)({name:n.props.scenario.name},t.exportPayload()),i=n.props.scenario.id;i&&(a.id=i),e(kt(!0)),v.a.post("".concat(Te),a).then(function(t){e(jt(t.data.id)),e(kt(!1)),e(Nt({open:!0,variant:"success",text:"Scenario saving succeeded."}))}).catch(function(t){e(kt(!1)),e(Nt({open:!0,variant:"error",text:"Scenario saving failed."})),console.log(t)})}},n.startEditingName=function(){n.setState({editedName:n.props.scenario.name,editingName:!0})},n.cancelEditingName=function(){n.setState({editedName:"",editingName:!1})},n.submitEditingName=function(){0!==n.state.editedName.length?(n.props.dispatch(St(n.state.editedName)),n.setState({editedName:"",editingName:!1})):n.cancelEditingName()},n.handleCloseAndSaveDuringChangingName=function(e){27===e.keyCode?n.cancelEditingName():13===e.keyCode&&n.submitEditingName()},n.handleNameTyping=function(e){n.setState({editedName:e.target.value})},n.closeNotification=function(){n.props.dispatch(Nt({open:!1}))},n.state={editingName:!1,editedName:""},n}return Object(K.a)(t,e),Object(G.a)(t,[{key:"componentDidUpdate",value:function(e){!0===this.props.app.isCorruptedPayload()&&!1===e.app.isCorruptedPayload()&&this.props.dispatch(Nt({open:!0,variant:"error",text:"Unable to load corrupted scenario."}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.classes,m=t.canvas,u={className:"srd-demo-canvas",diagramEngine:this.props.app.getDiagramEngine(),maxNumberPointsPerLink:0,allowLooseLinks:!1,allowCanvasTranslation:m.pannable,allowCanvasZoom:m.zoomable};return d.createElement("div",{className:"body"},d.createElement("div",{className:n.root},d.createElement(ee.a,null),d.createElement(Q.a,{position:"fixed",className:n.appBar},d.createElement(te.a,null,d.createElement(oe.a,{container:!0},d.createElement(oe.a,{item:!0,xs:4},d.createElement(ie.a,{variant:"h6",color:"inherit",noWrap:!0},this.state.editingName?d.createElement("input",{autoFocus:!0,type:"text",value:this.state.editedName,onChange:this.handleNameTyping,onKeyDown:this.handleCloseAndSaveDuringChangingName,onBlur:this.submitEditingName,className:"changing-name-input"}):d.createElement("span",{onClick:this.startEditingName,className:"scenario-name"},this.props.scenario.name))),d.createElement(oe.a,{item:!0,xs:8},d.createElement(oe.a,{container:!0,direction:"row",justify:"flex-end"},!!this.props.scenario.loading&&d.createElement(se.a,{className:"circular-loading",size:19,color:"inherit"}),d.createElement(Z.a,{size:"small",variant:"contained",color:"secondary",onClick:function(){return e.saveChanges()}},this.props.scenario.id?"Update":"Save")))))),d.createElement($.a,{className:n.drawer,variant:"permanent",classes:{paper:n.drawerPaper}},d.createElement("div",{className:n.toolbar}),d.createElement(ne.a,{component:"nav",subheader:d.createElement(ae.a,{component:"div"},"Triggers")},d.createElement(Ae,{model:{type:"trigger"},name:"Event",icon:d.createElement(pe.a,null)})),d.createElement(ne.a,{component:"nav",subheader:d.createElement(ae.a,{component:"div"},"Actions")},d.createElement(Ae,{model:{type:"email"},name:"Send email",icon:d.createElement(ce.a,null)}),we&&d.createElement(Ae,{model:{type:"banner"},name:"Show banner",icon:d.createElement(me.a,null)})),d.createElement(ne.a,{component:"nav",subheader:d.createElement(ae.a,{component:"div"},"Operations")},d.createElement(Ae,{model:{type:"segment"},name:"Segment",icon:d.createElement(ve.a,null)}),d.createElement(Ae,{model:{type:"condition"},name:"Condition",icon:d.createElement(Ee.a,null)}),d.createElement(Ae,{model:{type:"wait"},name:"Wait",icon:d.createElement(ge.a,null)}),d.createElement(Ae,{model:{type:"goal"},name:"Goal",icon:d.createElement(Oe.a,null)}))),d.createElement(tt,{variant:this.props.canvas.notification.variant,text:this.props.canvas.notification.text,open:this.props.canvas.notification.open,handleClose:this.closeNotification}),d.createElement("main",{className:n.content},d.createElement("div",{className:"diagram-layer",onDrop:function(t){var n=t.dataTransfer.getData("storm-diagram-node");if(n){var d=JSON.parse(n),m=null;"email"===d.type?m=new a.NodeModel({}):"banner"===d.type?m=new i.NodeModel({expiresInUnit:"days",expiresInTime:1}):"segment"===d.type?m=new o.NodeModel({}):"condition"===d.type?m=new c.NodeModel({}):"trigger"===d.type?m=new r.NodeModel({}):"wait"===d.type?m=new s.NodeModel({}):"goal"===d.type&&(m=new l.NodeModel({recheckPeriodUnit:"hours",recheckPeriodTime:1}));var u=e.props.app.getDiagramEngine().getRelativeMousePoint(t);m.x=u.x,m.y=u.y,e.props.app.getDiagramEngine().getDiagramModel().addNode(m),e.forceUpdate()}},onDragOver:function(e){e.preventDefault()}},d.createElement(X.DiagramWidget,u)))))}}]),t}(d.Component);var ka=J()(Object(re.a)(function(e){return{root:{display:"flex"},appBar:{zIndex:e.zIndex.drawer+1},drawer:{width:240,flexShrink:0},drawerPaper:{width:240},content:{flexGrow:1,padding:0},toolbar:e.mixins.toolbar}},{name:"BodyWidget"}),Object(p.b)(function(e){return{canvas:e.canvas,scenario:e.scenario}},null))(Sa),wa=(n(315),n(167)),Ca=n.n(wa);function Ta(e){return e%1440===0?{unit:"days",time:e/1440}:e%60===0?{unit:"hours",time:e/60}:{unit:"minutes",time:e}}var Pa=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(R.a)(this,e),this.activeModel=t,this.payload=n}return Object(G.a)(e,[{key:"renderPayload",value:function(e){var t=this;this.payload=e,Ca()(e.triggers,function(n){var a=e.visual[n.id];return t.renderElements(n,a)})}},{key:"renderElements",value:function(e,t){var n=this,c=[],d=null;if("event"===e.type)e.selectedTrigger=e.event.code,d=new r.NodeModel(e),c=e.elements.flatMap(function(e){var t=n.payload.elements[e],a=n.payload.visual[t.id],i=n.renderElements(t,a),o=d.getPort("right").link(i[0].getPort("left"));return n.activeModel.addLink(o),i});else if("email"===e.type)e.selectedMail=e.email.code,d=new a.NodeModel(e),c=e.email.descendants.flatMap(function(e){var t=n.payload.elements[e.uuid],a=n.payload.visual[t.id],i=n.renderElements(t,a),o=d.getPort("right").link(i[0].getPort("left"));return n.activeModel.addLink(o),i});else if("banner"===e.type){if(!we)throw Error("BANNER_ENABLED configuration is false, but loaded scenario contains banner element.");var m=Ta(e.banner.expiresInMinutes);e.expiresInUnit=m.unit,e.expiresInTime=m.time,e.selectedBanner=e.banner.id,d=new i.NodeModel(e),c=e.banner.descendants.flatMap(function(e){var t=n.payload.elements[e.uuid],a=n.payload.visual[t.id],i=n.renderElements(t,a),o=d.getPort("right").link(i[0].getPort("left"));return n.activeModel.addLink(o),i})}else if("segment"===e.type)e.selectedSegment=e.segment.code,d=new o.NodeModel(e),c=e.segment.descendants.flatMap(function(e){var t=n.payload.elements[e.uuid],a=n.payload.visual[t.id],i=n.renderElements(t,a);if(e.direction)if("positive"===e.direction){var o=d.getPort("right").link(i[0].getPort("left"));n.activeModel.addLink(o)}else if("negative"===e.direction){var r=d.getPort("bottom").link(i[0].getPort("left"));n.activeModel.addLink(r)}return i});else if("wait"===e.type){var u=Ta(e.wait.minutes);e.waitingUnit=u.unit,e.waitingTime=u.time,d=new s.NodeModel(e),c=e.wait.descendants.flatMap(function(e){var t=n.payload.elements[e.uuid],a=n.payload.visual[t.id],i=n.renderElements(t,a),o=d.getPort("right").link(i[0].getPort("left"));return n.activeModel.addLink(o),i})}else if("goal"===e.type){if(e.goal.hasOwnProperty("timeoutMinutes")){var p=Ta(e.goal.timeoutMinutes);e.timeoutUnit=p.unit,e.timeoutTime=p.time}var h=Ta(e.goal.recheckPeriodMinutes);e.recheckPeriodUnit=h.unit,e.recheckPeriodTime=h.time,e.selectedGoals=e.goal.codes,d=new l.NodeModel(e),c=e.goal.descendants.flatMap(function(e){var t=n.payload.elements[e.uuid],a=n.payload.visual[t.id],i=n.renderElements(t,a);if(e.direction)if("positive"===e.direction){var o=d.getPort("right").link(i[0].getPort("left"));n.activeModel.addLink(o)}else if("negative"===e.direction){var r=d.getPort("bottom").link(i[0].getPort("left"));n.activeModel.addLink(r)}return i})}else if("condition"===e.type){var g=this.renderCondition(e),f=Object(Kn.a)(g,2);d=f[0],c=f[1]}return this.activeModel.addNode(d),d.setPosition(t.x,t.y),[d].concat(Object(We.a)(c))}},{key:"renderCondition",value:function(e){var t=this,n=new c.NodeModel({id:e.id,name:e.name,conditions:e.condition.conditions}),a=e.condition.descendants.flatMap(function(e){var a=t.payload.elements[e.uuid],i=t.payload.visual[a.id],o=t.renderElements(a,i);if(e.direction)if("positive"===e.direction){var r=n.getPort("right").link(o[0].getPort("left"));t.activeModel.addLink(r)}else if("negative"===e.direction){var s=n.getPort("bottom").link(o[0].getPort("left"));t.activeModel.addLink(s)}return o});return[n,a]}}]),e}(),Ma=function(){function e(t){Object(R.a)(this,e),this.diagramEngine=new X.DiagramEngine,this.diagramEngine.installDefaultFactories(),this.activeModel=new X.DiagramModel,this.renderService=new Pa(this.activeModel),this.payload=t,this.corruptedPayload=!1,t?this.renderPayload():this.registerCustomModels()}return Object(G.a)(e,[{key:"renderPayload",value:function(){this.registerCustomModels();try{this.renderService.renderPayload(this.payload)}catch(e){console.log(e.message),this.corruptedPayload=!0,this.activeModel=new X.DiagramModel}this.diagramEngine.setDiagramModel(this.activeModel),this.diagramEngine.repaintCanvas()}},{key:"registerCustomModels",value:function(){this.diagramEngine.registerLinkFactory(new rt),this.diagramEngine.registerPortFactory(new nt("email",function(e){return new a.PortModel})),this.diagramEngine.registerNodeFactory(new a.NodeFactory),this.diagramEngine.registerPortFactory(new nt("segment",function(e){return new o.PortModel})),this.diagramEngine.registerNodeFactory(new o.NodeFactory),this.diagramEngine.registerPortFactory(new nt("trigger",function(e){return new r.PortModel})),this.diagramEngine.registerNodeFactory(new r.NodeFactory),this.diagramEngine.registerPortFactory(new nt("wait",function(e){return new s.PortModel})),this.diagramEngine.registerNodeFactory(new s.NodeFactory),this.diagramEngine.registerPortFactory(new nt("goal",function(e){return new l.PortModel})),this.diagramEngine.registerNodeFactory(new l.NodeFactory),this.diagramEngine.registerPortFactory(new nt("banner",function(e){return new i.PortModel})),this.diagramEngine.registerNodeFactory(new i.NodeFactory),this.diagramEngine.registerPortFactory(new nt("condition",function(e){return new c.PortModel})),this.diagramEngine.registerNodeFactory(new c.NodeFactory)}},{key:"getActiveDiagram",value:function(){return this.activeModel}},{key:"getDiagramEngine",value:function(){return this.diagramEngine}},{key:"isCorruptedPayload",value:function(){return this.corruptedPayload}}]),e}(),xa=function(e){function t(){return Object(R.a)(this,t),Object(V.a)(this,Object(H.a)(t).apply(this,arguments))}return Object(K.a)(t,e),Object(G.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.dispatch;e(Ct()),e(_t()),e(Mt()),e(Tt()),e(Pt()),we&&e(xt()),e(ke?wt(ke):St("Unnamed scenario")),Y.load()}},{key:"render",value:function(){var e=new Ma(this.props.scenarioPayload);return m.a.createElement(ka,{app:e})}}]),t}(d.Component);var _a=Object(p.b)(function(e){return{scenarioPayload:e.scenario.payload}})(xa);window.__MUI_USE_NEXT_TYPOGRAPHY_VARIANTS__=!0,v.a.defaults.headers.common.Authorization=je;var Fa=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||h.d,Da=Object(h.e)(W,{},Fa(Object(h.a)(g.a)));Object(u.render)(m.a.createElement(p.a,{store:Da},m.a.createElement(_a,null)),document.getElementById("root"))}},[[191,2,1]]]);
//# sourceMappingURL=main.da59a54f.chunk.js.map